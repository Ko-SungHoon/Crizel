<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>ISign+</title>
		
		<style>
			h1 {
				text-align: center;
			}
					
	    	div {
	    		display:block;    		
	    		margin: 0 auto;
	    		width:800px;
	    	}
    			
			button {
				margin-left: 20px;
			}
			
			div#spinner
			{
			    display: none;
			    width:150px;
			    height: 150px;
			    position: fixed;
			    top: 50%;
			    left: 50%;
			    background:url(https://media.giphy.com/media/3oEjI6SIIHBdRxXI40/giphy.gif) no-repeat center #fff;
			    text-align:center;
			    padding:10px;
			    font:normal 16px Tahoma, Geneva, sans-serif;
			    border:1px solid #666;
			    margin-left: -50px;
			    margin-top: -50px;
			    z-index:2;
			    overflow: auto;
			}			
		</style>
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<script th:inline="javascript">
			var timerId = 0;
			var interval = 2000;
			var timeout = 0;
			var max_timeout = interval * 10;			
			var spinnerVisible = false;
			
			$(document).ready(function(){
				showProgress();
				timerId = setInterval("requestStatus()", interval);
			});
			
			function requestStatus() {
		        $.get("/authentication/fido1/uaf/reqstatus", 
		        		{uid:[[${responseResult.userId}]], tid:[[${responseResult.transactionId}]]})
		        .done(function(responseResult, status){
		            if (status == "success" && responseResult.status == 2) {	// 0 : ready, 1 : progress, 2 : done
		            	hideProgress();
		            	clearInterval(timerId);		            	
	        			if(responseResult.resultCode == "000000") {
	        				alert("해지가 완료되었습니다.");
	        			} else {
	            			alert(resultMessage);
	            			return;
	        			}
		            }
		        })
		        .fail(function() {
		        	hideProgress();
		        	clearInterval(timerId);
		        	alert("error");	
		        })				
				
		        if (timeout > max_timeout) {
		        	hideProgress();
		        	clearInterval(timerId);		        	
		        	timeout = 0;
		        	alert("요청 시간이 초과하였습니다. 나중에 다시 시도하여 주십시오.");
		        } else {
		        	timeout += interval;
		        }		        
			}
			
		    function showProgress() {
		        if (!spinnerVisible) {
		            $("div#spinner").fadeIn("fast");
		            spinnerVisible = true;
		        }
		    };
		    
		    function hideProgress() {
		        if (spinnerVisible) {
		            var spinner = $("div#spinner");
		            spinner.stop();
		            spinner.fadeOut("fast");
		            spinnerVisible = false;
		        }
		    };			
		</script>			
	</head>
	
	<body>
		<div id="header">
			<h1>ISign+ FIDO UAF Deregistration</h1>
			<hr />
		</div>
		
	    <div id="spinner">
	    	 해지 요청 중...
	    </div>
	    		
	 	<div id="footer">
	 		<p>ⓒ2017 Penta Security Systems Inc. All rights reserved.</p>
	 	</div>				
	</body>
</html>