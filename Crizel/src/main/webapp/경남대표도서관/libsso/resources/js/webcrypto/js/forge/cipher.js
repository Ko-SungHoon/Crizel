/**
 * Cipher base API.
 *
 * @author Dave Longley
 *
 * Copyright (c) 2010-2014 Digital Bazaar, Inc.
 */
!function(){function t(t){t.cipher=t.cipher||{},t.cipher.algorithms=t.cipher.algorithms||{},t.cipher.createCipher=function(i,e){var r=i;if("string"==typeof r&&(r=t.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+i);return new t.cipher.BlockCipher({algorithm:r,key:e,decrypt:!1})},t.cipher.createDecipher=function(i,e){var r=i;if("string"==typeof r&&(r=t.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+i);return new t.cipher.BlockCipher({algorithm:r,key:e,decrypt:!0})},t.cipher.registerAlgorithm=function(i,e){i=i.toUpperCase(),t.cipher.algorithms[i]=e},t.cipher.getAlgorithm=function(i){return i=i.toUpperCase(),i in t.cipher.algorithms?t.cipher.algorithms[i]:null};var i=t.cipher.BlockCipher=function(t){this.algorithm=t.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=t.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=t.decrypt,this.algorithm.initialize(t)};i.prototype.start=function(i){i=i||{};var e={};for(var r in i)e[r]=i[r];e.decrypt=this._decrypt,this._finish=!1,this._input=t.util.createBuffer(),this.output=i.output||t.util.createBuffer(),this.mode.start(e)},i.prototype.update=function(t){for(t&&this._input.putBuffer(t);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()},i.prototype.finish=function(t){!t||"ECB"!==this.mode.name&&"CBC"!==this.mode.name||(this.mode.pad=function(i){return t(this.blockSize,i,!1)},this.mode.unpad=function(i){return t(this.blockSize,i,!0)});var i={};return i.decrypt=this._decrypt,i.overflow=this._input.length()%this.blockSize,this._decrypt||!this.mode.pad||this.mode.pad(this._input,i)?(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,i)?!1:this.mode.afterFinish&&!this.mode.afterFinish(this.output,i)?!1:!0):!1}}var i="cipher";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),t(forge);var e=!0;define=function(t,i){i(require,module)}}var r,o=function(e,o){o.exports=function(o){var n=r.map(function(t){return e(t)}).concat(t);if(o=o||{},o.defined=o.defined||{},o.defined[i])return o[i];o.defined[i]=!0;for(var h=0;h<n.length;++h)n[h](o);return o[i]}},n=define;define=function(t,i){return r="string"==typeof t?i.slice(2):t.slice(2),e?(delete define,n.apply(null,Array.prototype.slice.call(arguments,0))):(define=n,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}();