/**
 * A Javascript implementation of AES Cipher Suites for TLS.
 *
 * @author Dave Longley
 *
 * Copyright (c) 2009-2015 Digital Bazaar, Inc.
 *
 */
!function(){function e(e){function t(t,n,i){var c=n.entity===e.tls.ConnectionEnd.client;t.read.cipherState={init:!1,cipher:e.cipher.createDecipher("AES-CBC",c?i.keys.server_write_key:i.keys.client_write_key),iv:c?i.keys.server_write_IV:i.keys.client_write_IV},t.write.cipherState={init:!1,cipher:e.cipher.createCipher("AES-CBC",c?i.keys.client_write_key:i.keys.server_write_key),iv:c?i.keys.client_write_IV:i.keys.server_write_IV},t.read.cipherFunction=a,t.write.cipherFunction=r,t.read.macLength=t.write.macLength=i.mac_length,t.read.macFunction=t.write.macFunction=u.hmac_sha1}function r(t,r){var i=!1,a=r.macFunction(r.macKey,r.sequenceNumber,t);t.fragment.putBytes(a),r.updateSequenceNumber();var c;c=t.version.minor===u.Versions.TLS_1_0.minor?r.cipherState.init?null:r.cipherState.iv:e.random.getBytesSync(16),r.cipherState.init=!0;var o=r.cipherState.cipher;return o.start({iv:c}),t.version.minor>=u.Versions.TLS_1_1.minor&&o.output.putBytes(c),o.update(t.fragment),o.finish(n)&&(t.fragment=o.output,t.length=t.fragment.length(),i=!0),i}function n(e,t,r){if(!r){var n=e-t.length()%e;t.fillWithByte(n-1,n)}return!0}function i(e,t,r){var n=!0;if(r){for(var i=t.length(),a=t.last(),c=i-1-a;i-1>c;++c)n=n&&t.at(c)==a;n&&t.truncate(a+1)}return n}function a(t,r){var n=!1;++o;var a;a=t.version.minor===u.Versions.TLS_1_0.minor?r.cipherState.init?null:r.cipherState.iv:t.fragment.getBytes(16),r.cipherState.init=!0;var l=r.cipherState.cipher;l.start({iv:a}),l.update(t.fragment),n=l.finish(i);var _=r.macLength,h=e.random.getBytesSync(_),p=l.output.length();p>=_?(t.fragment=l.output.getBytes(p-_),h=l.output.getBytes(_)):t.fragment=l.output.getBytes(),t.fragment=e.util.createBuffer(t.fragment),t.length=t.fragment.length();var s=r.macFunction(r.macKey,r.sequenceNumber,t);return r.updateSequenceNumber(),n=c(r.macKey,h,s)&&n}function c(t,r,n){var i=e.hmac.create();return i.start("SHA1",t),i.update(r),r=i.digest().getBytes(),i.start(null,null),i.update(n),n=i.digest().getBytes(),r===n}var u=e.tls;u.CipherSuites.TLS_RSA_WITH_AES_128_CBC_SHA={id:[0,47],name:"TLS_RSA_WITH_AES_128_CBC_SHA",initSecurityParameters:function(e){e.bulk_cipher_algorithm=u.BulkCipherAlgorithm.aes,e.cipher_type=u.CipherType.block,e.enc_key_length=16,e.block_length=16,e.fixed_iv_length=16,e.record_iv_length=16,e.mac_algorithm=u.MACAlgorithm.hmac_sha1,e.mac_length=20,e.mac_key_length=20},initConnectionState:t},u.CipherSuites.TLS_RSA_WITH_AES_256_CBC_SHA={id:[0,53],name:"TLS_RSA_WITH_AES_256_CBC_SHA",initSecurityParameters:function(e){e.bulk_cipher_algorithm=u.BulkCipherAlgorithm.aes,e.cipher_type=u.CipherType.block,e.enc_key_length=32,e.block_length=16,e.fixed_iv_length=16,e.record_iv_length=16,e.mac_algorithm=u.MACAlgorithm.hmac_sha1,e.mac_length=20,e.mac_key_length=20},initConnectionState:t};var o=0}var t="aesCipherSuites";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var r=!0;define=function(e,t){t(require,module)}}var n,i=function(r,i){i.exports=function(i){var a=n.map(function(e){return r(e)}).concat(e);if(i=i||{},i.defined=i.defined||{},i.defined[t])return i[t];i.defined[t]=!0;for(var c=0;c<a.length;++c)a[c](i);return i[t]}},a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./aes","./tls"],function(){i.apply(null,Array.prototype.slice.call(arguments,0))})}();