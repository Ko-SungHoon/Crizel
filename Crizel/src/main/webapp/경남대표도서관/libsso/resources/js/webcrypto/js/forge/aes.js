/**
 * Advanced Encryption Standard (AES) implementation.
 *
 * This implementation is based on the public domain library 'jscrypto' which
 * was written by:
 *
 * Emily Stark (estark@stanford.edu)
 * Mike Hamburg (mhamburg@stanford.edu)
 * Dan Boneh (dabo@cs.stanford.edu)
 *
 * Parts of this code are based on the OpenSSL implementation of AES:
 * http://www.openssl.org
 *
 * @author Dave Longley
 *
 * Copyright (c) 2010-2014 Digital Bazaar, Inc.
 */
!function(){function e(e){function r(r,t){var n=function(){return new e.aes.Algorithm(r,t)};e.cipher.registerAlgorithm(r,n)}function t(){p=!0,u=[0,1,2,4,8,16,32,64,128,27,54];for(var e=new Array(256),r=0;128>r;++r)e[r]=r<<1,e[r+128]=r+128<<1^283;a=new Array(256),c=new Array(256),f=new Array(4),l=new Array(4);for(var r=0;4>r;++r)f[r]=new Array(256),l[r]=new Array(256);for(var t,n,i,o,s,d,y,h=0,g=0,r=0;256>r;++r){o=g^g<<1^g<<2^g<<3^g<<4,o=o>>8^255&o^99,a[h]=o,c[o]=h,s=e[o],t=e[h],n=e[t],i=e[n],d=s<<24^o<<16^o<<8^(o^s),y=(t^n^i)<<24^(h^i)<<16^(h^n^i)<<8^(h^t^i);for(var v=0;4>v;++v)f[v][h]=d,l[v][o]=y,d=d<<24|d>>>8,y=y<<24|y>>>8;0===h?h=g=1:(h=t^e[e[e[t^i]]],g^=e[e[g]])}}function n(e,r){for(var t,n=e.slice(0),i=1,o=n.length,c=o+6+1,f=s*c,p=o;f>p;++p)t=n[p-1],p%o===0?(t=a[t>>>16&255]<<24^a[t>>>8&255]<<16^a[255&t]<<8^a[t>>>24]^u[i]<<24,i++):o>6&&p%o===4&&(t=a[t>>>24]<<24^a[t>>>16&255]<<16^a[t>>>8&255]<<8^a[255&t]),n[p]=n[p-o]^t;if(r){var d,y=l[0],h=l[1],g=l[2],v=l[3],m=n.slice(0);f=n.length;for(var p=0,A=f-s;f>p;p+=s,A-=s)if(0===p||p===f-s)m[p]=n[A],m[p+1]=n[A+3],m[p+2]=n[A+2],m[p+3]=n[A+1];else for(var C=0;s>C;++C)d=n[A+C],m[p+(3&-C)]=y[a[d>>>24]]^h[a[d>>>16&255]]^g[a[d>>>8&255]]^v[a[255&d]];n=m}return n}function i(e,r,t,n){var i,o,u,p,s,d=e.length/4-1;n?(i=l[0],o=l[1],u=l[2],p=l[3],s=c):(i=f[0],o=f[1],u=f[2],p=f[3],s=a);var y,h,g,v,m,A,C;y=r[0]^e[0],h=r[n?3:1]^e[1],g=r[2]^e[2],v=r[n?1:3]^e[3];for(var w=3,B=1;d>B;++B)m=i[y>>>24]^o[h>>>16&255]^u[g>>>8&255]^p[255&v]^e[++w],A=i[h>>>24]^o[g>>>16&255]^u[v>>>8&255]^p[255&y]^e[++w],C=i[g>>>24]^o[v>>>16&255]^u[y>>>8&255]^p[255&h]^e[++w],v=i[v>>>24]^o[y>>>16&255]^u[h>>>8&255]^p[255&g]^e[++w],y=m,h=A,g=C;t[0]=s[y>>>24]<<24^s[h>>>16&255]<<16^s[g>>>8&255]<<8^s[255&v]^e[++w],t[n?3:1]=s[h>>>24]<<24^s[g>>>16&255]<<16^s[v>>>8&255]<<8^s[255&y]^e[++w],t[2]=s[g>>>24]<<24^s[v>>>16&255]<<16^s[y>>>8&255]<<8^s[255&h]^e[++w],t[n?1:3]=s[v>>>24]<<24^s[y>>>16&255]<<16^s[h>>>8&255]<<8^s[255&g]^e[++w]}function o(r){r=r||{};var t,n=(r.mode||"CBC").toUpperCase(),i="AES-"+n;t=r.decrypt?e.cipher.createDecipher(i,r.key):e.cipher.createCipher(i,r.key);var o=t.start;return t.start=function(r,n){var i=null;n instanceof e.util.ByteBuffer&&(i=n,n={}),n=n||{},n.output=i,n.iv=r,o.call(t,n)},t}e.aes=e.aes||{},e.aes.startEncrypting=function(e,r,t,n){var i=o({key:e,output:t,decrypt:!1,mode:n});return i.start(r),i},e.aes.createEncryptionCipher=function(e,r){return o({key:e,output:null,decrypt:!1,mode:r})},e.aes.startDecrypting=function(e,r,t,n){var i=o({key:e,output:t,decrypt:!0,mode:n});return i.start(r),i},e.aes.createDecryptionCipher=function(e,r){return o({key:e,output:null,decrypt:!0,mode:r})},e.aes.Algorithm=function(e,r){p||t();var n=this;n.name=e,n.mode=new r({blockSize:16,cipher:{encrypt:function(e,r){return i(n._w,e,r,!1)},decrypt:function(e,r){return i(n._w,e,r,!0)}}}),n._init=!1},e.aes.Algorithm.prototype.initialize=function(r){if(!this._init){var t,i=r.key;if("string"!=typeof i||16!==i.length&&24!==i.length&&32!==i.length){if(e.util.isArray(i)&&(16===i.length||24===i.length||32===i.length)){t=i,i=e.util.createBuffer();for(var o=0;o<t.length;++o)i.putByte(t[o])}}else i=e.util.createBuffer(i);if(!e.util.isArray(i)){t=i,i=[];var a=t.length();if(16===a||24===a||32===a){a>>>=2;for(var o=0;a>o;++o)i.push(t.getInt32())}}if(!e.util.isArray(i)||4!==i.length&&6!==i.length&&8!==i.length)throw new Error("Invalid key parameter.");var c=this.mode.name,u=-1!==["CFB","OFB","CTR","GCM"].indexOf(c);this._w=n(i,r.decrypt&&!u),this._init=!0}},e.aes._expandKey=function(e,r){return p||t(),n(e,r)},e.aes._updateBlock=i,r("AES-ECB",e.cipher.modes.ecb),r("AES-CBC",e.cipher.modes.cbc),r("AES-CFB",e.cipher.modes.cfb),r("AES-OFB",e.cipher.modes.ofb),r("AES-CTR",e.cipher.modes.ctr),r("AES-GCM",e.cipher.modes.gcm);var a,c,u,f,l,p=!1,s=4}var r="aes";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var t=!0;define=function(e,r){r(require,module)}}var n,i=function(t,i){i.exports=function(i){var o=n.map(function(e){return t(e)}).concat(e);if(i=i||{},i.defined=i.defined||{},i.defined[r])return i[r];i.defined[r]=!0;for(var a=0;a<o.length;++a)o[a](i);return i[r]}},o=define;define=function(e,r){return n="string"==typeof e?r.slice(2):e.slice(2),t?(delete define,o.apply(null,Array.prototype.slice.call(arguments,0))):(define=o,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./cipher","./cipherModes","./util"],function(){i.apply(null,Array.prototype.slice.call(arguments,0))})}();