<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="RFCViewResource">
	 <typeAlias  alias="egovMap"        type = "egovframework.rte.psl.dataaccess.util.EgovMap"/>
     <typeAlias  alias="viewResourceVO" 	type = "egovframework.rfc3.iam.vo.ViewResourceVO"/>  
      
     <resultMap id="viewResource" class="egovframework.rfc3.iam.vo.ViewResourceVO">
     	  <result property="sgroupId" column="sgroupId" />
     	  <result property="sgroupNm" column="sgroupNm" />
     	  <result property="viewResourceId" column="viewResourceId" />
     	  <result property="category" column="category" />
     	  <result property="viewName" column="viewName" />
     	  <result property="description" column="description" />
    </resultMap>
    
     <cacheModel type="${Globals.ibatis.default.cache}" id="RFCViewResourceCache" readOnly="true" serialize="false">
     	<flushInterval hours="24" />
     	<flushOnExecute statement="viewResourceDAO.insertViewResource"/>
     	<flushOnExecute statement="viewResourceDAO.updateViewResource"/>
     	<flushOnExecute statement="viewResourceDAO.deleteViewResource"/>
     	<flushOnExecute statement="viewResourceDAO.deleteViewResourceForSiteGroup"/>
     </cacheModel>
        
    <select id="viewResourceDAO.selectViewResourceListTotCnt"  parameterClass="viewResourceVO"  resultClass="java.lang.Integer" cacheModel="RFCViewResourceCache">
					    SELECT
							  count(*) totcnt
						FROM
						    RFC_COMTNVIEWRESOURCE  A  
						    INNER JOIN 
						    RFC_COMTNSITEGROUP B ON A.SGROUP_ID = B.SGROUP_ID
						<isNotEmpty prepend="AND" property="searchCondition" >
			          		     $searchCondition$  LIKE '%$searchKeyword$%'
			            </isNotEmpty>
			            <isNotEmpty prepend="AND" property="sgroupId" >
			          		   A.SGROUP_ID   LIKE  #sgroupId#
			            </isNotEmpty>
	</select>
	<select id="viewResourceDAO.selectViewResourceList" parameterClass="viewResourceVO"  resultMap="viewResource" cacheModel="RFCViewResourceCache">
			          	SELECT
							  A.SGROUP_ID  sgroupId,
							   (select  SGROUP_NM from  RFC_COMTNSITEGROUP where  SGROUP_ID =A.SGROUP_ID )  sgroupNm,
							  A.VIEW_RESOURCE_ID    viewResourceId,
							  A.CATEGORY  category,
							  A.VIEW_NAME  viewName,
							  A.DESCRIPTION  description
						FROM
						    RFC_COMTNVIEWRESOURCE  A 
						    INNER JOIN 
						    RFC_COMTNSITEGROUP B ON A.SGROUP_ID = B.SGROUP_ID
						WHERE  1=1 and B.IS_USE='1'
						<isNotEmpty prepend="AND" property="searchCondition" >
			          		     $searchCondition$  LIKE '%$searchKeyword$%'
			            </isNotEmpty>
			            <isNotEmpty prepend="AND" property="sgroupId" >
			          		   A.SGROUP_ID   LIKE  #sgroupId#
			            </isNotEmpty>
			            <isNotEmpty  property="orderField" >
			            	  ORDER BY  $orderField$   $orderSort$
			            </isNotEmpty>
			            <isEmpty  property="orderField" >
			             	 ORDER BY A.VIEW_RESOURCE_ID  DESC
			             </isEmpty>
			                 LIMIT #recordCountPerPage# OFFSET #firstIndex#
	</select>

	<select id="viewResourceDAO.getViewResourceInfo"     resultClass="viewResourceVO" cacheModel="RFCViewResourceCache">
					    SELECT 
							 VIEW_RESOURCE_ID  viewResourceId ,
							 SGROUP_ID  sgroupId,
							 CATEGORY  category,
							 VIEW_NAME  viewName,
							 DESCRIPTION description
						FROM 
							RFC_COMTNVIEWRESOURCE
						WHERE	  
						    VIEW_RESOURCE_ID = #viewResourceId#
	</select>
	
	<select id="viewResourceDAO.isExistViewResourceInfoCategory"     resultClass="java.lang.Integer" cacheModel="RFCViewResourceCache">
					    SELECT 
							 count(*) totcnt
						FROM 
							RFC_COMTNVIEWRESOURCE
						WHERE	  
						    CATEGORY = #category#
	</select>

	<insert id="viewResourceDAO.insertViewResource"  parameterClass="viewResourceVO">
					INSERT INTO 
					RFC_COMTNVIEWRESOURCE 
					(
						VIEW_RESOURCE_ID,
						SGROUP_ID,
						CATEGORY,
						VIEW_NAME,
						DESCRIPTION
					 ) VALUES (
						#viewResourceId#,
						#sgroupId#,
						#category#,
						#viewName#,
						#description#
					 )
	</insert>
	<update  id="viewResourceDAO.updateViewResource"  parameterClass="viewResourceVO" >
					UPDATE
							   RFC_COMTNVIEWRESOURCE
					  SET 	
					  			SGROUP_ID =#sgroupId#,
								VIEW_NAME =#viewName#,
								DESCRIPTION=#description#
				  	  WHERE 
				  				VIEW_RESOURCE_ID = #viewResourceId#
	</update>
	<delete id="viewResourceDAO.deleteViewResource"  >
					DELETE  FROM 
							RFC_COMTNVIEWRESOURCE
					WHERE  
							VIEW_RESOURCE_ID = #viewResourceId#
	</delete>
	<delete id="viewResourceDAO.deleteViewResourceForSiteGroup"  >
					DELETE  FROM 
							RFC_COMTNVIEWRESOURCE
					WHERE  
							SGROUP_ID = #sgroupId#
	</delete>
	
</sqlMap>