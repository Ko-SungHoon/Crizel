<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="RFCViewResourceMaping">
	 <typeAlias  alias="egovMap"        type = "egovframework.rte.psl.dataaccess.util.EgovMap"/>
     <typeAlias  alias="viewResourceRoleVO" 	type = "egovframework.rfc3.iam.vo.ViewResourceRoleVO"/>  
     <typeAlias  alias="viewResourceRoleHistoryVO" 	type = "egovframework.rfc3.iam.vo.ViewResourceRoleHistoryVO"/>  
     <typeAlias  alias="LoginVO" 	type = "egovframework.rfc3.login.vo.LoginVO"/>
      
      <resultMap id="loginvo" class="egovframework.rfc3.login.vo.LoginVO">
        <result property="uniqId" column="uniqId" />
        <result property="id" column="id" />
        <result property="password" column="password" />
        <result property="name" column="name" />
        <result property="email" column="email" />
        <result property="userHomepage" column="userHomepage" />
        <result property="sgroupId" column="sgroupId" />
        <result property="groupId" column="groupId" />
        <result property="userSe" column="userSe" />
        <result property="orgnztId" column="orgnztId" />
        <result property="ofcpsNm" column="ofcpsNm" />
        <result property="sgroupNm" column="sgroupNm" />
    </resultMap>
    
     <resultMap id="viewResourceRole" class="egovframework.rfc3.iam.vo.ViewResourceRoleVO">
     	  <result property="category" column="category" />
     	  <result property="refId" column="refId" />
     	  <result property="mask" column="mask" />
     	  <result property="permissions" column="permissions" />
     	   <result property="userSe" column="userSe" />
     	   <result property="userNm" column="userNm" />
     	  <result property="refType" column="refType" />
     	  <result property="createDate" column="createDate" />
    </resultMap>
    
     <cacheModel type="${Globals.ibatis.default.cache}" id="RFCViewResourceMapingCache" readOnly="true" serialize="false">
     	<flushInterval hours="24" />
     	<flushOnExecute statement="viewResourceMappingDAO.insertViewResourceMapping"/>
     	<flushOnExecute statement="viewResourceMappingDAO.deleteViewResourceMapping"/>
     </cacheModel>
    
    
    
    <!-- IAM -->
    <select id="viewResourceMappingDAO.getViewResourceMapping" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
    	
    	SELECT CATEGORY as "category", 
       REF_TYPE as "ref_type",
       REF_ID as "ref_id",
       MASK as "mask",
       PERMISSIONS as "permissions"   
  FROM RFC_COMTNVIEWRESOURCEROLE 
 WHERE CATEGORY = #category# 
 	   AND SGROUP_ID = #mySgroupId#	
       AND 
       ( 
           ( 
               
               <isNotEmpty property="userRole0">
               	REF_ID IN (                	
               	#userRole0#
               	<isNotEmpty property="userRole1">
               	,#userRole1#
               	</isNotEmpty>
               	<isNotEmpty property="userRole2">
               	,#userRole2#
               	</isNotEmpty>
               	<isNotEmpty property="userRole3">
               	,#userRole3#
               	</isNotEmpty>
               	<isNotEmpty property="userRole4">
               	,#userRole4#
               	</isNotEmpty>
               	<isNotEmpty property="userRole5">
               	,#userRole5#
               	</isNotEmpty>
               	<isNotEmpty property="userRole6">
               	,#userRole6#
               	</isNotEmpty>
               	<isNotEmpty property="userRole7">
               	,#userRole7#
               	</isNotEmpty>
               	<isNotEmpty property="userRole8">
               	,#userRole8#
               	</isNotEmpty>
               	<isNotEmpty property="userRole9">
               	,#userRole9#
               	</isNotEmpty>
               	<isNotEmpty property="userRole10">
               	,#userRole10# 
               	</isNotEmpty>
               	
               	<isNotEmpty property="userRole10">
               	,#userRole10# 
               	</isNotEmpty>
               	
               	<isNotEmpty property="userRole11">
               	,#userRole11# 
               	</isNotEmpty>
               	
               	<isNotEmpty property="userRole12">
               	,#userRole12# 
               	</isNotEmpty>
               	
               	<isNotEmpty property="userRole13">
               	,#userRole13# 
               	</isNotEmpty>
               	
               	<isNotEmpty property="userRole14">
               	,#userRole14# 
               	</isNotEmpty>
               	
               	<isNotEmpty property="userRole15">
               	,#userRole15# 
               	</isNotEmpty>
               	
               	)
               </isNotEmpty> 
               
                
                
               AND 
               (
                   REF_TYPE = 'ROLE' 
                   OR REF_TYPE = 'OFFICE'
               ) 
           ) 
           OR 
           ( 
               REF_ID = #userId# 
               AND REF_TYPE = 'USER' 
           ) 
           OR 
           ( 
               REF_ID = #groupId# 
               AND REF_TYPE = 'GROUP' 
           ) 
       )
    
    </select>
    
    <!-- IAM -->
    <select id="viewResourceMappingDAO.getHierarchicalRoles" parameterClass="java.util.HashMap" resultClass="java.util.HashMap" >
    	
    	SELECT a.CHILD_ROLE as "child", 
       a.PARENT_ROLE as "parent"  
  FROM RFC_COMTNROLES_HIERARCHY a 
   LEFT JOIN RFC_COMTNROLES_HIERARCHY b 
       ON (
           a.CHILD_ROLE = b.PARENT_ROLE
       )
       
    </select>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <select id="viewResourceMappingDAO.findUserListTotCnt"  parameterClass="egovframework.rfc3.login.vo.LoginVO" resultClass="java.lang.Integer">
						SELECT
							  count(*) totcnt
						FROM
						    RFC_COMVNUSERMASTER 
						WHERE  1=1 
						<isNotEmpty prepend="AND" property="searchCondition" >
			          		     $searchCondition$  LIKE '%$searchKeyword$%'
			            </isNotEmpty>
			            <isNotEmpty prepend="AND" property="sgroupId" >
			          		   SITE_GROUP_ID   LIKE  #sgroupId#
			            </isNotEmpty>
			            <isNotEmpty prepend="AND" property="userSe" >
			          		   USER_SE   LIKE  #userSe#
			            </isNotEmpty>
			            
			            <isNotEmpty prepend="AND"   property="orgnztId">
			            	 ORGNZT_ID  LIKE '$orgnztId$%'
			            </isNotEmpty>
			            
	             		
	</select>
	<select id="viewResourceMappingDAO.findUserList" parameterClass="egovframework.rfc3.login.vo.LoginVO"  resultClass="egovMap">
    SELECT  * 
      FROM (
		SELECT ROWNUM RNUM, ALL_LIST.*  
		FROM  
		(
			 
			        	SELECT
							  UNIQ_ID uniqId,
							  USER_ID id,
							  PASSWORD  password,
							  USER_NM  name, 
							  USER_EMAIL  email,
							  USER_HOMEPAGE  userHomepage,
							  SITE_GROUP_ID  sgroupId,
							  GROUP_ID  groupId,
							  USER_SE userSe,
							  
							  
							   case
							(select OFFICE_DP from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID)
							  when 4 then
                                      
                                        (select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID))))
                                        ||' > '
                                        ||(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID)))
                                        ||' > '
                                        ||(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID))
                                        ||' > '
                                        ||(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID)
                                      
                                        when 3 then
                                     
                                        ( select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID)))
                                        ||' > '
                                        ||(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID))
                                        ||' > '
                                        ||(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID)
                                     
                                        when 2 then
                                        (select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID))
                                        ||' > '
                                        ||(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID)
                                      
                                     	when 1 then
										(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID)
                             end 
	                          as orgnztId,
							 (select OFCPS_NM from RFC_COMTNMANAGER where EMPLYR_ID = A.USER_ID) ofcpsNm,
							  (select  SGROUP_NM from  RFC_COMTNSITEGROUP where  SGROUP_ID =A.SITE_GROUP_ID )  sgroupNm
						FROM
						    RFC_COMVNUSERMASTER  A
						WHERE  1=1 
						<isNotEmpty prepend="AND" property="searchCondition" >
			          		     $searchCondition$  LIKE '%$searchKeyword$%'
			            </isNotEmpty>
			            <isNotEmpty prepend="AND" property="sgroupId" >
			          		   SITE_GROUP_ID   LIKE  #sgroupId#
			            </isNotEmpty>
			            <isNotEmpty prepend="AND" property="userSe" >
			          		   USER_SE   LIKE  #userSe#
			            </isNotEmpty>
			            
			            <isNotEmpty prepend="AND"   property="orgnztId">
			            	 	ORGNZT_ID  LIKE '$orgnztId$%'
			            </isNotEmpty>
			            
			             	ORDER BY UNIQ_ID  DESC
			          ) ALL_LIST
	      )
  WHERE  RNUM  &gt; #firstIndex#
  AND  RNUM &lt;= #firstIndex# + #recordCountPerPage#
	</select>
 
	<select id="viewResourceMappingDAO.selectViewResourceMappingList" parameterClass="viewResourceRoleVO"  resultMap="viewResourceRole">
			          	SELECT
							  CATEGORY  category ,
							  REF_ID  refId,
							  MASK  mask,
							  (select   USER_SE  from  RFC_COMVNUSERMASTER where  USER_ID =A.REF_ID )  userSe,
							  (select  USER_NM  from  RFC_COMVNUSERMASTER where  USER_ID =A.REF_ID )  userNm,
							  PERMISSIONS  permissions,
							  REF_TYPE  refType,
							  CREATE_DATE  createDate
						FROM
						     RFC_COMTNVIEWRESOURCEROLE A
						WHERE  1=1 
			          	 	AND  CATEGORY   LIKE  #category#
			          	 <!--	
			          	 <isNotEqual  prepend="AND"   property="isRoleAdmin" compareValue="true">
			            		 (  REF_ID  != 'ROLE_ADMIN'  ) 
			            </isNotEqual>
			            -->
			            
			            <isNotEmpty prepend="AND" property="sgroupId">
			            	SGROUP_ID = #sgroupId#
			            </isNotEmpty>
			            
			            <isNotEmpty prepend="AND" property="refType" >
			          		   REF_TYPE   LIKE  #refType#
			            </isNotEmpty>
			             ORDER BY 
			                 CASE  REF_TYPE 
			                    WHEN  'USER'  THEN 1
			                    WHEN  'GROUP'  THEN 2
			                    WHEN  ' ROLE'  THEN 3 
			                    WHEN  'OFFICE'  THEN 4 
			                    ELSE 10
			                 END,  REF_ID
	</select>
	<insert id="viewResourceMappingDAO.insertViewResourceMapping"  parameterClass="viewResourceRoleVO">
					INSERT INTO 
					RFC_COMTNVIEWRESOURCEROLE 
					(
						CATEGORY,
						REF_ID,
						SGROUP_ID,
						MASK,
						PERMISSIONS,
						REF_TYPE,
						CREATE_DATE,
						MODIFY_DATE
					 ) VALUES (
						#category#,
						#refId#,
						#sgroupId#,
						#mask#,
						#permissions#,
						#refType#,
						#createDate#,
						#modifyDate#
					 )
	</insert>
	<delete id="viewResourceMappingDAO.deleteViewResourceMapping"  >
					DELETE  FROM 
							RFC_COMTNVIEWRESOURCEROLE
					WHERE  
							CATEGORY = #category# 
	</delete>
	
	<select id="viewResourceMappingDAO.findUserLoginVO" parameterClass="LoginVO"  resultMap="loginvo">
    SELECT  * 
      FROM (
		SELECT ROWNUM RNUM, ALL_LIST.*  
		FROM  
		(
			 
			        	SELECT
							  UNIQ_ID uniqId,
							  USER_ID id,
							  PASSWORD  password,
							  USER_NM  name, 
							  USER_EMAIL  email,
							  USER_HOMEPAGE  userHomepage,
							  SITE_GROUP_ID  sgroupId,
							  GROUP_ID  groupId,
							  USER_SE userSe,
							  
							  
							   case
							(select OFFICE_DP from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID)
							  when 4 then
                                      
                                        (select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID))))
                                        ||' > '
                                        ||(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID)))
                                        ||' > '
                                        ||(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID))
                                        ||' > '
                                        ||(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID)
                                      
                                        when 3 then
                                     
                                        ( select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID)))
                                        ||' > '
                                        ||(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID))
                                        ||' > '
                                        ||(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID)
                                     
                                        when 2 then
                                        (select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID))
                                        ||' > '
                                        ||(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID)
                                      
                                     	when 1 then
										(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.ORGNZT_ID)
                             end 
	                          as orgnztId,
							 (select OFCPS_NM from RFC_COMTNMANAGER where EMPLYR_ID = A.USER_ID) ofcpsNm,
							  (select  SGROUP_NM from  RFC_COMTNSITEGROUP where  SGROUP_ID =A.SITE_GROUP_ID )  sgroupNm
						FROM
						    RFC_COMVNUSERMASTER  A
						WHERE  1=1 
						<isNotEmpty prepend="AND" property="searchCondition" >
			          		     $searchCondition$  LIKE '%$searchKeyword$%'
			            </isNotEmpty>
			            <isNotEmpty prepend="AND" property="sgroupId" >
			          		   SITE_GROUP_ID   LIKE  #sgroupId#
			            </isNotEmpty>
			            <isNotEmpty prepend="AND" property="userSe" >
			          		   USER_SE   LIKE  #userSe#
			            </isNotEmpty>
			            
			            <isNotEmpty prepend="AND"   property="orgnztId">
			            	 	ORGNZT_ID  LIKE '$orgnztId$%'
			            </isNotEmpty>
			            
			             	ORDER BY UNIQ_ID  DESC
			          ) ALL_LIST
	      )
  WHERE  RNUM  &gt; #firstIndex#
  AND  RNUM &lt;= #firstIndex# + #recordCountPerPage#
	</select>
	
	<select id="viewResourceMappingDAO.findUserUpdateCnt"  parameterClass="viewResourceRoleVO" resultClass="java.lang.Integer"  cacheModel="RFCViewResourceMapingCache">
						SELECT
							  count(*) totcnt
						FROM
						   RFC_COMTNVIEWRESOURCEROLE
					WHERE  
							CATEGORY = #category# 
					AND
							REF_ID = #refId#
					AND
							SGROUP_ID = #sgroupId#
	</select>
	
	<update id="viewResourceMappingDAO.UserUpdateCnt"  parameterClass="viewResourceRoleVO">
				UPDATE 
					RFC_COMTNVIEWRESOURCEROLE
				SET
					REF_ID = #refId#

				WHERE  
						CATEGORY = #category# 
				AND
						REF_ID = #uprefId#
				AND
						SGROUP_ID = #sgroupId#
	</update>
	
	
	<delete id="viewResourceMappingDAO.UserDelete"  parameterClass="viewResourceRoleVO">
				 DELETE FROM
					RFC_COMTNVIEWRESOURCEROLE
				WHERE  
						CATEGORY = #category# 
				AND
						REF_ID = #refId#
				AND
						SGROUP_ID = #sgroupId#
	</delete>
	
	
	
	<select id="viewResourceMappingDAO.selectViewResourceMappingUserList" parameterClass="viewResourceRoleVO"  resultMap="viewResourceRole">
			          	SELECT
							  CATEGORY  category ,
							  REF_ID  refId,
							  MASK  mask,
							  PERMISSIONS  permissions,
							  REF_TYPE  refType,
							  (select   USER_SE  from  RFC_COMVNUSERMASTER where  USER_ID =A.REF_ID )  userSe,
							  (select  USER_NM  from  RFC_COMVNUSERMASTER where  USER_ID =A.REF_ID )  userNm,
							  CREATE_DATE  createDate
						FROM
						     RFC_COMTNVIEWRESOURCEROLE A
						WHERE  1=1 
			          	 	AND  REF_ID=#refId# 
			          	 	AND  REF_TYPE='USER' 
			          	 	AND  PERMISSIONS like '%ADMINISTRATION%' 
			          	 	AND CATEGORY like '%DOM%'
	</select>
	
	<select id="viewResourceMappingDAO.selectViewResourceMappingOfficeList" parameterClass="viewResourceRoleVO"  resultMap="viewResourceRole">
SELECT
							  CATEGORY  category ,
							  REF_ID  refId,
							  MASK  mask,
							  PERMISSIONS  permissions,
							  REF_TYPE  refType,
							  (select   USER_SE  from  RFC_COMVNUSERMASTER where  USER_ID =A.REF_ID )  userSe,
							  (select  USER_NM  from  RFC_COMVNUSERMASTER where  USER_ID =A.REF_ID )  userNm,
							  CREATE_DATE  createDate
						FROM
						     RFC_COMTNVIEWRESOURCEROLE A
						WHERE  1=1
							<!--
			          	 	AND  REF_ID like '$refId$%'
			          	 	-->
			          	 	
			          	 	AND REGEXP_LIKE(REF_ID, '$refId$')
			          	 	
			          	 	<!-- 의령 아이디(사용자추가)포함 출력으로 주석 아래 구현 ,2016.6.7
			          	 	AND  REF_TYPE=#refType# 
			          	 	-->
			          	 	
			          	 	AND  REGEXP_LIKE(REF_TYPE,'$refType$')
			          	 	 
			          	 	AND CATEGORY like '%DOM%'
</select>
	
	
	<!--  Role History -->
	
	<select id="viewResourceMappingDAO.selectHistoryLoginVO" parameterClass="viewResourceRoleHistoryVO"  resultClass="viewResourceRoleHistoryVO">
	    SELECT  * 
	      FROM (
			SELECT ROWNUM RNUM, ALL_LIST.*  
			FROM  
			(
				 
				        	SELECT
				        		HISTORY_ID		historyId,	
								CATEGORY		category,
								REF_ID			refId,
								SGROUP_ID		sgroupId,
								MASK			mask,
								PERMISSIONS		permissions,
								REF_TYPE		refType,
								USER_ID			userId,
								CREATE_DATE		createDate,
								MODIFY_DATE		modifyDate,
								USER_IP			userIp 
	                            
							FROM
							    RFC_COMTNVIEWROLEHISTORYS  A
							WHERE  1=1 
							AND
							CATEGORY = #category#
							AND
							 to_char(CREATE_DATE,'YYYYMMDD')  LIKE LPAD(#strYears#,4,'0')||LPAD(#strMonths#,2,'0')||LPAD(#strDays#,2,'0')||'%'
				             ORDER BY CREATE_DATE  DESC
				          ) ALL_LIST
		      )
	 WHERE  RNUM  &lt;= #historyCnt#
 
	</select>
	
	
	
	<insert id="viewResourceMappingDAO.insertViewResourceMappingHistory"  parameterClass="viewResourceRoleHistoryVO">
					INSERT INTO 
					RFC_COMTNVIEWROLEHISTORYS
					 
					(
						HISTORY_ID,
						CATEGORY,
						REF_ID,
						SGROUP_ID,
						MASK,
						PERMISSIONS,
						REF_TYPE,
						USER_ID,
						CREATE_DATE,
						MODIFY_DATE,
						USER_IP
					 ) VALUES (
					    #historyId#,
						#category#,
						#refId#,
						#sgroupId#,
						#mask#,
						#permissions#,
						#refType#,
						#userId#,
						#createDate#,
						#createDate#,
						#userIp#
					 )
	</insert>		
	
	
	<select id="viewResourceMappingDAO.selectCopyResourceMappingUserList" parameterClass="viewResourceRoleVO"  resultClass="viewResourceRoleVO">
			          	SELECT
							  CATEGORY  category ,
							  REF_ID  refId,
							  MASK  mask,
							  PERMISSIONS  permissions,
							  REF_TYPE  refType,
							  SGROUP_ID	sgroupId,
							  (select   USER_SE  from  RFC_COMVNUSERMASTER where  USER_ID =A.REF_ID )  userSe,
							  (select  USER_NM  from  RFC_COMVNUSERMASTER where  USER_ID =A.REF_ID )  userNm,
							  CREATE_DATE  createDate
						FROM
						     RFC_COMTNVIEWRESOURCEROLE A
						WHERE
			          	 	REF_ID=#refId# 
			          	 	AND  REF_TYPE='USER'
			          	 	
			          	 	
	</select>	
	
		<select id="viewResourceMappingDAO.selectRoleCopyUserList" parameterClass="viewResourceRoleVO"  resultClass="viewResourceRoleVO">
			          	SELECT
							  CATEGORY  category ,
							  REF_ID  refId,
							  MASK  mask,
							  PERMISSIONS  permissions,
							  REF_TYPE  refType,
							  SGROUP_ID	sgroupId,
							  (select   USER_SE  from  RFC_COMVNUSERMASTER where  USER_ID =A.REF_ID )  userSe,
							  (select  USER_NM  from  RFC_COMVNUSERMASTER where  USER_ID =A.REF_ID )  userNm,
							  CREATE_DATE  createDate
						FROM
						     RFC_COMTNVIEWRESOURCEROLE A
						WHERE
							CATEGORY IN
							<iterate property="menuRolearr" open="(" close=")" conjunction=",">
							#menuRolearr[]#
							</iterate>
							
			          	 	AND  REF_TYPE='USER'
			          	 	
			          	 	
	</select>	
	

	
	<update id="viewResourceMappingDAO.UserCopyUpdateCnt"  parameterClass="viewResourceRoleVO">
				UPDATE 
					RFC_COMTNVIEWRESOURCEROLE
				SET
					REF_ID = #refId#

				WHERE  
					REF_ID=#refId# 
			        AND  REF_TYPE='USER'
	</update>
	
	
		<delete id="viewResourceMappingDAO.UserCopyDelete"  parameterClass="viewResourceRoleVO">
				 DELETE FROM
					RFC_COMTNVIEWRESOURCEROLE
				WHERE  
					REF_ID = #refId#
				
	</delete>
	
		<select id="viewResourceMappingDAO.selectRoleUserList" parameterClass="viewResourceRoleVO"  resultClass="viewResourceRoleVO">
			          	SELECT
							  CATEGORY  category ,
							  REF_ID  refId,
							  MASK  mask,
							  PERMISSIONS  permissions,
							  REF_TYPE  refType,
							  SGROUP_ID	sgroupId,
							  (select   USER_SE  from  RFC_COMVNUSERMASTER where  USER_ID =A.REF_ID )  userSe,
							  (select   UNIQ_ID  from  RFC_COMVNUSERMASTER where  USER_ID =A.REF_ID )  uniqId,
							  CASE  REF_TYPE 
			                    WHEN  'USER'  THEN (SELECT  USER_NM  from  RFC_COMVNUSERMASTER where  USER_ID =A.REF_ID )
			                    WHEN  'ROLE'  THEN (SELECT ROLE_NM FROM RFC_COMTNROLES WHERE ROLE_ID = A.REF_ID)
			                    WHEN  'OFFICE'  THEN (SELECT OFFICE_NM FROM RFC_COMTCOFFICE WHERE OFFICE_CD =  A.REF_ID)
			                    ELSE ''
			                 END  userNm,
							  
							  (select MENU_NM from RFC_COMTNMENU where MENU_CD = A.CATEGORY) menunm,
							  CREATE_DATE  createDate
						FROM
						     RFC_COMTNVIEWRESOURCEROLE A
						WHERE
			          	 	CATEGORY=#category# 
	</select>
			
	<delete id="viewResourceMappingDAO.UserRoleCopyDelete"  parameterClass="viewResourceRoleVO">
				 DELETE FROM
					RFC_COMTNVIEWRESOURCEROLE
				WHERE
					CATEGORY = #category#
					AND
					REF_ID = #refId#
					AND
					REF_TYPE = 'USER'
	</delete>	
</sqlMap>