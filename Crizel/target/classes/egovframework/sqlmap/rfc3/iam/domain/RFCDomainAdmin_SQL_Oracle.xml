<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="RFCDomainAdmin">
	     <typeAlias  alias="egovMap"      type = "egovframework.rte.psl.dataaccess.util.EgovMap"/>
	     
	     <cacheModel type="${Globals.ibatis.default.cache}" id="RFCDomainAdminCache" readOnly="true" serialize="false">
	     	 <flushInterval hours="24" />
	     	 <flushOnExecute statement="domainDAO.insertDomainAdmin"/>
	     	 <flushOnExecute statement="domainDAO.deleteDomainAdmin"/>
       </cacheModel>
       
       
	<select id="domainAdminDAO.selectDomainAdminList" parameterClass="egovframework.rfc3.iam.vo.DomainVO"  resultClass="egovframework.rfc3.iam.vo.DomainVO"  cacheModel="RFCDomainAdminCache">
			      SELECT 
			       		SGROUP_ID sgroupId,
       					DOMAIN_ID domainId,
       					USER_ID userId,
       					(select  DOMAIN_NM from  RFC_COMTNDOMAIN  where  DOMAIN_ID =A.DOMAIN_ID )  domainNm,
       					(select  USER_NM  from  RFC_COMVNUSERMASTER  where  USER_ID =A.USER_ID )  userNm
  				   FROM 
  					   RFC_COMTNDOMAIN_ADMIN  A
  					WHERE
  					  SGROUP_ID=#sgroupId# and DOMAIN_ID=#domainId# 
  					  order by  CREATE_DATE asc
  					
	</select>
	<select id="domainAdminDAO.selectDomainUserAdminList" parameterClass="egovframework.rfc3.iam.vo.DomainVO"  resultClass="egovframework.rfc3.iam.vo.DomainVO" cacheModel="RFCDomainAdminCache">
			      SELECT 
			       		SGROUP_ID sgroupId,
       					DOMAIN_ID domainId,
       					USER_ID userId,
       					   (select  DOMAIN_NM from  RFC_COMTNDOMAIN  where  DOMAIN_ID =A.DOMAIN_ID )  domainNm
  				   FROM 
  					   RFC_COMTNDOMAIN_ADMIN  A
  					WHERE
  					  SGROUP_ID=#sgroupId#  and USER_ID=#userId#
  					  order by  CREATE_DATE asc
  					
	</select>
	<select id="domainDAO.selectMyAdminDomainCnt"  parameterClass="domainVO"  resultClass="int"  cacheModel="RFCDomainAdminCache">
					SELECT
							   count(*) totcnt 
						FROM
						      RFC_COMTNDOMAIN_ADMIN 
						WHERE  
						    SGROUP_ID=#sgroupId#  and USER_ID=#userId# and  DOMAIN_ID=#domainId# 
	</select>
	<insert id="domainDAO.insertDomainAdmin"  parameterClass="egovframework.rfc3.iam.vo.DomainAdminVO">
				    INSERT INTO  RFC_COMTNDOMAIN_ADMIN ( 
				        SGROUP_ID,
				        DOMAIN_ID,
				        USER_ID ,
				        CREATE_DATE
				        ) VALUES (
				        #sgroupId#,
				        #domainId#,
				        #userId#,
				        #createDate#
				         )
	</insert>
	<delete id="domainDAO.deleteDomainAdmin"  parameterClass="egovframework.rfc3.iam.vo.DomainAdminVO">
					DELETE  FROM  
					  RFC_COMTNDOMAIN_ADMIN
					  WHERE  
					  SGROUP_ID=#sgroupId# and DOMAIN_ID=#domainId# and USER_ID=#userId#
	</delete>
	<select id="domainAdminDAO.selectSearchDomainUserAdminList" parameterClass="egovframework.rfc3.iam.vo.DomainVO"  resultClass="egovframework.rfc3.iam.vo.DomainVO" cacheModel="RFCDomainAdminCache">
			      SELECT 
			       		DOMAIN.DOMAIN_ID  domainId,
					    DOMAIN.SGROUP_ID  sgroupId,
					    (select  SGROUP_NM from  RFC_COMTNSITEGROUP where  SGROUP_ID = DOMAIN.SGROUP_ID )  sgroupNm,
					    DOMAIN.DOMAIN domain,
					    DOMAIN.PORT port,
					    DOMAIN.DOMAIN_NM domainNm,
					    DOMAIN.IS_USE  isUse,
					    DOMAIN.IS_SSO_LOGIN  isSsoLogin,
					    DOMAIN.IS_SEARCH  isSearch,
					    DOMAIN.IS_SECURE isSecure,
					    DOMAIN.SECURE_PORT securePort,
					    DOMAIN.CONTEXT_PATH contextPath
  				   FROM 
  					   RFC_COMTNDOMAIN_ADMIN ADMIN LEFT JOIN RFC_COMTNDOMAIN DOMAIN
					ON
						ADMIN.DOMAIN_ID = DOMAIN.DOMAIN_ID
  					WHERE 
  						DOMAIN.IS_USE='1' AND DOMAIN.IS_SEARCH='true' AND 
						ADMIN.SGROUP_ID=#sgroupId#  AND ADMIN.USER_ID=#userId#
					ORDER BY 
						DOMAIN.CREATE_DATE asc
  					
	</select>

</sqlMap>