<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="RFCMenu">
	 <typeAlias  alias="egovMap" type = "egovframework.rte.psl.dataaccess.util.EgovMap"/>
     <typeAlias  alias="adminMenuVO" type = "egovframework.rfc3.iam.vo.AdminMenuVO"/>
     <typeAlias  alias="adminMenuOfficeVO" type = "egovframework.rfc3.iam.vo.AdminMenuOfficeVO"/>
     
     <cacheModel type="${Globals.ibatis.default.cache}" id="RFCAdminMenuCache" readOnly="true" serialize="false">
     	<flushInterval hours="24" />
     	<flushOnExecute statement="adminMenuDAO.insertAdminMenu"/>
     	<flushOnExecute statement="adminMenuDAO.updateAdminMenu"/>
     	<flushOnExecute statement="adminMenuDAO.deleteAdminMenu"/>
     	
     	<flushOnExecute statement="adminMenuDAO.insertAdminMenuOffice"/>
     	<flushOnExecute statement="adminMenuDAO.updateAdminMenuOffice"/>
     	<flushOnExecute statement="adminMenuDAO.deleteAdminMenuOffice"/>
     </cacheModel>
     
	<select id="adminMenuDAO.selectAdminMenuList"  parameterClass="adminMenuVO" resultClass="adminMenuVO">
		SELECT ADM_SID admSid, 
		       GROUP_IDX groupIdx, 
		       ORDER_SID orderSid, 
		       NAME name, 
		       URL url, 
		       IS_USE isUse, 
		       URL_PATTERN urlPattern, 
		       ENG_NAME engName, 
		       COMPONENT_ID componentId 
		  FROM 
		  	<isEqual property="isTabUse" compareValue="false">
		  		RFC_COMTNADMINMENU
		  	</isEqual>
		  	<isEqual property="isTabUse" compareValue="true">
		  		(SELECT ADM_SID, 
		              GROUP_IDX, 
		              ORDER_SID, 
		              NAME, 
		              URL, 
		              IS_USE, 
		              URL_PATTERN, 
		              ENG_NAME, 
		              COMPONENT_ID 
		         FROM RFC_COMTNADMINMENU MENU 
		        WHERE ORDER_SID = 0 
		           UNION ALL 
		       SELECT ADM_SID, 
		              GROUP_IDX, 
		              ORDER_SID, 
		              NAME, 
		              URL, 
		              IS_USE, 
		              URL_PATTERN, 
		              ENG_NAME, 
		              (SELECT COMPONENT_ID 
		                FROM RFC_COMTNADMINMENU 
		               WHERE GROUP_IDX = MENU.GROUP_IDX 
		                     AND ORDER_SID = 0 
		              ) COMPONENT_ID 
		         FROM RFC_COMTNADMINMENU MENU 
		        WHERE ORDER_SID != 0 
		       ) 
		  	</isEqual>   
			WHERE 
		      1=1
		      <isNotEmpty prepend="AND" property="isUse" >
		         IS_USE  = #isUse#
		      </isNotEmpty>	
		      <isNotEmpty prepend="AND" property="componentId" >
		         COMPONENT_ID  = #componentId#
		      </isNotEmpty>
		      <isNotEmpty prepend="AND" property="componentId" >
		         ((ORDER_SID = 0 AND COMPONENT_ID  = #componentId#) OR ORDER_SID > 0)
		      </isNotEmpty>	       
		    ORDER BY GROUP_IDX ASC,
		           ORDER_SID ASC
	</select>
	
		<select id="adminMenuDAO.selectGroupAdmList"  parameterClass="int"    resultClass="adminMenuVO" >
						select 
					       ADM_SID admSid,
					       GROUP_IDX groupIdx,
					       ORDER_SID orderSid,
					       NAME name,
					       URL url,
					       IS_USE isUse,
					       URL_PATTERN  urlPattern,
					       ENG_NAME engName
					  from
					  	  RFC_COMTNADMINMENU
					  where 
					      IS_USE  = 'true'  and  GROUP_IDX =#groupIdx#  AND ORDER_SID &gt; 0
					      order by  GROUP_IDX asc,ORDER_SID asc
	</select>
	
    <select id="adminMenuDAO.subAdminMenuListCnt"  parameterClass="adminMenuVO" resultClass="int" cacheModel="RFCAdminMenuCache" >
						select 
					      count(*) cnt
					  from
					  	  RFC_COMTNADMINMENU
					  where 
					    1=1 AND
					    GROUP_IDX=#groupIdx# AND 
					    ORDER_SID > 0
					    <isNotEmpty prepend="AND" property="isUse" >
			          		 IS_USE  = #isUse#
			            </isNotEmpty>	
					   
	 </select>
	 
	 <select id="adminMenuDAO.getOrderSidDuplicateCnt"  parameterClass="adminMenuVO" resultClass="int"  cacheModel="RFCAdminMenuCache">
						select 
					      count(*) cnt
					  from
					  	  RFC_COMTNADMINMENU
					  where 
					     ADM_SID !=#admSid# and  GROUP_IDX=#groupIdx# and ORDER_SID=#orderSid#
	 </select>
	 
	 
	 <select id="adminMenuDAO.getMaxGroupIdx"   resultClass="int" cacheModel="RFCAdminMenuCache" >
						select 
					      max(GROUP_IDX) groupIdx
					  from
					  	  RFC_COMTNADMINMENU
	 </select>
	 
	  <select id="adminMenuDAO.getMaxOrderSid"  parameterClass="int" resultClass="int"  cacheModel="RFCAdminMenuCache">
						select 
					      max(ORDER_SID) orderSid
					  from
					  	  RFC_COMTNADMINMENU
					  where 
					  	 GROUP_IDX=#groupIdx#
	 </select>
	 
	 
	 <select id="adminMenuDAO.getAdminMenuInfo"  parameterClass="java.lang.String"  resultClass="adminMenuVO"  cacheModel="RFCAdminMenuCache">
						select 
					       ADM_SID admSid,
					       GROUP_IDX groupIdx,
					       ORDER_SID orderSid,
					       NAME name,
					       URL url,
					       IS_USE isUse,
					       URL_PATTERN  urlPattern,
					       ENG_NAME engName,
					       COMPONENT_ID  componentId
					  from
					  	  RFC_COMTNADMINMENU
					  where 
					     ADM_SID =#admSid#
	</select>
	
	
	<select id="adminMenuDAO.getAdminMenuInfoUrl"  parameterClass="java.lang.String"  resultClass="adminMenuVO" >
						select 
					       ADM_SID admSid,
					       GROUP_IDX groupIdx,
					       ORDER_SID orderSid,
					       NAME name,
					       URL url,
					       IS_USE isUse,
					       URL_PATTERN  urlPattern,
					       ENG_NAME engName,
					       COMPONENT_ID  componentId
					  from
					  	  RFC_COMTNADMINMENU
					  where 1=1 AND INSTR(URL,#url#)>0
	</select>
	
	
	
	 <insert id="adminMenuDAO.insertAdminMenu" parameterClass="adminMenuVO" >
					insert into  RFC_COMTNADMINMENU 
						( ADM_SID,
						  GROUP_IDX,
						  ORDER_SID,
						  NAME,
						  URL,
						  IS_USE ,
						  URL_PATTERN,
						  ENG_NAME,
						  COMPONENT_ID
					  ) values (
					     #admSid# ,
					     #groupIdx# ,
					     #orderSid# ,
					     #name# ,
					     #url# ,
					     #isUse# ,
					     #urlPattern#,
					     #engName#,
					     #componentId#
					   )
	</insert>
	
	<update id="adminMenuDAO.updateAdminMenu" parameterClass="adminMenuVO" >
					update   RFC_COMTNADMINMENU
						set  ORDER_SID = #orderSid#, 
						NAME = #name#, 
						URL = #url#, 
						IS_USE = #isUse# ,
						URL_PATTERN=#urlPattern#,
						ENG_NAME=#engName#,
						COMPONENT_ID  = #componentId#
					where 
						  ADM_SID=#admSid#
	</update>
	
	<delete id="adminMenuDAO.deleteAdminMenu"  parameterClass="java.lang.String" >
				delete from RFC_COMTNADMINMENU where ADM_SID=#admSid#
	</delete>
	
	
	<select id="adminMenuDAO.adminMenuOfficeCnt"  parameterClass="adminMenuOfficeVO" resultClass="int" cacheModel="RFCAdminMenuCache" >
						select 
					      count(*) cnt
					  from
					  	  RFC_COMTNADMINMENU_OFFICE
					  where 
					    AUTH_SID = #authSid#
					   
	 </select>
	 
	 <select id="adminMenuDAO.selectAdminMenuAuthList"  parameterClass="String" resultClass="adminMenuOfficeVO" cacheModel="RFCAdminMenuCache" >
						select 
							AUTH_SID authSid,
					       ADM_SID admSid,
					       OFFICE_CD officeCd,
					       OFFICE_CD2 officeCd2,
					       OFFICE_CD3 officeCd3,
					       OFFICE_CD4 officeCd4,
					       SGROUP_ID sgroupId 
					  from
					  	  RFC_COMTNADMINMENU_OFFICE where ADM_SID=#admSid#
					  order by 
					     AUTH_SID asc
	</select>
	 
	 <select id="adminMenuDAO.getAdminMenuOffice"  parameterClass="long"  resultClass="adminMenuOfficeVO"  cacheModel="RFCAdminMenuCache">
						select 
						AUTH_SID authSid,
					       ADM_SID admSid,
					       SGROUP_ID sgroupId,
					       OFFICE_CD officeCd,
					       OFFICE_CD2 officeCd2,
					       OFFICE_CD3 officeCd3,
					       OFFICE_CD4 officeCd4 
					  from
					  	  RFC_COMTNADMINMENU_OFFICE
					  where 
					     AUTH_SID =#authSid#
	</select>
	 
	 <insert id="adminMenuDAO.insertAdminMenuOffice" parameterClass="adminMenuOfficeVO" >
					insert into  RFC_COMTNADMINMENU_OFFICE 
						( AUTH_SID,ADM_SID,SGROUP_ID,OFFICE_CD,OFFICE_CD2,OFFICE_CD3,OFFICE_CD4
					  ) values (
					    #authSid#,#admSid#,#sgroupId#,#officeCd#,#officeCd2#,#officeCd3#,#officeCd4#
					   )
	</insert>
	
	<update id="adminMenuDAO.updateAdminMenuOffice" parameterClass="adminMenuOfficeVO" >
					update   RFC_COMTNADMINMENU_OFFICE
						set  SGROUP_ID=#sgroupId#,OFFICE_CD=#officeCd#,OFFICE_CD2=#officeCd2#,OFFICE_CD3=#officeCd3#,OFFICE_CD4=#officeCd4# 
					where 
						  AUTH_SID=#authSid#
	</update>
	
	<delete id="adminMenuDAO.deleteAdminMenuOffice"  parameterClass="long" >
				delete from RFC_COMTNADMINMENU_OFFICE where AUTH_SID=#authSid#
	</delete>
	
	
	
</sqlMap>