<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="RFCOfficePart">
	 <typeAlias  alias="egovMap"      type = "egovframework.rte.psl.dataaccess.util.EgovMap"/>
     <typeAlias  alias="officePartVO" type = "egovframework.rfc3.office.vo.OfficePartVO"/>
      
     <resultMap id="officepart" class="egovframework.rfc3.office.vo.OfficePartVO">
        <result property="officePtSid" column="officePtSid" />
         <result property="sgroupId" column="sgroupId" />
        <result property="officeCd" column="officeCd" />
        <result property="userId" column="userId" />
        <result property="userNm" column="userNm" />
        <result property="officeTel" column="officeTel" />
        <result property="officeFax" column="officeFax" />
        <result property="officePtIx" column="officePtIx"/>
        <result property="officePtIsUse" column="officePtIsUse"/>
        <result property="ofcpsNm" column="ofcpsNm"/>
        <result property="orgnztId" column="orgnztId"/>
        <result property="emailAdres" column="emailAdres"/>
        <result property="emplyrNm" column="emplyrNm"/>
        <result property="officeNms" column="officeNms"/>
        <result property="officePtMemo" column="officePtMemo"/>
    </resultMap>
    <resultMap id="officepartJson" class="egovframework.rfc3.office.vo.OfficePartVO">
        <result property="officePtSid" column="officePtSid" />
         <result property="sgroupId" column="sgroupId" />
        <result property="officeCd" column="officeCd" />
        <result property="userId" column="userId" />
        <result property="userNm" column="userNm" />
        <result property="officeTel" column="officeTel" />
        <result property="officeFax" column="officeFax" />
        <result property="officePtIx" column="officePtIx"/>
        <result property="officePtIsUse" column="officePtIsUse"/>
        <result property="ofcpsNm" column="ofcpsNm"/>
        <result property="orgnztId" column="orgnztId"/>
        <result property="emailAdres" column="emailAdres"/>
        <result property="emplyrNm" column="emplyrNm"/>
        <result property="officeNms" column="officeNms"/>
        <result property="officePtMemo" column="officePtMemo"/>
        <result property="phoneFrist" column="phoneFrist"/>
        <result property="phoneMiddle" column="phoneMiddle"/>
        <result property="phoneEnd" column="phoneEnd"/>
    </resultMap>
    
    <resultMap id="officepartvos" class="egovframework.rfc3.office.vo.OfficePartVO">
        <result property="officePtSid" column="officePtSid" />
         <result property="sgroupId" column="sgroupId" />
        <result property="officeCd" column="officeCd" />
        <result property="userId" column="userId" />
        <result property="userNm" column="userNm" />
        <result property="officeTel" column="officeTel" />
        <result property="officeFax" column="officeFax" />
        <result property="officePtIx" column="officePtIx"/>
        <result property="officePtIsUse" column="officePtIsUse"/>
        <result property="ofcpsNm" column="ofcpsNm"/>
        <result property="orgnztId" column="orgnztId"/>
         <result property="emailAdres" column="emailAdres"/>
         <result property="phoneFrist" column="phoneFrist"/>
         <result property="phoneMiddle" column="phoneMiddle"/>
         <result property="phoneEnd" column="phoneEnd"/>
        <result property="emplyrNm" column="emplyrNm"/>
         <result property="officeNms" column="officeNms"/>
        <result property="officePtMemo" column="officePtMemo"/>
    </resultMap>

      <cacheModel type="${Globals.ibatis.default.cache}" id="RFCOfficePartCache" readOnly="true" serialize="false">
     	<flushInterval hours="24" />
     	<flushOnExecute statement="OfficePartDAO.insertOfficePart"/>
     	<flushOnExecute statement="OfficePartDAO.deleteOfficePart"/>
     	<flushOnExecute statement="OfficePartDAO.deleteOfficePartUser"/>
     	<flushOnExecute statement="OfficePartDAO.deleteUserOfficePart"/>
     	<flushOnExecute statement="OfficePartDAO.updateOfficePart"/>
     	<flushOnExecute statement="OfficePartDAO.updateOfficePart2"/>
     	<flushOnExecute statement="OfficePartDAO.updateUser"/>
     	<flushOnExecute statement="OfficePartDAO.updateOfficePartUser"/>
     	<flushOnExecute statement="OfficePartDAO.updateUserOfficePart"/>
     	<flushOnExecute statement="OfficePartDAO.updateOfficePartSort"/>
     </cacheModel>
   
    
    <select id="OfficePartDAO.selectOfficePartListTotCnt"  parameterClass="officePartVO" resultClass="int"  cacheModel="RFCOfficePartCache">
						SELECT 
								COUNT(*) totcnt
						 FROM   RFC_COMTCOFFICE_PART
						
						<dynamic prepend="WHERE">
							<isNotEmpty prepend="AND"  property="sgroupId" >
				          		   SGROUP_ID   = #sgroupId#
				            </isNotEmpty>
				             <isNotEmpty prepend="AND" property="searchOffice" >
			          		    OFFICE_CD  LIKE  '$searchOffice$%'
				            </isNotEmpty>
				            <isNotEmpty  property="searchOfficeCondition" >
			          		   <isNotEmpty prepend="AND" property="searchKeyword" >
			          		    $searchOfficeCondition$  LIKE  '%$searchKeyword$%'
			            		</isNotEmpty>
			               </isNotEmpty>
				         </dynamic>
				       
	</select>

	<select id="OfficePartDAO.selectOfficePartList" parameterClass="officePartVO"  resultMap="officepart"  cacheModel="RFCOfficePartCache">
			          SELECT 
											OFFICE_PT_SID			officePtSid,
											SGROUP_ID					sgroupId,
										    OFFICE_CD					officeCd,
										    USER_ID							userId,
										    USER_NM						userNm,
										    OFFICE_TEL					officeTel,
										    OFFICE_FAX					officeFax,
										    OFFICE_PT_IX				officePtIx,
										    OFFICE_PT_IS_USE		officePtIsUse,
										    (select OFCPS_NM FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) ofcpsNm,
           									(select ORGNZT_ID FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) orgnztId,
           									(select EMAIL_ADRES FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) emailAdres,
           									(select EMPLYR_NM FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) emplyrNm,
           									(SELECT OFFICE_SORT_IX FROM RFC_COMTCOFFICE WHERE SGROUP_ID = A.SGROUP_ID AND OFFICE_CD = A.OFFICE_CD ) officesortix,
                                             case
							(select OFFICE_DP from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                                      when 4 then
                                       concat(
                                        (
                                        	select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD))))
                                        ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)))
                                       ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD))
                                      ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                                        )
                                        when 3 then
                                       concat(
                                        (  
                                        select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)))
                                   ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD))
                                      ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                                        )
                                        when 2 then
                                       concat(
                                        (
           						 	 	select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD))
                                      ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                                        )
                                     	when 1 then
										(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                             end 
	                          as officeNms,
	                             (SELECT OFFICE_DP 
							         FROM RFC_COMTCOFFICE 
							        WHERE SGROUP_ID = A.SGROUP_ID 
							              AND OFFICE_CD = A.OFFICE_CD 
							       ) officeDp, 
							 OFFICE_PT_MEMO		officePtMemo
							 
					FROM  RFC_COMTCOFFICE_PART A
					<dynamic  prepend="WHERE">
						<isNotEmpty prepend="AND"  property="sgroupId" >
			          		   SGROUP_ID   = #sgroupId#
			            </isNotEmpty>
			            <isNotEmpty prepend="AND" property="searchOffice" >
			          		   OFFICE_CD  LIKE  '$searchOffice$%'
			            </isNotEmpty>
			            <isNotEmpty property="searchOfficeCondition" >
			          		   <isNotEmpty prepend="AND" property="searchKeyword" >
			          		    $searchOfficeCondition$  LIKE  '%$searchKeyword$%'
			            		</isNotEmpty>
			            </isNotEmpty>
			       </dynamic>
		           <isNotEmpty  property="orderField" >
		            	  ORDER BY  $orderField$   $orderSort$
		           </isNotEmpty>
		           
		           LIMIT #recordCountPerPage# OFFSET #firstIndex#
	   </select>	
	   
	   <select id="OfficePartDAO.selectOfficePartClientListTotCnt"  parameterClass="officePartVO" resultClass="int">
			         SELECT 
							count(*) as cnt
					FROM  
						RFC_COMTCOFFICE_PART A INNER JOIN RFC_COMTCOFFICE B
				   ON A.OFFICE_CD = B.OFFICE_CD
				   where  
				        1=1  and 	A.OFFICE_PT_IS_USE ='1' and A.USER_ID != '' AND B.OFFICE_IS_USE = 1
				     <isNotEmpty  property="officeCd" prepend="AND">
				        A.OFFICE_CD  LIKE  '$officeCd$%'
				     </isNotEmpty>  
				      <isEmpty  property="officeCd" prepend="AND">
				        A.OFFICE_CD  =''
				     </isEmpty>  
				     <isNotEmpty property="searchOfficeCondition" >
	          		     <isNotEmpty prepend="AND" property="searchKeyword" >
	          		       $searchOfficeCondition$  LIKE  '%' || #searchKeyword# || '%'
	            		 </isNotEmpty>
			         </isNotEmpty>   
	   </select>	
	
		<select id="OfficePartDAO.selectOfficePartClientList" parameterClass="officePartVO"  resultMap="officepart"  cacheModel="RFCOfficePartCache">
			          SELECT 
											A.OFFICE_PT_SID			officePtSid,
											A.SGROUP_ID					sgroupId,
										    A.OFFICE_CD					officeCd,
										    A.USER_ID							userId,
										    A.USER_NM						userNm,
										    A.OFFICE_TEL					officeTel,
										    A.OFFICE_FAX					officeFax,
										    A.OFFICE_PT_IX				officePtIx,
										    A.OFFICE_PT_IS_USE		officePtIsUse,
										    (select OFCPS_NM FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) ofcpsNm,
           									(select ORGNZT_ID FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) orgnztId,
           									(select EMAIL_ADRES FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) emailAdres,
           									(select EMPLYR_NM FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) emplyrNm,
                                             case
							(select OFFICE_DP from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                                      when 4 then
                                       concat(
                                        (
                                        	select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD))))
                                        ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)))
                                       ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD))
                                      ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                                        )
                                        when 3 then
                                       concat(
                                        (  
                                        select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)))
                                   ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD))
                                      ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                                        )
                                        when 2 then
                                       concat(
                                        (
           						 	 	select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD))
                                      ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                                        )
                                     	when 1 then
										(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                             end 
	                          as officeNms,
							 A.OFFICE_PT_MEMO		officePtMemo
							 
					FROM  
						RFC_COMTCOFFICE_PART A INNER JOIN RFC_COMTCOFFICE B
				   ON A.OFFICE_CD = B.OFFICE_CD
				   where  
				        1=1  and 	A.OFFICE_PT_IS_USE ='1' and A.USER_ID != '' AND B.OFFICE_IS_USE = 1
				     <isNotEmpty  property="officeCd" prepend="AND">
				        A.OFFICE_CD  LIKE  '$officeCd$%'
				     </isNotEmpty>  
				      <isEmpty  property="officeCd" prepend="AND">
				        A.OFFICE_CD  =''
				     </isEmpty>
				     <isNotEmpty property="searchOfficeCondition" >
	          		     <isNotEmpty prepend="AND" property="searchKeyword" >
	          		       $searchOfficeCondition$  LIKE  '%' || #searchKeyword# || '%'
	            		 </isNotEmpty>
			         </isNotEmpty>
				     
				     ORDER BY  B.OFFICE_SORT_IX,A.OFFICE_CD, A.OFFICE_PT_IX  ASC   
				
				     <isEqual   property="partListplug" compareValue="true" >
		              		LIMIT #recordCountPerPage# OFFSET #firstIndex#
		             </isEqual>          
	</select>	
    
    <insert id="OfficePartDAO.insertOfficePart" parameterClass="officePartVO">
				INSERT INTO 
				  RFC_COMTCOFFICE_PART  (
					OFFICE_PT_SID,
					SGROUP_ID,
					USER_NM,
				    OFFICE_CD,
				    USER_ID,	
				    OFFICE_TEL,
				    OFFICE_FAX,
				    OFFICE_PT_IX,
				    OFFICE_PT_IS_USE,
				    OFFICE_PT_MEMO
					) VALUES (
					#officePtSid#,
					#sgroupId#, 
					<isNotEmpty  property="userNm">
				    	#userNm#,
				    </isNotEmpty>
				    <isEmpty  property="userNm">
				    	#emplyrNm#,
				    </isEmpty>					
					#officeCd#,
					#userId#,
					#officeTel#,
					#officeFax#,
					#officePtIx#,
					$officePtIsUse$,
					#officePtMemo#
				)
	</insert>
	
	
	
	<delete id="OfficePartDAO.deleteOfficePart" parameterClass="officePartVO" >
		DELETE  FROM RFC_COMTCOFFICE_PART
					WHERE  OFFICE_PT_SID=#officePtSid#
	</delete>
	
	<delete id="OfficePartDAO.deleteUserOfficePart" parameterClass="officePartVO" >
		DELETE  FROM RFC_COMTCOFFICE_PART
					WHERE  USER_ID=#userId#
	</delete>
    
    <select id="OfficePartDAO.selectOfficePartListVO" parameterClass="long"  resultMap="officepartvos" >
			          SELECT 
									    OFFICE_PT_SID			officePtSid,
									    SGROUP_ID					sgroupId,
									    OFFICE_CD					officeCd,
									    USER_ID							userId,
									    USER_NM						userNm,
									    OFFICE_TEL					officeTel,
									    OFFICE_FAX					officeFax,
									    OFFICE_PT_IX				officePtIx,
									    OFFICE_PT_IS_USE		officePtIsUse,
									    (select OFCPS_NM FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) ofcpsNm,
           								(select ORGNZT_ID FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) orgnztId,
           								(select EMPLYR_NM FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) emplyrNm,
           								(select EMAIL_ADRES FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) emailAdres,
       									(select MOBLFRIST_NO From RFC_COMTNMANAGER  WHERE EMPLYR_ID = A.USER_ID)phoneFrist,
                                        (select MOBLMIDDLE_NO From RFC_COMTNMANAGER  WHERE EMPLYR_ID = A.USER_ID)phoneMiddle,
                                        (select MOBLEND_NO From RFC_COMTNMANAGER  WHERE EMPLYR_ID = A.USER_ID)phoneEnd,		
                                        (select USER_AUTH_CODE From RFC_COMTNMANAGER  WHERE EMPLYR_ID = A.USER_ID)userAuthCode,	
                                         ''    as officeNms,
									    OFFICE_PT_MEMO		officePtMemo
									   
					FROM   RFC_COMTCOFFICE_PART A
					WHERE
			            OFFICE_PT_SID = $officePtSid$
			          GROUP BY OFFICE_PT_SID    	 				 
	</select>	
	
	<select id="OfficePartDAO.selectOfficePartVOUserList" parameterClass="String"  resultMap="officepart"  cacheModel="RFCOfficePartCache">
			          SELECT 
									    OFFICE_PT_SID			officePtSid,
									    SGROUP_ID					sgroupId,
									    OFFICE_CD					officeCd,
									    USER_ID							userId,
									    USER_NM						userNm,
									    OFFICE_TEL					officeTel,
									    OFFICE_FAX					officeFax,
									    OFFICE_PT_IX				officePtIx,
									    OFFICE_PT_IS_USE		officePtIsUse,
									    (select OFCPS_NM FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) ofcpsNm,
           								(select ORGNZT_ID FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) orgnztId,
           								(select EMPLYR_NM FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) emplyrNm,
           								(select EMAIL_ADRES FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) emailAdres,
                                         ''    as officeNms,
									    OFFICE_PT_MEMO		officePtMemo
									   
					FROM   RFC_COMTCOFFICE_PART A
					WHERE
			            	 				 USER_ID = #userId#
			        <!-- GROUP BY OFFICE_PT_SID  -->    	 				 
	</select>
    
    <!-- 
    OFFICE_PT_SID			officePtSid
    OFFICE_CD					officeCd
    USER_ID							userId
    OFFICE_TEL					officeTel
    OFFICE_FAX					officeFax
    OFFICE_PT_IX				officePtIx
    OFFICE_PT_IS_USE		officePtIsUse
    OFFICE_PT_MEMO		officePtMemo
     -->
     <!-- 담당관리 업데이트 -->
     <update id="OfficePartDAO.updateOfficePart" parameterClass="officePartVO">
     	UPDATE
     					RFC_COMTCOFFICE_PART
     	SET
						    OFFICE_CD=#officeCd#,
						    USER_ID	=#userId#,
						    <isNotEmpty  property="emplyrNm">
						    	USER_NM = #emplyrNm#,
						    </isNotEmpty>
						    OFFICE_TEL=#officeTel#,
						    OFFICE_FAX=#officeFax#,
						    OFFICE_PT_IX=	#officePtIx#,
						    OFFICE_PT_IS_USE=$officePtIsUse$,
						    OFFICE_PT_MEMO=	#officePtMemo#
		WHERE
							OFFICE_PT_SID = #officePtSid#
     					
     </update>
     
     <!-- 업무회원 수정시 담당관리 수정  -->
     <update id="OfficePartDAO.updateOfficePart2" parameterClass="officePartVO">
    			UPDATE
    					RFC_COMTCOFFICE_PART
    			SET
					    OFFICE_TEL=#officeTel#,
					    OFFICE_FAX=#officeFax#,
					    OFFICE_PT_IX=	#officePtIx#
			WHERE
						OFFICE_PT_SID = #officePtSid#
    					
    	</update>
     
     <!-- 담당관리 직위 수정  -->
     <update id="OfficePartDAO.updateUser" parameterClass="officePartVO">
     		UPDATE
     					RFC_COMTNMANAGER
     	SET
     						ORGNZT_ID=#officeCd#,
						    EMAIL_ADRES=#emailAdres#,
						    OFCPS_NM	=#ofcpsNm#
		WHERE
							EMPLYR_ID = #userId#
     </update>
    <!-- 담당관리 회원id 정보로 카운트 리턴 --> 
	<select id="OfficePartDAO.selectOfficePartUsertCnt"  parameterClass="officePartVO" resultClass="int"  cacheModel="RFCOfficePartCache">
			SELECT 
					COUNT(*) totcnt
			 FROM   RFC_COMTCOFFICE_PART
			WHERE	
			 USER_ID = #userId#
			           
	</select>
	<!-- 업무관리 담당관리 조직도 수정 -->
 	<update id="OfficePartDAO.updateOfficePartUser" parameterClass="officePartVO">
 			UPDATE
 					RFC_COMTCOFFICE_PART
 			SET
			    OFFICE_CD=#officeCd#    
			WHERE
				USER_ID = #userId#
 	</update>
 		
 	<!-- 업무관리 조직도 적용시 담당관리 초기화  -->
	<update id="OfficePartDAO.updateUserOfficePart" parameterClass="officePartVO">
 			UPDATE
 					RFC_COMTCOFFICE_PART
 			SET
		    	USER_ID	=''
			WHERE
				USER_ID = #userId#
 	</update>
 	
 	<!-- 업무관리 조직도 수정시 정렬   -->
	<update id="OfficePartDAO.updateOfficePartSort" parameterClass="officePartVO">
 			UPDATE
 					RFC_COMTCOFFICE_PART
 			SET
		    	 OFFICE_PT_IX=	#officePtIx#
			WHERE
				OFFICE_PT_SID = #officePtSid#			   
 	</update>
 	
 	<select id="OfficePartDAO.searchOfficePart"  parameterClass="officePartVO" resultClass="officePartVO"  cacheModel="RFCOfficePartCache">
		SELECT OFFICE_PT_SID officePtSid, 
		       PART.SGROUP_ID sgroupId, 
		       PART.USER_NM userNm, 
		       PART.OFFICE_CD officeCd, 
		       PART.USER_ID userId, 
		       PART.OFFICE_TEL officeTel, 
		       PART.OFFICE_FAX officeFax, 
		       PART.OFFICE_PT_IX officePtIx, 
		       PART.OFFICE_PT_IS_USE officePtIsUse, 
		       PART.OFFICE_PT_MEMO officePtMemo 
		FROM 
			RFC_COMTCOFFICE_PART PART INNER JOIN RFC_COMTCOFFICE OFFICE
		ON 
			PART.OFFICE_CD = OFFICE.OFFICE_CD
		WHERE
			OFFICE_PT_IS_USE = 1 AND OFFICE.OFFICE_IS_USE = 1 AND
			(
				1=0
				<isNotEmpty  property="userNm" prepend="OR">
					PART.USER_NM LIKE '%$userNm$%'
				</isNotEmpty>
				<isNotEmpty  property="officePtMemo" prepend="OR">
					PART.OFFICE_PT_MEMO LIKE '%$officePtMemo$%' 
				</isNotEmpty>
				<isNotEmpty  property="officeTel" prepend="OR">
					PART.OFFICE_TEL LIKE '%$officeTel$%' 
				</isNotEmpty>
				<isNotEmpty  property="officeFax" prepend="OR">
					PART.OFFICE_FAX LIKE '%$officeFax$%'
				</isNotEmpty>			
			) AND PART.SGROUP_ID = #sgroupId#			
		ORDER BY OFFICE_SORT_IX ASC, OFFICE_PT_IX ASC		
	</select>
	
	
	
	<select id="OfficePartDAO.selectOfficePartJsonList" parameterClass="officePartVO"  resultMap="officepartJson"  >
			          SELECT 
											A.OFFICE_PT_SID			officePtSid,
											A.SGROUP_ID					sgroupId,
										    A.OFFICE_CD					officeCd,
										    A.USER_ID							userId,
										    A.USER_NM						userNm,
										    A.OFFICE_TEL					officeTel,
										    A.OFFICE_FAX					officeFax,
										    A.OFFICE_PT_IX				officePtIx,
										    A.OFFICE_PT_IS_USE		officePtIsUse,
										    (select OFCPS_NM FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) ofcpsNm,
           									(select ORGNZT_ID FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) orgnztId,           									
           									(select EMPLYR_NM FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) emplyrNm,
                                            (select USER_AUTH_CODE From RFC_COMTNMANAGER  WHERE EMPLYR_ID = A.USER_ID)userAuthCode,
                                            <isEqual property="isAnother" compareValue="Echelon">
												<isEqual property="isEchelon" compareValue="true">
													ECL_DECRYPT(select EMAIL_ADRES FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) emailAdres,
		           									ECL_DECRYPT(select MOBLFRIST_NO From RFC_COMTNMANAGER  WHERE EMPLYR_ID = A.USER_ID)phoneFrist,
		                                            ECL_DECRYPT(select MOBLMIDDLE_NO From RFC_COMTNMANAGER  WHERE EMPLYR_ID = A.USER_ID)phoneMiddle,
		                                            ECL_DECRYPT(select MOBLEND_NO From RFC_COMTNMANAGER  WHERE EMPLYR_ID = A.USER_ID)phoneEnd,													
												</isEqual>
												<isNotEqual property="isEchelon" compareValue="true">								
													(select EMAIL_ADRES FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) emailAdres,
		           									(select MOBLFRIST_NO From RFC_COMTNMANAGER  WHERE EMPLYR_ID = A.USER_ID)phoneFrist,
		                                            (select MOBLMIDDLE_NO From RFC_COMTNMANAGER  WHERE EMPLYR_ID = A.USER_ID)phoneMiddle,
		                                            (select MOBLEND_NO From RFC_COMTNMANAGER  WHERE EMPLYR_ID = A.USER_ID)phoneEnd,
												</isNotEqual>
											</isEqual>
											<isEqual property="isAnother" compareValue="Damo">
													SCP.DEC_STR(#damoUser#,'RFC_COMTNMANAGER',#damoKey#,select EMAIL_ADRES FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) emailAdres,
													SCP.DEC_STR(#damoUser#,'RFC_COMTNMANAGER',#damoKey#,select MOBLFRIST_NO From RFC_COMTNMANAGER  WHERE EMPLYR_ID = A.USER_ID) phoneFrist,
													SCP.DEC_STR(#damoUser#,'RFC_COMTNMANAGER',#damoKey#,select MOBLMIDDLE_NO From RFC_COMTNMANAGER  WHERE EMPLYR_ID = A.USER_ID) phoneMiddle,
		                                            SCP.DEC_STR(#damoUser#,'RFC_COMTNMANAGER',#damoKey#,select MOBLEND_NO From RFC_COMTNMANAGER  WHERE EMPLYR_ID = A.USER_ID) phoneEnd,
											</isEqual>
											<isEmpty property="isAnother">								
													(select EMAIL_ADRES FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) emailAdres,
		           									(select MOBLFRIST_NO From RFC_COMTNMANAGER  WHERE EMPLYR_ID = A.USER_ID) phoneFrist,
		                                            (select MOBLMIDDLE_NO From RFC_COMTNMANAGER  WHERE EMPLYR_ID = A.USER_ID) phoneMiddle,
		                                            (select MOBLEND_NO From RFC_COMTNMANAGER  WHERE EMPLYR_ID = A.USER_ID) phoneEnd,
											</isEmpty>
                                             case
							(select OFFICE_DP from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                                      when 4 then
                                       concat(
                                        (
                                        	select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD))))
                                        ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)))
                                       ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD))
                                      ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                                        )
                                        when 3 then
                                       concat(
                                        (  
                                        select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)))
                                   ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD))
                                      ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                                        )
                                        when 2 then
                                       concat(
                                        (
           						 	 	select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD))
                                      ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                                        )
                                     	when 1 then
										(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                             end 
	                          as officeNms,
							 A.OFFICE_PT_MEMO		officePtMemo
							 
					FROM  
						RFC_COMTCOFFICE_PART A INNER JOIN RFC_COMTCOFFICE B
				   ON A.OFFICE_CD = B.OFFICE_CD
				   where  
				        1=1  and 	A.OFFICE_PT_IS_USE ='1' and A.USER_ID != '' AND B.OFFICE_IS_USE = 1
				     <isNotEmpty  property="officeCd" prepend="AND">
				        A.OFFICE_CD  LIKE  '$officeCd$%'
				     </isNotEmpty>  
				     <isNotEmpty  property="userNm" prepend="AND">
				       A.USER_NM  = #userNm#
				     </isNotEmpty> 

				     ORDER BY  B.OFFICE_SORT_IX,A.OFFICE_CD, A.OFFICE_PT_IX  ASC
				        
	</select>	
	
	<select id="officePartDAO.searchMyOfficeCms"  parameterClass="String"   resultClass="officePartVO" >
		SELECT
			A.OFFICE_PT_SID			officePtSid,
			A.SGROUP_ID				sgroupId,
			A.OFFICE_CD				officeCd,
			A.USER_ID				userId,
			A.USER_NM				userId,
			A.OFFICE_TEL			officeTel,
			A.OFFICE_PT_IX			officePtIx,
			A.OFFICE_PT_IS_USE		officePtIsUse,
            B.MENU_CD				menuCd,
            B.MENU_NM				menuNm
			From RFC_COMTCOFFICE_PART A INNER JOIN RFC_COMTNMENU B ON  A.OFFICE_PT_SID = B.OFFICE_PT_SID
		WHERE
		USER_ID = #userId#				
	</select>

	<delete id="OfficePartDAO.deleteOfficePartUser" parameterClass="String" >
		DELETE  FROM RFC_COMTCOFFICE_PART
		WHERE  USER_ID=#userId#
	</delete>
	
	<select id="officePartDAO.selectOfficePartListJson" parameterClass="officePartVO"  resultMap="officepart"  cacheModel="RFCOfficePartCache">
			          SELECT 
											OFFICE_PT_SID			officePtSid,
											SGROUP_ID					sgroupId,
										    OFFICE_CD					officeCd,
										    USER_ID							userId,
										    USER_NM						userNm,
										    OFFICE_TEL					officeTel,
										    OFFICE_FAX					officeFax,
										    OFFICE_PT_IX				officePtIx,
										    OFFICE_PT_IS_USE		officePtIsUse,
										    (select OFCPS_NM FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) ofcpsNm,
           									(select ORGNZT_ID FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) orgnztId,
           									(select EMAIL_ADRES FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) emailAdres,
           									(select EMPLYR_NM FROM RFC_COMTNMANAGER WHERE EMPLYR_ID = A.USER_ID) emplyrNm,
           									(SELECT OFFICE_SORT_IX FROM RFC_COMTCOFFICE WHERE SGROUP_ID = A.SGROUP_ID AND OFFICE_CD = A.OFFICE_CD ) officesortix,
                                             case
							(select OFFICE_DP from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                                      when 4 then
                                       concat(
                                        (
                                        	select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD))))
                                        ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)))
                                       ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD))
                                      ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                                        )
                                        when 3 then
                                       concat(
                                        (  
                                        select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)))
                                   ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD))
                                      ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                                        )
                                        when 2 then
                                       concat(
                                        (
           						 	 	select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD =(select OFFICE_PARENT_CD from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD))
                                      ,'/'
                                        ,(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                                        )
                                     	when 1 then
										(select OFFICE_NM from RFC_COMTCOFFICE where OFFICE_CD=A.OFFICE_CD)
                             end 
	                          as officeNms,
	                             (SELECT OFFICE_DP 
							         FROM RFC_COMTCOFFICE 
							        WHERE SGROUP_ID = A.SGROUP_ID 
							              AND OFFICE_CD = A.OFFICE_CD 
							       ) officeDp, 
							 OFFICE_PT_MEMO		officePtMemo
							 
					FROM  RFC_COMTCOFFICE_PART A
					<dynamic  prepend="WHERE">
						<isNotEmpty prepend="AND"  property="sgroupId" >
			          		   SGROUP_ID   = #sgroupId#
			            </isNotEmpty>
			            <isNotEmpty prepend="AND" property="searchOffice" >
			          		   OFFICE_CD  LIKE  '$searchOffice$%'
			            </isNotEmpty>
			            <isNotEmpty property="searchOfficeCondition" >
			          		   <isNotEmpty prepend="AND" property="searchKeyword" >
			          		    $searchOfficeCondition$  LIKE  '%$searchKeyword$%'
			            		</isNotEmpty>
			            </isNotEmpty>
			       </dynamic>
		           <isNotEmpty  property="orderField" >
		            	  ORDER BY  $orderField$   $orderSort$
		           </isNotEmpty>
		         
	   </select>
	   <!-- 업무관리 담당관리 조직도 수정 -->
 	<update id="OfficePartDAO.eminwonUpdateOfficePartUser" parameterClass="officePartVO">
 			UPDATE
 					RFC_COMTCOFFICE_PART
 			SET
			    OFFICE_TEL=#officeTel#,
			    OFFICE_FAX=#officeFax#,
			    OFFICE_PT_MEMO=	#officePtMemo#
			WHERE
				USER_ID = #userId#
 	</update>
</sqlMap>