<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="RFCTeachingOrderManage">
  	
  	<cacheModel type="${Globals.ibatis.default.cache}" id="RFCTeachingOrderManageCache" readOnly="true" serialize="false">
	        <flushInterval hours="24" />
			<flushOnExecute statement="RFCTeachingDAO.insertOrderGoods"/>
			<flushOnExecute statement="RFCTeachingDAO.deleteOrderGoods"/>
			<flushOnExecute statement="RFCTeachingDAO.insertToolsOrder"/>
			<flushOnExecute statement="RFCTeachingDAO.updateToolsOrder"/>
			<flushOnExecute statement="RFCTeachingDAO.updateToolsOrderOrderSTatus"/>
			<flushOnExecute statement="RFCTeachingDAO.deleteToolsOrder"/>
			<flushOnExecute statement="RFCTeachingDAO.insertPlacard"/>
			<flushOnExecute statement="RFCTeachingDAO.updatePlacard"/>
			<flushOnExecute statement="RFCTeachingDAO.deleteAllPlacard"/>
			
      </cacheModel>
      
      <!--  주문교재/교구 저장 -->
       <typeAlias  alias="toolsOrderGoods"     type = "egovframework.rfc3.teachingtool.vo.ToolsOrderGoods"/>
       <typeAlias  alias="toolsOrder" 				type="egovframework.rfc3.teachingtool.vo.ToolsOrder" />
       <typeAlias  alias="placardStatisVO" 				type="egovframework.rfc3.teachingtool.vo.PlacardStatisVO" />
       
	 	<insert id="RFCTeachingDAO.insertOrderGoods" parameterClass="toolsOrderGoods">
				 			insert into RFC_COMTNTOOLS_ORDERGOODS (
					 			   TOOLS_ORD_GOOD_SID,
					 			   TOOLS_SID,
					 			   TOOLS_ORDER_ID,
					 			   ORDER_CNT,
				 			   	   REG_DATE 
				 			  	   ) values(
					 			   #toolsOrdGoodSid# ,
					 			   #toolsSid# ,
					 			   #toolsOrderId# ,
					 			   #orderCnt# , 
					 			   #regDate#
				 			    )
	 	</insert>
	 	<select id="RFCTeachingDAO.selectOrderGoodsList" parameterClass="String" resultClass="toolsOrderGoods"   cacheModel="RFCTeachingOrderManageCache">
	 					select 
		 						a.TOOLS_ORD_GOOD_SID toolsOrdGoodSid,
	       						a.TOOLS_SID toolsSid,
	       						a.TOOLS_ORDER_ID toolsOrderId,
	       						a.ORDER_CNT orderCnt,
	       						a.REG_DATE regDate
  					from 	
  							RFC_COMTNTOOLS_ORDERGOODS a
  					where
  							TOOLS_ORDER_ID=#toolsOrderId#
  					order by  REG_DATE desc
	 	</select>
	 	
	 	<select id="RFCTeachingDAO.getToolsOrderGoods" parameterClass="long" resultClass="toolsOrderGoods"   cacheModel="RFCTeachingOrderManageCache">
	 					select 
		 						a.TOOLS_ORD_GOOD_SID toolsOrdGoodSid,
	       						a.TOOLS_SID toolsSid,
	       						a.TOOLS_ORDER_ID toolsOrderId,
	       						a.ORDER_CNT orderCnt,
	       						a.REG_DATE regDate
  					from 	
  							RFC_COMTNTOOLS_ORDERGOODS a
  					where
  							TOOLS_ORD_GOOD_SID=#toolsOrdGoodSid#
	 	</select>
	 	
	 	<select id="RFCTeachingDAO.selectOrderGoodsCntForToolsSid" parameterClass="long" resultClass="int"   cacheModel="RFCTeachingOrderManageCache">
         			       select 
         					 ifnull(sum(ORDER_CNT),0) as totCnt
						  from 
						      RFC_COMTNTOOLS_ORDERGOODS a
						      inner join RFC_COMTNTOOLS_ORDER b
                              on a.TOOLS_ORDER_ID=b.TOOLS_ORDER_ID
						  where
						  a.TOOLS_SID =#toolsSid# and
						  (b.ORDER_STATUS !='N' and   b.ORDER_STATUS !='C')   
         </select>
         
         <update id="RFCTeachingDAO.updateOrderGoods" parameterClass="toolsOrderGoods">
         				update  
         					RFC_COMTNTOOLS_ORDERGOODS 
         				set  ORDER_CNT=#orderCnt#  
         				where 
         					TOOLS_ORD_GOOD_SID=#toolsOrdGoodSid#
         </update>
         <delete id="RFCTeachingDAO.deleteOrderGoods" parameterClass="String">
         				delete from  RFC_COMTNTOOLS_ORDERGOODS 
         				where TOOLS_ORDER_ID=#toolsOrderId#
         </delete>
           <delete id="RFCTeachingDAO.deleteOrderGoodsToToolsOrdGoodSid" parameterClass="long">
         				delete from  RFC_COMTNTOOLS_ORDERGOODS 
         				where TOOLS_ORD_GOOD_SID=#toolsOrdGoodSid#
         </delete>
         
         <select id="RFCTeachingDAO.selectOrderGoodsInfo" parameterClass="toolsOrderGoods" resultClass="toolsOrderGoods">
			SELECT
				TOOLS_ORD_GOOD_SID,
				TOOLS_SID,
				TOOLS_ORDER_ID,
				ORDER_CNT,
				REG_DATE 
			FROM
				RFC_COMTNTOOLS_ORDERGOODS
			WHERE 
				TOOLS_ORD_GOOD_SID = #toolsOrdGoodSid#
         </select>
	 	
	 	
	 	<!--  주문자 정보 저장 -->
	 	<insert id="RFCTeachingDAO.insertToolsOrder" parameterClass="toolsOrder">
	 							insert into RFC_COMTNTOOLS_ORDER( 
	 								TOOLS_ORDER_ID,
	 								APLY_AREA_CD,
	 								APLY_SCHOOL_CD,
	 								ORDER_USER_ID,
	 								ORDER_USER_NM,
	 								ORDER_USER_TEL,
	 								DELIVER_ZIP,
	 								DELIVER_ADDR1,
	 								DELIVER_ADDR2,
	 								DELIVER_USER_NM,
	 								DELIVER_USER_TEL,
	 								HOWTO_DELIVERED,
	 								HOWTO_RETURN,
	 								SDATE,
	 								EDATE,
	 								REG_DATE,
	 								ORDER_STATUS  )values(
	 								#toolsOrderId# ,
	 								#aplyAreaCd# ,
	 								#aplySchoolCd# ,
	 								#orderUserId# ,
	 								#orderUserNm# ,
	 								#orderUserTel# ,
	 								#deliverZip# ,
	 								#deliverAddr1# ,
	 								#deliverAddr2# ,
	 								#deliverUserNm# ,
	 								#deliverUserTel# ,
	 								#howToDelivered# ,
	 								#howToReturn# ,
	 								#sdate# ,
	 								#edate# ,
	 								#regDate# ,
	 								#orderStatus#
	 								 )
	 	</insert>
	 	
	 	<update id="RFCTeachingDAO.updateToolsOrder" parameterClass="toolsOrder">
	 						update 
	 							  RFC_COMTNTOOLS_ORDER
								set  
							     APLY_AREA_CD = #aplyAreaCd#, 
							     APLY_SCHOOL_CD = #aplySchoolCd#, 
								 ORDER_USER_NM = #orderUserNm#, 
								 ORDER_USER_TEL = #orderUserTel#, 
								 DELIVER_ZIP = #deliverZip#, 
								 DELIVER_ADDR1 = #deliverAddr1#, 
								 DELIVER_ADDR2 = #deliverAddr2#, 
								 DELIVER_USER_NM = #deliverUserNm#, 
								 DELIVER_USER_TEL = #deliverUserTel#, 
								 HOWTO_DELIVERED = #howToDelivered#, 
								 HOWTO_RETURN = #howToReturn#, 
								 SDATE = #sdate#, 
								 EDATE = #edate#			 
							where
							  	TOOLS_ORDER_ID =#toolsOrderId#
	 	</update>
	 	<update id="RFCTeachingDAO.updateToolsOrderOrderSTatus" parameterClass="toolsOrder">
	 						update 
	 							  RFC_COMTNTOOLS_ORDER
								set   ORDER_STATUS=#orderStatus#
							where 
								TOOLS_ORDER_ID =#toolsOrderId#
	 	</update>
	 	
	 	<delete id="RFCTeachingDAO.deleteToolsOrder">
	 					delete from  RFC_COMTNTOOLS_ORDER 
	 					where  TOOLS_ORDER_ID =#toolsOrderId#
	 	</delete>
	 	
	 	<select id="RFCTeachingDAO.getToolsOrderInfo" parameterClass="String" resultClass="toolsOrder"  cacheModel="RFCTeachingOrderManageCache">
	 					select 
	 							   a.TOOLS_ORDER_ID toolsOrderId,
							       a.APLY_AREA_CD  aplyAreaCd,
							       a.APLY_SCHOOL_CD aplySchoolCd,
							       a.ORDER_USER_ID orderUserId,
							       a.ORDER_USER_NM orderUserNm,
							       a.ORDER_USER_TEL orderUserTel,
							       a.DELIVER_ZIP deliverZip,
							       a.DELIVER_ADDR1 deliverAddr1,
							       a.DELIVER_ADDR2 deliverAddr2,
							       a.DELIVER_USER_NM deliverUserNm,
							       a.DELIVER_USER_TEL deliverUserTel,
							       a.HOWTO_DELIVERED howToDelivered,
							       a.HOWTO_RETURN howToReturn,
							       a.SDATE sdate,
							       a.EDATE edate,
							       a.REG_DATE regDate,
							       a.ORDER_STATUS orderStatus
  						from 
  								RFC_COMTNTOOLS_ORDER a
  						where 
  								TOOLS_ORDER_ID =#toolsOrderId#
	 	</select>
	
		<select id="RFCTeachingDAO.selectToolsOrderListTotCnt" parameterClass="toolsOrder" resultClass="int"   cacheModel="RFCTeachingOrderManageCache">
							        SELECT 
							       		 count(*) totCnt
							         FROM 
							            RFC_COMTNTOOLS_ORDER
							       WHERE 1=1 
							        <isNotEmpty prepend="AND" property="searchCondition" >
				          				  $searchCondition$  LIKE concat ('%',#searchKeyword#,'%')
				 					</isNotEmpty>
							      <isNotEmpty prepend="AND" property="aplyAreaCd" >
								         APLY_AREA_CD  = #aplyAreaCd#
								 </isNotEmpty>
								  <isNotEmpty prepend="AND" property="aplySchoolCd" >
								         APLY_SCHOOL_CD  = #aplySchoolCd#
								 </isNotEmpty>
								  <isNotEmpty prepend="AND" property="orderStatus" >
								         ORDER_STATUS  = #orderStatus#
								 </isNotEmpty>
	 	 </select>
	 	
	 	 <select id="RFCTeachingDAO.selectToolsOrderList" parameterClass="toolsOrder" resultClass="toolsOrder"   cacheModel="RFCTeachingOrderManageCache">
	 			            SELECT 
	 			                   TOOLS_ORDER_ID toolsOrderId,
							       APLY_AREA_CD  aplyAreaCd,
							       APLY_SCHOOL_CD aplySchoolCd,
							       ORDER_USER_ID orderUserId,
							       ORDER_USER_NM orderUserNm,
							       ORDER_USER_TEL orderUserTel,
							       DELIVER_ZIP deliverZip,
							       DELIVER_ADDR1 deliverAddr1,
							       DELIVER_ADDR2 deliverAddr2,
							       DELIVER_USER_NM deliverUserNm,
							       DELIVER_USER_TEL deliverUserTel,
							       HOWTO_DELIVERED howToDelivered,
							       HOWTO_RETURN howToReturn,
							       SDATE sdate,
							       EDATE edate,
							       REG_DATE regDate,
							       ORDER_STATUS orderStatus
							    FROM 
							            RFC_COMTNTOOLS_ORDER
							   WHERE 1=1 
							      <isNotEmpty prepend="AND" property="searchCondition" >
				          				  $searchCondition$  LIKE concat ('%',#searchKeyword#,'%')
				 				   </isNotEmpty>
							      <isNotEmpty prepend="AND" property="aplyAreaCd" >
								         APLY_AREA_CD  = #aplyAreaCd#
								  </isNotEmpty>
								  <isNotEmpty prepend="AND" property="aplySchoolCd" >
								         APLY_SCHOOL_CD  = #aplySchoolCd#
								 </isNotEmpty>
								  <isNotEmpty prepend="AND" property="orderStatus" >
								         ORDER_STATUS  = #orderStatus#
								  </isNotEmpty>
								  order by TOOLS_ORDER_ID desc
								 LIMIT #recordCountPerPage# OFFSET #firstIndex#

	 	</select>
	 	
	 	<select id="RFCTeachingDAO.selectMyToolsOrderList" parameterClass="String" resultClass="toolsOrder"   cacheModel="RFCTeachingOrderManageCache">
	 			            SELECT 
	 			                   TOOLS_ORDER_ID toolsOrderId,
							       APLY_AREA_CD  aplyAreaCd,
							       APLY_SCHOOL_CD aplySchoolCd,
							       ORDER_USER_ID orderUserId,
							       ORDER_USER_NM orderUserNm,
							       ORDER_USER_TEL orderUserTel,
							       DELIVER_ZIP deliverZip,
							       DELIVER_ADDR1 deliverAddr1,
							       DELIVER_ADDR2 deliverAddr2,
							       DELIVER_USER_NM deliverUserNm,
							       DELIVER_USER_TEL deliverUserTel,
							       HOWTO_DELIVERED howToDelivered,
							       HOWTO_RETURN howToReturn,
							       SDATE sdate,
							       EDATE edate,
							       REG_DATE regDate,
							       ORDER_STATUS orderStatus
							    FROM 
							            RFC_COMTNTOOLS_ORDER
							   WHERE
							     ORDER_USER_ID=#orderUserId#
								 order by TOOLS_ORDER_ID desc
	 	</select>
	 	
	 	 	
	 	<select id="RFCTeachingDAO.selectToolsOrderListTotCnt2" parameterClass="toolsOrder" resultClass="int"   cacheModel="RFCTeachingOrderManageCache">
	 			 		     SELECT 
							      count(*) totCnt
							  FROM 
							       ( SELECT 
							       		  a.APLY_AREA_CD aplyAreaCd, 
							              a.APLY_SCHOOL_CD aplySchoolCd, 
							              a.SDATE sdate, 
							              a.EDATE edate, 
							              a.ORDER_USER_TEL orderUserTel, 
							              a.ORDER_USER_Nm orderUserNm, 
							              a.ORDER_USER_ID orderUserId, 
							              a.REG_DATE regDate, 
							              a.HOWTO_DELIVERED howToDelivered,
							       		  a.HOWTO_RETURN howToReturn,
							       		  ifnull( b.TOOLS_ORD_GOOD_SID,0) toolsOrdGoodSid,
							              a.ORDER_STATUS orderStatus, 
							              a.TOOLS_ORDER_ID toolsOrderId, 
							              b.TOOLS_SID toolsSid,
							              (SELECT TOOLS_NAME FROM RFC_COMTNTOOLS WHERE TOOLS_SID=b.TOOLS_SID) toolsName 
							         FROM 
							         	RFC_COMTNTOOLS_ORDERGOODS b 
							            LEFT JOIN  RFC_COMTNTOOLS_ORDER a 
							            ON a.TOOLS_ORDER_ID =b.TOOLS_ORDER_ID 
							     		ORDER BY b.TOOLS_ORD_GOOD_SID DESC 
							       )  dd 
							 WHERE 1=1 
							        <isNotEmpty prepend="AND" property="searchCondition" >
				          				  $searchCondition$  LIKE concat ('%',#searchKeyword#,'%')
				 					</isNotEmpty>
							      <isNotEmpty prepend="AND" property="aplyAreaCd" >
								         aplyAreaCd  = #aplyAreaCd#
								 </isNotEmpty>
								  <isNotEmpty prepend="AND" property="aplySchoolCd" >
								         aplySchoolCd  = #aplySchoolCd#
								 </isNotEmpty>
								  <isGreaterThan prepend="AND" property="toolsSid" compareValue="0" >
								         toolsSid  = #toolsSid#
								 </isGreaterThan>								 
	 	</select>
	 	
	 	   <select id="RFCTeachingDAO.selectToolsOrderList2" parameterClass="toolsOrder" resultClass="toolsOrder"   cacheModel="RFCTeachingOrderManageCache">
	 			      SELECT 
							       aplyAreaCd, 
							       aplySchoolCd, 
							       sdate, 
							       edate, 
							       orderUserTel, 
							       orderUserNm, 
							       orderUserId,
							       regDate, 
							       howToDelivered,
							       howToReturn,
							       toolsOrdGoodSid,
							       orderStatus, 
							       toolsOrderId, 
							       toolsSid,
							       orderCnt,
							       toolsName ,
							       totalToolsCnt
							  FROM 
							       (SELECT a.APLY_AREA_CD aplyAreaCd, 
							              a.APLY_SCHOOL_CD aplySchoolCd, 
							              a.SDATE sdate, 
							              a.EDATE edate, 
							              a.ORDER_USER_TEL orderUserTel, 
							              a.ORDER_USER_Nm orderUserNm, 
							              a.ORDER_USER_ID orderUserId, 
							              a.REG_DATE regDate, 
							              a.HOWTO_DELIVERED howToDelivered,
							              a.HOWTO_RETURN howToReturn,
							              ifnull( b.TOOLS_ORD_GOOD_SID,0) toolsOrdGoodSid,
							              a.ORDER_STATUS orderStatus, 
							              a.TOOLS_ORDER_ID toolsOrderId, 
							              b.TOOLS_SID toolsSid	,
							              b.ORDER_CNT orderCnt,
							              (SELECT TOOLS_NAME FROM RFC_COMTNTOOLS WHERE TOOLS_SID=b.TOOLS_SID) toolsName ,
							              (SELECT TOTAL_CNT FROM RFC_COMTNTOOLS WHERE TOOLS_SID=b.TOOLS_SID) totalToolsCnt 
							          FROM 
							         	RFC_COMTNTOOLS_ORDERGOODS b 
							            LEFT JOIN  RFC_COMTNTOOLS_ORDER a 
							            ON a.TOOLS_ORDER_ID =b.TOOLS_ORDER_ID 
							     		ORDER BY b.TOOLS_ORD_GOOD_SID DESC 
							       )  dd 
							 WHERE 1=1 
							        <isNotEmpty prepend="AND" property="searchCondition" >
				          				  $searchCondition$  LIKE concat ('%',#searchKeyword#,'%')
				 					</isNotEmpty>
							      <isNotEmpty prepend="AND" property="aplyAreaCd" >
								         aplyAreaCd  = #aplyAreaCd#
								 </isNotEmpty>
								  <isNotEmpty prepend="AND" property="aplySchoolCd" >
								         aplySchoolCd  = #aplySchoolCd#
								 </isNotEmpty>
								 <isGreaterThan prepend="AND" property="toolsSid" compareValue="0" >
								         toolsSid  = #toolsSid#
								 </isGreaterThan>
								
								 <isEqual  property="toolsSid"  compareValue="0">
								 LIMIT #recordCountPerPage# OFFSET #firstIndex#
								 </isEqual>
	 	</select>
	 	
	 	<select id="RFCTeachingDAO.selectToolsOrderListForUser2" parameterClass="String" resultClass="toolsOrder"   cacheModel="RFCTeachingOrderManageCache">
	 			      SELECT 
							       aplyAreaCd, 
							       aplySchoolCd, 
							       sdate, 
							       edate, 
							       orderUserTel, 
							       orderUserNm, 
							       regDate, 
							       howToDelivered,
							       howToReturn,
							       toolsOrdGoodSid,
							       orderStatus, 
							       toolsOrderId, 
							       toolsSid,
							       orderCnt,
							       toolsName ,
							       totalToolsCnt
							  FROM 
							       (SELECT a.APLY_AREA_CD aplyAreaCd, 
							              a.APLY_SCHOOL_CD aplySchoolCd, 
							              a.SDATE sdate, 
							              a.EDATE edate, 
							              a.ORDER_USER_TEL orderUserTel, 
							              a.ORDER_USER_Nm orderUserNm, 
							              a.ORDER_USER_ID orderUserId, 
							              a.REG_DATE regDate, 
							              a.HOWTO_DELIVERED howToDelivered,
							              a.HOWTO_RETURN howToReturn,
							              ifnull( b.TOOLS_ORD_GOOD_SID,0) toolsOrdGoodSid,
							              a.ORDER_STATUS orderStatus, 
							              a.TOOLS_ORDER_ID toolsOrderId, 
							              b.TOOLS_SID toolsSid,
							              b.ORDER_CNT orderCnt,
							              (SELECT TOOLS_NAME FROM RFC_COMTNTOOLS WHERE TOOLS_SID=b.TOOLS_SID) toolsName ,
							              (SELECT TOTAL_CNT FROM RFC_COMTNTOOLS WHERE TOOLS_SID=b.TOOLS_SID) totalToolsCnt
							         FROM 
							        	RFC_COMTNTOOLS_ORDERGOODS b 
							            LEFT JOIN  RFC_COMTNTOOLS_ORDER a 
							            ON a.TOOLS_ORDER_ID =b.TOOLS_ORDER_ID 
							     		ORDER BY b.TOOLS_ORD_GOOD_SID DESC 
							       )  dd 
							 WHERE 
							 	orderUserId =#orderUserId#     
	 	</select>
	 	
	 	<select id="RFCTeachingDAO.orderStatusForToolsSid"  parameterClass="toolsOrderGoods" resultClass="String"   cacheModel="RFCTeachingOrderManageCache">
					 		    select 
									ORDER_STATUS  orderStatus
								from 
								     RFC_COMTNTOOLS_ORDER
								where
									TOOLS_ORDER_ID = (select TOOLS_ORDER_ID from  RFC_COMTNTOOLS_ORDERGOODS where TOOLS_SID=#toolsSid#  and TOOLS_ORDER_ID=#toolsOrderId# )
								
	 	</select>
	 	
		<!-- statis -->
		<select id="RFCTeachingDAO.selectOrderStatisTotSumForSchool"  parameterClass="toolsOrder" resultClass="int" cacheModel="RFCTeachingOrderManageCache">
			  	SELECT 
			       ifnull(sum(b.ORDER_CNT),0) orderCntSum
			    FROM 
				  	RFC_COMTNTOOLS_ORDER a , 
				  	RFC_COMTNTOOLS_ORDERGOODS b
			    where
					a.ORDER_STATUS !='C' and a.TOOLS_ORDER_ID=b.TOOLS_ORDER_ID
				    <isNotEmpty prepend="AND" property="searchYear" >
				        date_format(a.REG_DATE,'%Y')  = #searchYear#
				    </isNotEmpty>
				    <isNotEmpty prepend="AND" property="searchMonth" >
				        date_format(a.REG_DATE,'%m')  = #searchMonth#
				    </isNotEmpty>					
					
	  	</select>
	  	<select id="RFCTeachingDAO.selectOrderStatisListForSchool"  parameterClass="toolsOrder" resultClass="toolsOrder" cacheModel="RFCTeachingOrderManageCache">
			  	SELECT 
			       ifnull(sum(b.ORDER_CNT),0) orderCntSum,
			       APLY_AREA_CD aplyAreaCd, 
			       APLY_SCHOOL_CD aplySchoolCd  
			    FROM 
				  	RFC_COMTNTOOLS_ORDER a , 
				  	RFC_COMTNTOOLS_ORDERGOODS b
			    where
					a.ORDER_STATUS !='C' and a.TOOLS_ORDER_ID=b.TOOLS_ORDER_ID
				    <isNotEmpty prepend="AND" property="searchYear" >
				        date_format(a.REG_DATE,'%Y')  = #searchYear#
				    </isNotEmpty>
				    <isNotEmpty prepend="AND" property="searchMonth" >
				        date_format(a.REG_DATE,'%m')  = #searchMonth#
				    </isNotEmpty>
					group by  a.APLY_AREA_CD, a.APLY_SCHOOL_CD
	  	</select>
	  	
	  	<select id="RFCTeachingDAO.selectOrderGoodsItemCount"  parameterClass="toolsOrder" resultClass="toolsOrderGoods" cacheModel="RFCTeachingOrderManageCache">
			SELECT
            	TOOLS_SID AS toolsSid,
                TOOLS_NAME AS toolsName,
                TOTAL_CNT AS totalToolsCount,
                (
                 SELECT
                 	IFNULL(COUNT(ORDER_CNT), 0)
                 FROM
                 	RFC_COMTNTOOLS_ORDERGOODS B
                 WHERE 
                 	A.TOOLS_SID = B.TOOLS_SID
                 	<isNotEmpty prepend="AND" property="sdate" >
						cast(date_format(B.REG_DATE,'%Y%m%d') as SIGNED ) &gt;=  cast(replace(#sdate# , '-', '' )as SIGNED) 
					</isNotEmpty>						           
					<isNotEmpty prepend="AND" property="edate" >
						cast(date_format(B.REG_DATE,'%Y%m%d') as SIGNED ) &lt;=  cast(replace(#edate#, '-', '' ) as SIGNED)
					</isNotEmpty>
                 ) AS orderCnt
			FROM
            (SELECT TOOLS_SID, TOOLS_NAME, TOTAL_CNT FROM RFC_COMTNTOOLS WHERE CATEGORY_ID = #categoryId#) A ORDER BY orderCnt DESC
	  	</select>
	  	
	  	<select id="RFCTeachingDAO.selectOrderStatisListForArea"  parameterClass="toolsOrder" resultClass="toolsOrder" cacheModel="RFCTeachingOrderManageCache">
			  	  select
						 ifnull(sum(orderCntSum),0) orderCntSum,
						 ifnull(sum(totCateCnt),0) totCateCnt,
						 ifnull(sum(totSchoolCnt),0) totSchoolCnt
					from
					(
					  	  select 
					        	b.TOOLS_SID toolsSid ,
					            ifnull(sum(b.ORDER_CNT),0) orderCntSum,
					            count(d.TOOLS_SID) totCateCnt,
					            count(c.CATE2_CD) totSchoolCnt
					        from 
						          RFC_COMTNTOOLS_ORDER a ,
						          RFC_COMTNTOOLS_ORDERGOODS b,
						          RFC_COMTCCOMMON_CATEGORY2 c,
						          RFC_COMTNTOOLS d
					        where
						           a.TOOLS_ORDER_ID = b.TOOLS_ORDER_ID and
						           a.APLY_AREA_CD = c.CATE1_CD and
						           a.APLY_SCHOOL_CD=c.CATE2_CD and
						           b.TOOLS_SID =d.TOOLS_SID and
						           d.CATEGORY_ID=#categoryId#  
						           <isNotEmpty prepend="AND" property="aplyAreaCd" >
						             a.APLY_AREA_CD=#aplyAreaCd# 
						           </isNotEmpty>
						           <isNotEmpty prepend="AND" property="schoolGubunStr" >
						           		c.CATE2_CONTENT1 like  '%$schoolGubunStr$%'
						           </isNotEmpty>
						           <isNotEmpty prepend="AND" property="sdate" >
						          	 	cast(date_format(a.REG_DATE,'%Y%m%d') as SIGNED ) &gt;=  cast(replace(#sdate# , '-', '' )as SIGNED) 
						           </isNotEmpty>						           
						           <isNotEmpty prepend="AND" property="edate" >
						           		cast(date_format(a.REG_DATE,'%Y%m%d') as SIGNED ) &lt;=  cast(replace(#edate#, '-', '' ) as SIGNED)
						           </isNotEmpty>
						           
					             group by b.TOOLS_SID
					        )  dd
	  	</select>
	  	
	  		<select id="RFCTeachingDAO.selectPacardStatisListForArea"  parameterClass="placardStatisVO"  resultClass="placardStatisVO" cacheModel="RFCTeachingOrderManageCache">
				  		SELECT 
							 ifnull(sum(HYEONSIZE_CNT),0) hyeonSizeCnt ,
						     ifnull(sum(DESCSIZE_CNT),0) descSizeCnt ,
						     ifnull(sum(IPGANSIZE_CNT),0) ipGanSizeCnt,
						     ifnull(sum(ETCSIZE_CNT),0) etcSizeCnt,
						     ifnull(sum(HYEONSIZE_CNT+DESCSIZE_CNT+IPGANSIZE_CNT+ETCSIZE_CNT),0) totalCnt
						FROM RFC_COMTNBBSDATA a, 
						       RFC_COMTNTOOLS_PLACARD_STAT b, 
						       RFC_COMTCCOMMON_CATEGORY2 c 
						 WHERE 
						       a.DATA_SID =b.DATA_SID 
						       AND a.DELETE_STATUS ='N' 
						       AND a.DATA_STATUS ='N' 
						       AND a.ANSWER_STATUS ='Y'
						       AND b.APLY_AREA_CD=c.CATE1_CD 
						       AND b.APLY_SCHOOL_CD = c.CATE2_CD  
						       <isNotEmpty prepend="AND" property="aplyAreaCd" >
						             b.APLY_AREA_CD=#aplyAreaCd# 
						       </isNotEmpty>
						       <isNotEmpty prepend="AND" property="schoolGubunStr" >
						           		c.CATE2_CONTENT1 like  '%$schoolGubunStr$%'
						       </isNotEmpty>
						       <isNotEmpty prepend="AND" property="sdate" >
						          	 	cast(date_format(a.REGISTER_DATE,'%Y%m%d') as SIGNED ) &gt;=  cast(replace(#sdate# , '-', '' )as SIGNED) 
						       </isNotEmpty>						           
						       <isNotEmpty prepend="AND" property="edate" >
						           		cast(date_format(a.REGISTER_DATE,'%Y%m%d') as SIGNED ) &lt;=  cast(replace(#edate#, '-', '' ) as SIGNED)
						       </isNotEmpty>
						  
	  	</select>
	  	
	  	 <select id="RFCTeachingDAO.isExistPlacardDataSid" parameterClass="long" resultClass="int"  cacheModel="RFCTeachingOrderManageCache">
	  					select 
	  						count(*) cnt
	  					from
	  					 	RFC_COMTNTOOLS_PLACARD_STAT
	  					 where
	  					   DATA_SID=#dataSid#
	  	</select>
	  	
	  	 <select id="RFCTeachingDAO.getPlacardInfo" parameterClass="long" resultClass="placardStatisVO"  cacheModel="RFCTeachingOrderManageCache">
	  					select 
 								DATA_SID  dataSid,
					  			APLY_AREA_CD  aplyAreaCd,
					  			APLY_SCHOOL_CD  aplySchoolCd,
					  			HYEONSIZE_CNT hyeonSizeCnt,
					  			IPGANSIZE_CNT ipGanSizeCnt,
					  			DESCSIZE_CNT descSizeCnt,
					  			ETCSIZE_CNT etcSizeCnt
	  					from
	  					 	   RFC_COMTNTOOLS_PLACARD_STAT
	  					 where
	  					      DATA_SID=#dataSid#
	  	</select>
	  	<select id="RFCTeachingDAO.selectExtionListForPlacard"  parameterClass="String" resultClass="placardStatisVO"  cacheModel="RFCTeachingOrderManageCache">
	  			select
				      DATA_SID as dataSid,
				      EXTENSION_VALUE as extionValue
				  from 
				      RFC_COMTNBBSEXTDATA 
				  where
				       EXTENSION_VALUE !=''  and   
				       EXTENSION_KEY =#extionKey#  and 
				       BOARD_ID='service_board'
				   group by DATA_SID
	  	</select>
	  	
	  	<insert id="RFCTeachingDAO.insertPlacard"  parameterClass="placardStatisVO" >
				  		insert into  RFC_COMTNTOOLS_PLACARD_STAT( 
							  			DATA_SID,
							  			APLY_AREA_CD,
							  			APLY_SCHOOL_CD,
							  			HYEONSIZE_CNT,
							  			IPGANSIZE_CNT,
							  			DESCSIZE_CNT,
							  			ETCSIZE_CNT
							  			) values(
										#dataSid# ,
										#aplyAreaCd# ,
										#aplySchoolCd# ,
										#hyeonSizeCnt# ,
										#ipGanSizeCnt# ,
										#descSizeCnt# ,
										#etcSizeCnt# 
							)
	  	</insert>
	  	<update id="RFCTeachingDAO.updatePlacard" parameterClass="placardStatisVO" >
	  						   update 
	  								 RFC_COMTNTOOLS_PLACARD_STAT
							   set 
									 APLY_AREA_CD = #aplyAreaCd#,
									 APLY_SCHOOL_CD = #aplySchoolCd#, 
									 HYEONSIZE_CNT = #hyeonSizeCnt#, 
									 IPGANSIZE_CNT = #ipGanSizeCnt#, 
									 DESCSIZE_CNT = #descSizeCnt#, 
									 ETCSIZE_CNT = #etcSizeCnt# 
						    	where 
	  								 DATA_SID = #dataSid#
	  	</update>
	  	<delete id="RFCTeachingDAO.deleteAllPlacard">
	  					delete from RFC_COMTNTOOLS_PLACARD_STAT
	  	</delete>
   </sqlMap>