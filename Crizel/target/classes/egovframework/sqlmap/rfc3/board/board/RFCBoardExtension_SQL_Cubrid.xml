<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="RFCBoardExtManage">
	 
	 <cacheModel type="${Globals.ibatis.default.cache}" id="RFCBoardExtManageCache" readOnly="true" serialize="false">
      <flushInterval hours="24" />
      	<flushOnExecute statement="boardDAO.initDefaultField"/>
		<flushOnExecute statement="boardDAO.insertExtensionField"/>
		<flushOnExecute statement="boardDAO.updateExtensionField"/>
		<flushOnExecute statement="boardDAO.deleteExtensionField"/>
     </cacheModel>
	 
	 <typeAlias  alias="egovMap"      type = "egovframework.rte.psl.dataaccess.util.EgovMap"/>
     <typeAlias  alias="boardExtensionVO" type = "egovframework.rfc3.board.vo.BoardExtensionVO"/>
     <insert id="boardDAO.initDefaultField">
					INSERT INTO RFC_COMTCBBSEXT
						(EXTENSION_KEY,EXTENSION_DESC,EXTENSION_SORT_IDX,EXTENSION_METHOD,EXTENSION_PATTERN)
					VALUES
						('DATA_ROW','글번호',0,'getDataNum','dataRow'),
						('DATA_TITLE','제목',1,'getViewTitle','dataTitle'),
						('DATA_CONTENT','게시물 내용',2,'getDataContent','dataContent'),
						('USER_NICK','작성자',3,'getUserNick','userNick'),
						('REGISTER_DATE','작성일',4,'getRegister_dt','register_dt'),
						('STAR_POINT','추천점수',5,'getStarPoint','starPoint'),
						('VIEW_COUNT','조회수',6,'getViewCount','viewPoint'),
						('TAG_NAME','태그 이름',7,'getTagName','tagName'),
						('TAG_ID','태그 ID',8,'getTagId','tagId'),
						('MODIFY_DATE','수정일',9,'getModify_dt','modify_dt'),
						('START_DT','공지 시작일',10,'getStart_dt','startDt'),
						('END_DT','공지 종료일',11,'getEnd_dt','endDt'),
						('CATEGORY_CODE1','카테고리1',12,'getCategoryCodeValue1','categoryCode1'),
						('CATEGORY_CODE2','카테고리2',13,'getCategoryCodeValue2','categoryCode2'),
						('CATEGORY_CODE3','카테고리3',14,'getCategoryCodeValue3','categoryCode3'),
						('USER_EMAIL','이메일',15,'getUserEmail','userEmail'),
						('USER_HOMEPAGE','홈페이지',16,'getUserHomepage','userHomepage'),
						('USER_ICON','사용자 아이콘',16,'getUserIcon','userIcon')
	</insert>
	<select id="boardDAO.selectDefaultField"  resultClass="boardExtensionVO" cacheModel="RFCBoardExtManageCache">
						SELECT
							BOARD_ID boardId,
							EXTENSION_KEY extensionKey,
							EXTENSION_TYPE extensionType,
							EXTENSION_DEFAULT extensionDefault,
							EXTENSION_DESC extensionDesc,
							EXTENSION_PATTERN extensionPattern,
							EXTENSION_METHOD extensionMethod,							
							EXTENSION_SORT_IDX extensionSortIdx
						FROM
						 	  RFC_COMTCBBSEXT
						WHERE  1=1 AND (BOARD_ID = '' OR BOARD_ID is NULL)
						ORDER BY EXTENSION_SORT_IDX ASC						
	</select>	
	
	<select id="boardDAO.selectExtensionField"  parameterClass="boardExtensionVO"  resultClass="boardExtensionVO" cacheModel="RFCBoardExtManageCache">
						SELECT
							BOARD_ID boardId,
							EXTENSION_KEY extensionKey,
							EXTENSION_TYPE extensionType,
							EXTENSION_DEFAULT extensionDefault,
							EXTENSION_DESC extensionDesc,
							EXTENSION_PATTERN extensionPattern,
							EXTENSION_METHOD extensionMethod,
							FIELD_IS_USE fieldIsUse,
							EXTENSION_SORT_IDX extensionSortIdx
						FROM
						 	  RFC_COMTCBBSEXT
						WHERE  BOARD_ID = #boardId#					
						ORDER BY EXTENSION_SORT_IDX ASC						
	</select>
	
	<select id="boardDAO.selectExtensionFieldUse"  parameterClass="boardExtensionVO"  resultClass="boardExtensionVO" cacheModel="RFCBoardExtManageCache">
						SELECT
							BOARD_ID boardId,
							EXTENSION_KEY extensionKey,
							EXTENSION_TYPE extensionType,
							EXTENSION_DEFAULT extensionDefault,
							EXTENSION_DESC extensionDesc,
							EXTENSION_PATTERN extensionPattern,
							EXTENSION_METHOD extensionMethod,
							FIELD_IS_USE fieldIsUse,
							EXTENSION_SORT_IDX extensionSortIdx
						FROM
						 	  RFC_COMTCBBSEXT
						WHERE  BOARD_ID = #boardId#
						AND FIELD_IS_USE  = $fieldIsUse$						
						ORDER BY EXTENSION_SORT_IDX ASC						
	</select>
	
	<select id="boardDAO.getExtensionField"  parameterClass="boardExtensionVO"  resultClass="boardExtensionVO" cacheModel="RFCBoardExtManageCache">
						SELECT
							BOARD_ID boardId,
							EXTENSION_KEY extensionKey,
							EXTENSION_TYPE extensionType,
							EXTENSION_DEFAULT extensionDefault,
							EXTENSION_DESC extensionDesc,
							EXTENSION_PATTERN extensionPattern,
							EXTENSION_METHOD extensionMethod,
							FIELD_IS_USE fieldIsUse,
							EXTENSION_SORT_IDX extensionSortIdx
						FROM
						 	  RFC_COMTCBBSEXT
						WHERE  BOARD_ID = #boardId# AND EXTENSION_KEY= #extensionKey#
	</select>
	
	<select id="boardDAO.selectExtensionFieldCount"  parameterClass="boardExtensionVO"  resultClass="int" cacheModel="RFCBoardExtManageCache">
						SELECT
							count(*) totocnt							
						FROM
						 	  RFC_COMTCBBSEXT
						WHERE  ( BOARD_ID = #boardId# AND EXTENSION_KEY = #extensionKey# ) OR ((BOARD_ID IS NULL OR BOARD_ID = '') AND EXTENSION_KEY = #extensionKey#)
	</select>
	
	<select id="boardDAO.selectFieldValidator"  parameterClass="boardExtensionVO"  resultClass="boardExtensionVO" cacheModel="RFCBoardExtManageCache">
						SELECT
							BOARD_ID boardId,
							EXTENSION_KEY extensionKey,
							EXTENSION_TYPE extensionType,
							EXTENSION_DEFAULT extensionDefault,
							EXTENSION_DESC extensionDesc,
							EXTENSION_PATTERN extensionPattern,
							EXTENSION_METHOD extensionMethod,
							FIELD_IS_USE fieldIsUse,
							EXTENSION_SORT_IDX extensionSortIdx				
						FROM
						 	  RFC_COMTCBBSEXT
						WHERE  ( BOARD_ID = #boardId# AND EXTENSION_KEY = #extensionKey# ) OR ((BOARD_ID IS NULL OR BOARD_ID = '') AND EXTENSION_PATTERN = #extensionKey#)
	</select>
	
	<insert id="boardDAO.insertExtensionField" parameterClass="boardExtensionVO">
					INSERT INTO RFC_COMTCBBSEXT
						(BOARD_ID,EXTENSION_KEY,EXTENSION_DESC,EXTENSION_SORT_IDX,EXTENSION_METHOD,EXTENSION_DEFAULT,EXTENSION_TYPE,EXTENSION_PATTERN,FIELD_IS_USE)
					VALUES
						(						
						#boardId#,
						#extensionKey#,
						#extensionDesc#,
						#extensionSortIdx#,
						#extensionMethod#,
						#extensionDefault#,
						#extensionType#,
						#extensionPattern#,
						$fieldIsUse$
						)
	</insert>
	<update id="boardDAO.updateExtensionField" parameterClass="boardExtensionVO">
					UPDATE RFC_COMTCBBSEXT 
					SET
						BOARD_ID=#boardId#,
						EXTENSION_KEY=#extensionKey#,
						EXTENSION_DESC=#extensionDesc#,
						EXTENSION_SORT_IDX=#extensionSortIdx#,
						EXTENSION_METHOD=#extensionMethod#,
						EXTENSION_DEFAULT=#extensionDefault#,
						EXTENSION_TYPE=#extensionType#,
						EXTENSION_PATTERN=#extensionPattern#,
						FIELD_IS_USE = $fieldIsUse$
					WHERE
						BOARD_ID=#boardId# AND EXTENSION_KEY = #extensionKeyBefore#
	</update>
	
	<delete id="boardDAO.deleteExtensionField" parameterClass="boardExtensionVO">
					DELETE FROM RFC_COMTCBBSEXT 
					WHERE
						BOARD_ID=#boardId# AND EXTENSION_KEY = #extensionKey#
	</delete>
</sqlMap>
