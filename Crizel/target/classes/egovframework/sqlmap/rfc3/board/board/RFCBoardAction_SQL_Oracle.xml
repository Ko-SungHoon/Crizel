<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="RFCBoardActionManage">
	 
	 <cacheModel type="${Globals.ibatis.default.cache}" id="RFCBoardActionManageCache" readOnly="true" serialize="false">
      <flushInterval hours="24" />
      	<flushOnExecute statement="boardDAO.insertBoardAction"/>
      	<flushOnExecute statement="boardDAO.updateBoardAction"/>
      	<flushOnExecute statement="boardDAO.deleteBoardAction"/>
     </cacheModel> 
	 
	 <typeAlias  alias="egovMap"      type = "egovframework.rte.psl.dataaccess.util.EgovMap"/>
     <typeAlias  alias="boardActionVO" type = "egovframework.rfc3.board.vo.BoardActionVO"/>
     
     <select id="boardDAO.selectBoardActionTotal"  parameterClass="boardActionVO" resultClass="int" cacheModel="RFCBoardActionManageCache">
						SELECT
							  count(*) totcnt
						FROM
						 	  RFC_COMTNBBSACT
						WHERE  ACTION_DELETE_STATUS = 'N'
						<isNotEmpty prepend="AND" property="searchCondition" >
			          		     $searchCondition$  LIKE '%$searchKeyword$%'
			            </isNotEmpty>		
			            <isNotEmpty prepend="AND" property="sgroupId" >
			          		     SGROUP_ID  = #sgroupId#
			            </isNotEmpty>
			            <isNotEmpty prepend="AND" property="domainId" >			            	
			            		  DOMAIN_ID  = #domainId#   	
			            </isNotEmpty>			            
			                  
	</select>
	<select id="boardDAO.selectBoardActionCount"  parameterClass="boardActionVO" resultClass="int" cacheModel="RFCBoardActionManageCache">
						SELECT
							  count(*) totcnt
						FROM
						 	  RFC_COMTNBBSACT
						WHERE  ACTION_ID = #actionId#  
	</select>
	
	<select id="boardDAO.selectBoardActionList" parameterClass="boardActionVO"  resultClass="boardActionVO" cacheModel="RFCBoardActionManageCache">
SELECT  * 
  FROM (
		SELECT ROWNUM RNUM, ALL_LIST.*  
		FROM  
		(   
			       
			       	SELECT
			       			ACTION_ID actionId,
							SGROUP_ID sgroupId,
							DOMAIN_ID domainId,
							ACTION_NAME actionName,
							ACTION_DESC actionDesc,
							ACTION_SKIN actionSkin,
							MODIFY_DATE modify_dt,
							REGISTER_DATE register_dt
						FROM
						    RFC_COMTNBBSACT
						WHERE  ACTION_DELETE_STATUS = 'N'
						<isNotEmpty prepend="AND" property="searchCondition" >
			          		     $searchCondition$  LIKE '%$searchKeyword$%'
			            </isNotEmpty>
			           <isNotEmpty prepend="AND" property="sgroupId" >
			          		     SGROUP_ID  = #sgroupId#
			            </isNotEmpty>
			            <isNotEmpty prepend="AND" property="domainId" >			            	
			            		  DOMAIN_ID  = #domainId#   	
			            </isNotEmpty>
			            <isNotEmpty  property="orderField" >
			            	  ORDER BY  $orderField$   $orderSort$
			            </isNotEmpty>
			            <isEmpty  property="orderField" >
			             	ORDER BY REGISTER_DATE  DESC
			             </isEmpty>
			           ) ALL_LIST
	      )
  WHERE  RNUM  &gt; #firstIndex#
  AND  RNUM &lt;= #firstIndex# + #recordCountPerPage#
			          
	</select>
	<select id="boardDAO.selectBoardActionListAll" parameterClass="boardActionVO"  resultClass="boardActionVO" cacheModel="RFCBoardActionManageCache">
			       	SELECT
			       			ACTION_ID actionId,
							SGROUP_ID sgroupId,
							DOMAIN_ID domainId,
							ACTION_NAME actionName,
							ACTION_DESC actionDesc,
							ACTION_SKIN actionSkin,
							MODIFY_DATE modify_dt,
							REGISTER_DATE register_dt
						FROM
						    RFC_COMTNBBSACT
						WHERE  ACTION_DELETE_STATUS = 'N'
						AND ( 1=0
			            <isNotEmpty prepend="OR" property="sgroupId" >
			          		     (SGROUP_ID  = #sgroupId# AND DOMAIN_ID = '')
			            </isNotEmpty>
			            <isNotEmpty prepend="OR" property="domainId" >
			            		  (SGROUP_ID  = #sgroupId# AND DOMAIN_ID  = #domainId#)			            	
			            </isNotEmpty>			            
			            )
			           ORDER BY REGISTER_DATE  DESC			           
	</select>
	<select id="boardDAO.getBoardAction" parameterClass="boardActionVO"  resultClass="boardActionVO" cacheModel="RFCBoardActionManageCache">
			       	SELECT
			       			ACTION_ID actionId,
							SGROUP_ID sgroupId,
							DOMAIN_ID domainId,
							ACTION_NAME actionName,
							ACTION_DESC actionDesc,
							ACTION_SKIN actionSkin,
							MODIFY_DATE modify_dt,
							REGISTER_DATE register_dt
						FROM
						    RFC_COMTNBBSACT
						WHERE  ACTION_ID = #actionId# AND ACTION_DELETE_STATUS = 'N'
	</select>
	<insert id="boardDAO.insertBoardAction"  parameterClass="boardActionVO">
					INSERT INTO RFC_COMTNBBSACT
						( 
						ACTION_ID,
						SGROUP_ID,
						DOMAIN_ID,
						ACTION_NAME,
						ACTION_DESC,
						ACTION_SKIN,
						ACTION_DELETE_STATUS,
						MODIFY_DATE,
						REGISTER_DATE
						)
					VALUES (
						#actionId#,
						#sgroupId#,
						#domainId#,
						#actionName#,
						#actionDesc#,
						#actionSkin#,
						'N',						
						#modify_dt#,
						#register_dt#
					)
	</insert>	
	<update id="boardDAO.updateBoardAction"  parameterClass="boardActionVO">
					UPDATE RFC_COMTNBBSACT 
					SET										
						SGROUP_ID=#sgroupId#,
						DOMAIN_ID=#domainId#,
						ACTION_NAME=#actionName#,
						ACTION_DESC=#actionDesc#,
						ACTION_SKIN=#actionSkin#,
						MODIFY_DATE=#modify_dt#
					WHERE ACTION_ID = #actionId#
	</update>	
	<update id="boardDAO.deleteBoardAction"  parameterClass="boardActionVO">
					UPDATE RFC_COMTNBBSACT 
					SET										
						ACTION_DELETE_STATUS = 'D'
					WHERE ACTION_ID = #actionId#
	</update>	
     
</sqlMap>