<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="RFCEduCationManage">
    <typeAlias  alias="eduCationVO"	  type = "egovframework.rfc3.education.vo.EduCationVO"/>
    <typeAlias  alias="eduCationApplyVO"	  type = "egovframework.rfc3.education.vo.EduCationApplyVO"/>
    <typeAlias  alias="eduPlaceVO"	  type = "egovframework.rfc3.education.vo.EduPlaceVO"/>
    <typeAlias  alias="eduSubjectVO"	  type = "egovframework.rfc3.education.vo.EduSubjectVO"/>
    <typeAlias  alias="eduAttendanceVO"	  type = "egovframework.rfc3.education.vo.EduAttendanceVO"/>
    <typeAlias  alias="eduReportVO"	  type = "egovframework.rfc3.education.vo.EduReportVO"/>
    <typeAlias  alias="eduAfterVO"	  type = "egovframework.rfc3.education.vo.EduAfterVO"/>
    
    <typeAlias  alias="mberManageVO" type = "egovframework.rfc3.user.vo.MberManageVO"/>
    <typeAlias  alias="userManageVO" type = "egovframework.rfc3.user.vo.UserManageVO"/>
    <typeAlias  alias="authoritesVO" type = "egovframework.rfc3.iam.vo.AuthoritesVO"/>
    
  
    <cacheModel type="${Globals.ibatis.default.cache}" id="RFCEduCationManageCache" readOnly="true" serialize="false">
    
      	<flushInterval hours="24" />
      	<flushOnExecute statement="eduCationDAO.insertEduCation"/>
      	<flushOnExecute statement="eduCationDAO.updateEduCation"/>
      	<flushOnExecute statement="eduCationDAO.deleteEduCation"/>
      	<flushOnExecute statement="eduCationDAO.deleteAttendance"/>
      	<flushOnExecute statement="eduCationDAO.deleteApplyer"/>
      	<flushOnExecute statement="eduCationDAO.deleteEduReport"/>
      	<flushOnExecute statement="eduCationDAO.insertApplyer"/> 
      	<flushOnExecute statement="eduCationDAO.updateApplyer"/>
      	<flushOnExecute statement="eduCationDAO.updateRejectApplyer"/>
      	<flushOnExecute statement="eduCationDAO.attendingStatusModify"/>
      	<flushOnExecute statement="eduCationDAO.updateEduPlace"/>
      	<flushOnExecute statement="eduCationDAO.insertEduSubject"/>
      	<flushOnExecute statement="eduCationDAO.updateEduSubject"/>
      	<flushOnExecute statement="eduCationDAO.deleteEduSubject"/>
      	<flushOnExecute statement="eduCationDAO.lectureAttendanceDatesModify"/>
      	<flushOnExecute statement="eduCationDAO.lectureAttendanceStudentModify"/>
      	<flushOnExecute statement="eduCationDAO.lectureAttendanceResetModify"/>
      	<flushOnExecute statement="eduCationDAO.isModify"/>
      	<flushOnExecute statement="eduCationDAO.isWrite"/>
      	<flushOnExecute statement="eduCationDAO.batchModify"/>
      	<flushOnExecute statement="eduCationDAO.deleteAttendanceDate"/>
      	<flushOnExecute statement="eduCationDAO.attenddingUpdate1"/>
      	<flushOnExecute statement="eduCationDAO.attenddingUpdate2"/>
      	<flushOnExecute statement="eduCationDAO.attenddingUpdate3"/>
      	<flushOnExecute statement="eduCationDAO.attenddingUpdate3"/>
      	<flushOnExecute statement="eduCationDAO.AttendingStatusUpdate"/>
      	<flushOnExecute statement="eduCationDAO.eduCationIsWrite"/>
      	<flushOnExecute statement="eduCationDAO.isDelete"/>
      	<flushOnExecute statement="eduCationDAO.addlectureDate"/>
      	<flushOnExecute statement="eduCationDAO.eduAfterInsert"/>
      	<flushOnExecute statement="eduCationDAO.updateAttendingCertificateNum"/>
     </cacheModel>
     
    <select id="eduCationDAO.selectEduCationListTotal"  parameterClass="eduCationVO" resultClass="int" cacheModel="RFCEduCationManageCache">
            SELECT
    		count(*) totcnt
    	FROM
    		RFC_COMTN_EDU_LECTURE
    	WHERE status IN('Y','N') 
    	 
    		
            
            <isNotEmpty  prepend="AND" property="teacherId" >
			         TEACHER_ID = #teacherId# 
            </isNotEmpty>
            
            <isNotEmpty  property="searchGubun" >
            	<isEqual  property="searchGubun" compareValue="1">
            	<!-- 
                  	   (ATT_STARTDATE &lt;= to_char(sysdate, 'yyyyMMddHH24MISS') and ATT_ENDDATE >= to_char(sysdate, 'yyyyMMddHH24MISS'))
                 -->
                 <isNotEmpty  prepend="AND" property="startDate" >
			         STARTDATE &gt;= #startDate# 
            	</isNotEmpty>
            	<isNotEmpty  prepend="AND" property="endDate" >
			         STARTDATE &lt;= #endDate# 
           		 </isNotEmpty>
                   	   
       			</isEqual>
       			
       			<isEqual  property="searchGubun" compareValue="2" prepend="AND" >
                  	   (STARTDATE &lt;= to_char(sysdate, 'yyyyMMddHH24MISS') and ENDDATE >= to_char(sysdate, 'yyyyMMddHH24MISS'))
       			</isEqual>
       			<isEqual  property="searchGubun" compareValue="3" prepend="AND" >
                  	   ATTENDANCE_STUDENTS is not null 
       			</isEqual>
       		</isNotEmpty>
  	</select>
  	<select id="eduCationDAO.selectEduCationList"  parameterClass="eduCationVO" resultClass="eduCationVO" cacheModel="RFCEduCationManageCache">
   	    	
		SELECT  * 
	  FROM (
			SELECT ROWNUM RNUM, ALL_LIST.*  
			FROM  
			(
	

    	SELECT idx, 
       status, 
       subject subJect, 
       lecture_time lectureTime, 
       limit_count limitCount, 
       startdate startDate, 
       enddate endDate, 
       starttime startTime, 
       endtime endTime, 
       att_startdate attStartDate, 
       att_enddate attEndDate, 
       lecture_term lectureTerm, 
       auto_application autoAppliCation, 
       limit_gubun1_year limitGubun1Year, 
       limit_gubun1_count limitGubun1Count, 
       limit_gubun2_auth limitGubun2Auth, 
       limit_gubun2_after limitGubun2After, 
       limit_gubun2_auto limitGubun2Auto, 
       dup_gubun_auth dupGubunAuth, 
       dup_gubun_after dupGubunAfter, 
       dup_gubun_auto dupGubunAuto, 
       attendance_dates attendAnceDates, 
       (SELECT vname 
         FROM RFC_COMTN_EDU_PLACE B 
        WHERE RFC_COMTN_EDU_LECTURE.place_idx = B.idx 
       ) AS place,  
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING D 
        WHERE RFC_COMTN_EDU_LECTURE.idx = D.lecture_idx 
              AND D.status = 0 
       ) AS attCount0, 
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING E 
        WHERE RFC_COMTN_EDU_LECTURE.idx = E.lecture_idx 
              AND E.status = 1 
       ) AS attCount1, 
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING F 
        WHERE RFC_COMTN_EDU_LECTURE.idx = F.lecture_idx 
              AND F.status = 2 
       ) AS attCount2, 
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING G 
        WHERE RFC_COMTN_EDU_LECTURE.idx = G.lecture_idx 
              AND G.status = 3 
       ) AS attCount3, 
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING H 
        WHERE RFC_COMTN_EDU_LECTURE.idx = H.lecture_idx 
              AND H.status = 4 
       ) AS attCount4, 
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING I 
        WHERE RFC_COMTN_EDU_LECTURE.idx = I.lecture_idx 
              AND I.status = 5 
       ) AS attCount5, 
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING J 
        WHERE RFC_COMTN_EDU_LECTURE.idx = J.lecture_idx 
              AND J.status = 6 
       ) AS attCount6, 
       modify_date as modifyDate,create_date as createDate 
  FROM RFC_COMTN_EDU_LECTURE 
 WHERE status IN('Y','N') 
 			           
            <isNotEmpty  prepend="AND" property="teacherId" >
			         TEACHER_ID = #teacherId# 
            </isNotEmpty>
            
            <isNotEmpty  property="searchGubun" >
            	<isEqual  property="searchGubun" compareValue="1" >
            	<!-- 
                  	   (ATT_STARTDATE &lt;= to_char(sysdate, 'yyyyMMddHH24MISS') and ATT_ENDDATE >= to_char(sysdate, 'yyyyMMddHH24MISS'))
                 -->
                 <isNotEmpty  prepend="AND" property="startDate" >
			         STARTDATE &gt;= #startDate# 
            	</isNotEmpty>
            	<isNotEmpty  prepend="AND" property="endDate" >
			         STARTDATE &lt;= #endDate# 
           		 </isNotEmpty>
                   	   
       			</isEqual>
       			<isEqual  property="searchGubun" compareValue="2" prepend="AND" >
                  	   (STARTDATE &lt;= to_char(sysdate, 'yyyyMMddHH24MISS') and ENDDATE >= to_char(sysdate, 'yyyyMMddHH24MISS'))
       			</isEqual>
       			
       			<isEqual  property="searchGubun" compareValue="3" prepend="AND" >
                  	   ATTENDANCE_STUDENTS is not null 
       			</isEqual>
       		</isNotEmpty>
            
            <isNotEmpty  property="orderField" >
			         ORDER BY  $orderField$   $orderSort$
            </isNotEmpty>
            <isEmpty  property="orderField" >
             	    ORDER BY idx DESC
             </isEmpty>

   	    	
        	   ) ALL_LIST
					  )
			  WHERE  RNUM  &gt; #firstIndex#
			  AND  RNUM &lt;= #firstIndex# + #recordCountPerPage#
    		
  	</select>
  	
  	<select id="eduCationDAO.getEduCationInfo"  parameterClass="long" resultClass="eduCationVO" cacheModel="RFCEduCationManageCache">
    	
    	SELECT idx, 
       status, 
       subject subJect, 
       subject_idx subjectIdx,
       place_idx placeIdx,
       lecture_time lectureTime, 
       limit_count limitCount, 
       startdate startDate, 
       enddate endDate, 
       starttime startTime, 
       endtime endTime, 
       att_startdate attStartDate, 
       att_enddate attEndDate, 
       lecture_term lectureTerm, 
       auto_application autoAppliCation, 
       limit_gubun1_year limitGubun1Year, 
       limit_gubun1_count limitGubun1Count,
        teacher_id teacherId,
       limit_gubun2_auth limitGubun2Auth, 
       limit_gubun2_after limitGubun2After, 
       limit_gubun2_auto limitGubun2Auto, 
       dup_gubun_auth dupGubunAuth, 
       dup_gubun_after dupGubunAfter, 
       dup_gubun_auto dupGubunAuto, 
       attendance_students attendAnceStudents,
       attendance_dates attendAnceDates, 
       (SELECT vname 
         FROM RFC_COMTN_EDU_PLACE B 
        WHERE RFC_COMTN_EDU_LECTURE.place_idx = B.idx 
       ) AS place,  
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING D 
        WHERE RFC_COMTN_EDU_LECTURE.idx = D.lecture_idx 
              AND D.status = 0 
       ) AS attCount0, 
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING E 
        WHERE RFC_COMTN_EDU_LECTURE.idx = E.lecture_idx 
              AND E.status = 1 
       ) AS attCount1, 
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING F 
        WHERE RFC_COMTN_EDU_LECTURE.idx = F.lecture_idx 
              AND F.status = 2 
       ) AS attCount2, 
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING G 
        WHERE RFC_COMTN_EDU_LECTURE.idx = G.lecture_idx 
              AND G.status = 3 
       ) AS attCount3, 
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING H 
        WHERE RFC_COMTN_EDU_LECTURE.idx = H.lecture_idx 
              AND H.status = 4 
       ) AS attCount4, 
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING I 
        WHERE RFC_COMTN_EDU_LECTURE.idx = I.lecture_idx 
              AND I.status = 5 
       ) AS attCount5, 
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING J 
        WHERE RFC_COMTN_EDU_LECTURE.idx = J.lecture_idx 
              AND J.status = 6 
       ) AS attCount6, 
       modify_date as modifyDate,create_date as createDate  
  FROM RFC_COMTN_EDU_LECTURE WHERE idx=#idx#
    	
    </select>
  	
  	<insert id="eduCationDAO.insertEduCation"  parameterClass="eduCationVO" >
			    	INSERT 
  INTO RFC_COMTN_EDU_LECTURE
       ( 
           idx, 
           status, 
           place_idx, 
           subject_idx, 
           teacher_id, 
           lecture_time, 
           subject, 
           startdate, 
           enddate, 
           starttime, 
           endtime, 
           lecture_term, 
           limit_count, 
           att_startdate, 
           att_enddate, 
           auto_application, 
           limit_gubun1_year, 
           limit_gubun1_count, 
           limit_gubun2_auth, 
           limit_gubun2_after, 
           limit_gubun2_auto, 
           dup_gubun_auth, 
           dup_gubun_after, 
           dup_gubun_auto, 
           modify_id , 
           modify_date, 
           ipaddr
       ) 
       VALUES
       (
           #idx#,
           #status#,
           #placeIdx#,
           #subjectIdx#,
           #teacherId#,
           #lectureTime#,
           #subJect#,
           #startDate#,
           #endDate#,
           #startTime#,
           #endTime#,
           #lectureTerm#,
           #limitCount#,
           #attStartDate#,
           #attEndDate#,
           #autoAppliCation#,
           #limitGubun1Year#,
           #limitGubun1Count#,
           #limitGubun2Auth#,
           #limitGubun2After#,
           #limitGubun2Auto#,
           #dupGubunAuth#,
           #dupGubunAfter#,
           #dupGubunAuto#,
           #modifyId#,
           #modifyDate#,
           #ipAddr#
       )
  	</insert>
  	
  	<update id="eduCationDAO.updateEduCation"  parameterClass="eduCationVO" >
    			UPDATE RFC_COMTN_EDU_LECTURE 
       SET status=#status#, 
       place_idx=#placeIdx#, 
       subject_idx=#subjectIdx#, 
       teacher_id=#teacherId#, 
       lecture_time=#lectureTime#, 
       subject=#subJect#, 
       startdate=#startDate#, 
       enddate=#endDate#, 
       starttime=#startTime#, 
       endtime=#endTime#, 
       lecture_term=#lectureTerm#, 
       limit_count=#limitCount#, 
       att_startdate=#attStartDate#, 
       att_enddate=#attEndDate#, 
       auto_application=#autoAppliCation#, 
       limit_gubun1_year=#limitGubun1Year#, 
       limit_gubun1_count=#limitGubun1Count#, 
       limit_gubun2_auth=#limitGubun2Auth#, 
       limit_gubun2_after=#limitGubun2After#, 
       limit_gubun2_auto=#limitGubun2Auto#, 
       dup_gubun_auth=#dupGubunAuth#, 
       dup_gubun_after=#dupGubunAfter#, 
       dup_gubun_auto=#dupGubunAuto#, 
       modify_id=#modifyId#, 
       modify_date=#modifyDate#, 
       ipaddr=#ipAddr# 
 WHERE idx=#idx#
  	</update>
  	
  	
  	<update id="eduCationDAO.deleteAttendance" parameterClass="long" >
  		update RFC_COMTN_EDU_LECTURE set ATTENDANCE_DATES='',ATTENDANCE_STUDENTS=''  where idx=#idx#
  	</update>
  	
  	  	
  	<delete id="eduCationDAO.deleteApplyer"  parameterClass="long" >
		delete from	RFC_COMTN_EDU_ATTENDING where lecture_idx=#idx#
  	</delete>
  	
  	<delete id="eduCationDAO.deleteEduCation" parameterClass="long" >
		delete from RFC_COMTN_EDU_LECTURE where idx=#idx#
  	</delete>
  	
  	<delete id="eduCationDAO.deleteEduReport" parameterClass="long" >
		delete from RFC_COMTN_EDU_REPORT where lecture_idx=#idx#
  	</delete>
  	
  	
  	
  	
  	
  	
  	
  	
  	
  	
  	
  	<select id="eduCationDAO.selectApplyerListTotal"  parameterClass="eduCationApplyVO" resultClass="int" cacheModel="RFCEduCationManageCache">
				          SELECT count(*) totcnt 
                FROM RFC_COMTN_EDU_ATTENDING 
               WHERE status IN( '0','1','2','3','4','5','6' ) 
               
               <isNotEmpty prepend="AND" property="lectureIdx" >
          		      lecture_idx=#lectureIdx# 
            </isNotEmpty>
  	</select>
  	<select id="eduCationDAO.selectApplyerListTotal2"  parameterClass="eduCationApplyVO" resultClass="int" cacheModel="RFCEduCationManageCache">
				          SELECT count(*) totcnt 
                FROM RFC_COMTN_EDU_ATTENDING 
               WHERE 1=1 
               
               <isNotEmpty prepend="AND" property="lectureIdx" >
          		      lecture_idx=#lectureIdx# 
            </isNotEmpty>
            <isNotEmpty prepend="AND" property="status" >
          		      status=#status# 
            </isNotEmpty>
  	</select>
  	<select id="eduCationDAO.selectApplyerList"  parameterClass="eduCationApplyVO" resultClass="eduCationApplyVO" cacheModel="RFCEduCationManageCache">
	SELECT idx, 
                     status, 
                     lecture_idx lectureIdx, 
                     subject_idx subjectIdx, 
                     student_id studentId, 
                     att_date attDate, 
                     startdate startDate, 
                     enddate endDate, 
                     lecture_term lectureTerm, 
                     att_reject attReject, 
                     att_memo attMemo, 
                     (SELECT MBER_ID 
                       FROM RFC_COMTNMEMBER B 
                      WHERE AA.student_id = B.MBER_ID
                     ) AS studentId, 
                     (SELECT MBER_NM 
                       FROM RFC_COMTNMEMBER C 
                      WHERE AA.student_id = C.MBER_ID
                     ) AS studentName, 
                     (SELECT vname 
                       FROM RFC_COMTN_EDU_SUBJECT D 
                      WHERE AA.subject_idx = D.idx
                     ) AS subJect, 
                     (SELECT F.vname 
                       FROM RFC_COMTN_EDU_LECTURE E,
                            RFC_COMTN_EDU_PLACE F 
                      WHERE AA.lecture_idx = E.idx 
                            AND E.place_idx = F.idx
                     ) AS placeName, 
                     (SELECT lecture_time 
                       FROM RFC_COMTN_EDU_LECTURE G 
                      WHERE AA.lecture_idx = G.idx
                     ) AS lectureTime, 
                     (SELECT CASE WHEN AREA_NO LIKE '0%' THEN AREA_NO||'-'||MIDDLETEL_NO||'-'||ENDTEL_NO ELSE '' END as studentTel  
                       FROM RFC_COMTNMEMBER B 
                      WHERE AA.student_id = B.MBER_ID
                     ) AS studentTel,
                     (SELECT CASE WHEN MOBLFRIST_NO LIKE '0%' THEN MOBLFRIST_NO||'-'||MOBLMIDDLE_NO||'-'||MOBLEND_NO ELSE '' END as studentMobile  
                       FROM RFC_COMTNMEMBER B 
                      WHERE AA.student_id = B.MBER_ID
                     ) AS studentMobile, 
                     (SELECT COUNT(*) FROM RFC_COMTN_EDU_ATTENDING 
                     WHERE student_idx = AA.STUDENT_IDX and lecture_idx &lt;&gt; AA.LECTURE_IDX AND subject_idx = AA.SUBJECT_IDX 
                     and status IN (3,5,6) and TO_DATE(startdate,'yymmdd') BETWEEN ADD_MONTHS(SYSDATE, -24) AND SYSDATE ) AS attCount,
                     case when 
                     (SELECT lecture_idx FROM RFC_COMTN_EDU_ATTENDING 
                     WHERE student_idx=AA.STUDENT_IDX AND status IN (0,1,3) AND idx &lt;&gt; AA.IDX 
                     AND ((startdate &lt;= AA.STARTDATE AND enddate &gt;= AA.ENDDATE) OR (startdate &lt;= AA.STARTDATE AND enddate &gt;= AA.ENDDATE))) is null then 0 else (SELECT lecture_idx FROM RFC_COMTN_EDU_ATTENDING 
                     WHERE student_idx=AA.STUDENT_IDX AND status IN (0,1,3) AND idx &lt;&gt; AA.IDX 
                     AND ((startdate &lt;= AA.STARTDATE AND enddate &gt;= AA.ENDDATE) OR (startdate &lt;= AA.STARTDATE AND enddate &gt;= AA.ENDDATE))) end AS gwaIdx,
                     modify_date as modifyDate 
                FROM RFC_COMTN_EDU_ATTENDING AA 
               WHERE status IN( '0','1','2','3','4','5','6' ) 
               
               <isNotEmpty prepend="AND" property="lectureIdx" >
          		      lecture_idx=#lectureIdx# 
            </isNotEmpty>
               
            <isNotEmpty  property="orderField" >
			         ORDER BY  $orderField$   $orderSort$
            </isNotEmpty>
            <isEmpty  property="orderField" >
             	    ORDER BY idx DESC
             </isEmpty>
  	</select>
  	
  	
  	<select id="eduCationDAO.getAttStudentIdx"  parameterClass="eduCationApplyVO" resultClass="eduCationApplyVO" cacheModel="RFCEduCationManageCache">
			select student_id studentId,student_idx studentIdx from RFC_COMTN_EDU_ATTENDING where lecture_idx=#lectureIdx# and status=#status# order by student_idx asc
  	</select>
  	
  	
  	<select id="eduCationDAO.getApplyerInfo"  parameterClass="long" resultClass="eduCationApplyVO" cacheModel="RFCEduCationManageCache">
				    	SELECT idx, 
                     status, 
                     lecture_idx lectureIdx, 
                     subject_idx subjectIdx, 
                     student_id studentId, 
                     att_date attDate, 
                     startdate startDate, 
                     enddate endDate, 
                     lecture_term lectureTerm, 
                     att_reject attReject, 
                     att_memo attMemo, 
                     (SELECT MBER_ID 
                       FROM RFC_COMTNMEMBER B 
                      WHERE AA.student_id = B.MBER_ID
                     ) AS studentId, 
                     (SELECT MBER_NM 
                       FROM RFC_COMTNMEMBER C 
                      WHERE AA.student_id = C.MBER_ID
                     ) AS studentName, 
                     (SELECT vname 
                       FROM RFC_COMTN_EDU_SUBJECT D 
                      WHERE AA.subject_idx = D.idx
                     ) AS subJect, 
                     (SELECT F.vname 
                       FROM RFC_COMTN_EDU_LECTURE E,
                            RFC_COMTN_EDU_PLACE F 
                      WHERE AA.lecture_idx = E.idx 
                            AND E.place_idx = F.idx
                     ) AS placeName, 
                     (SELECT lecture_time 
                       FROM RFC_COMTN_EDU_LECTURE G 
                      WHERE AA.lecture_idx = G.idx
                     ) AS lectureTime, 
                     (SELECT CASE WHEN AREA_NO LIKE '0%' THEN AREA_NO||'-'||MIDDLETEL_NO||'-'||ENDTEL_NO ELSE '' END as studentTel  
                       FROM RFC_COMTNMEMBER B 
                      WHERE AA.student_id = B.MBER_ID
                     ) AS studentTel,
                     (SELECT CASE WHEN MOBLFRIST_NO LIKE '0%' THEN MOBLFRIST_NO||'-'||MOBLMIDDLE_NO||'-'||MOBLEND_NO ELSE '' END as studentMobile  
                       FROM RFC_COMTNMEMBER B 
                      WHERE AA.student_id = B.MBER_ID
                     ) AS studentMobile, 
                     (SELECT COUNT(*) FROM RFC_COMTN_EDU_ATTENDING 
                     WHERE student_idx = AA.STUDENT_IDX and lecture_idx &lt;&gt; AA.LECTURE_IDX AND subject_idx = AA.SUBJECT_IDX 
                     and status IN (3,5,6) and TO_DATE(startdate,'yymmdd') BETWEEN ADD_MONTHS(SYSDATE, -10) AND SYSDATE ) AS attCount,
                     case when 
                     (SELECT lecture_idx FROM RFC_COMTN_EDU_ATTENDING 
                     WHERE student_idx=AA.STUDENT_IDX AND status IN (0,1,3) AND idx &lt;&gt; AA.IDX 
                     AND ((startdate &lt;= AA.STARTDATE AND enddate &gt;= AA.ENDDATE) OR (startdate &lt;= AA.STARTDATE AND enddate &gt;= AA.ENDDATE))) is null then 0 else (SELECT lecture_idx FROM RFC_COMTN_EDU_ATTENDING 
                     WHERE student_idx=AA.STUDENT_IDX AND status IN (0,1,3) AND idx &lt;&gt; AA.IDX 
                     AND ((startdate &lt;= AA.STARTDATE AND enddate &gt;= AA.ENDDATE) OR (startdate &lt;= AA.STARTDATE AND enddate &gt;= AA.ENDDATE))) end AS gwaIdx,
                     modify_date as modifyDate 
                FROM RFC_COMTN_EDU_ATTENDING AA 
               WHERE idx=#idx#
  	</select>
  	<insert id="eduCationDAO.insertApplyer" parameterClass="eduCationApplyVO">
  							
  	</insert>
  	<update id="eduCationDAO.updateApplyer" parameterClass="eduCationApplyVO">
  						
  	</update>
  	  	
  	<update id="eduCationDAO.updateRejectApplyer" parameterClass="eduCationApplyVO">
  		update RFC_COMTN_EDU_ATTENDING set status=2, att_reject = '2' , att_memo=#attMemo# where idx = #idx# 
  	</update>
  	
  	<select id="eduCationDAO.firstWait"  parameterClass="eduCationApplyVO" resultClass="eduCationApplyVO" cacheModel="RFCEduCationManageCache">
		select a.idx,a.student_idx studentIdx,a.lecture_idx lectureIdx, rownum from 
		(select idx,student_idx,lecture_idx from RFC_COMTN_EDU_ATTENDING where lecture_idx=#lectureIdx# and status in (0) order by att_date asc) a
		where rownum&lt;=#cnt#
  	</select>
  	 	
  	<select id="eduCationDAO.selectMberTeacherList" parameterClass="userManageVO" resultClass="userManageVO" cacheModel="RFCEduCationManageCache">
		
	        SELECT a.SUBJECT_ID emplyrId,(SELECT EMPLYR_NM FROM RFC_COMTNMANAGER WHERE EMPLYR_ID=a.SUBJECT_ID) emplyrNm FROM RFC_COMTNAUTHORITES a WHERE a.ROLE_ID='ROLE_EDUTEACHER'

	</select>
	
	<select id="eduCationDAO.getMemberEtcInfo" parameterClass="mberManageVO"  resultClass="mberManageVO" cacheModel="RFCEduCationManageCache">
		
			 select MBER_ID mberId,password,MBER_NM mberNm,AREA_NO areaNo,MIDDLETEL_NO middleTelno,ENDTEL_NO endTelno,MOBLFRIST_NO moblfristNo,MOBLMIDDLE_NO moblmiddleNo,MOBLEND_NO moblendNo,USER_ETC1 userEtc1,USER_AUTH_CODE userAuthCode  from RFC_COMTNMEMBER where MBER_ID=#mberId#

	</select>
	
	<select id="eduCationDAO.getMemberInfoCnt" parameterClass="mberManageVO"  resultClass="int" cacheModel="RFCEduCationManageCache">
		
			 select count(*) as cnt  from RFC_COMTNMEMBER where MBER_ID=#mberId#

	</select>
	
	<select id="eduCationDAO.getSearchTotalCount" parameterClass="eduCationApplyVO"  resultClass="int" cacheModel="RFCEduCationManageCache">
		select count(*) as totcnt from RFC_COMTN_EDU_ATTENDING where status IN (#status#) and lecture_idx = #lectureIdx#
	</select>
  	
  	<update id="eduCationDAO.attendingStatusModify" parameterClass="eduCationApplyVO">
  			update RFC_COMTN_EDU_ATTENDING set status=#status# where idx = #idx#
  	</update>
  	
  	<update id="eduCationDAO.attendingStatusModify2" parameterClass="eduCationApplyVO">
  			update RFC_COMTN_EDU_ATTENDING set status=#afterStatus# where lecture_idx=#lectureIdx# and status=#beforeStatus#
  	</update>
  	<update id="eduCationDAO.AttendingStatusModify" parameterClass="eduCationApplyVO">
  			update RFC_COMTN_EDU_ATTENDING set status=#status# where idx IN (#vidx#)
  	</update>
  	<update id="eduCationDAO.AttendingCancelModify" parameterClass="eduCationApplyVO">
  			update RFC_COMTN_EDU_ATTENDING set 
  			status=#status#,
  			att_canceldate=#attCancelDate#,
  			modify_id=#modifyId#,
  			modify_date=#modifyDate#,
  			ipaddr=#ipAddr# 
  			where student_idx = #studentIdx# and lecture_idx = #lectureIdx#
  	</update>
  	
  	
  	
  	
  	
  	
  	
  	
  	
  	
  	
  	<select id="eduCationDAO.selectEduPlaceListTotal" parameterClass="eduPlaceVO"  resultClass="int" cacheModel="RFCEduCationManageCache">
		select count(*) as count from RFC_COMTN_EDU_PLACE where status IN ('Y','N')
		
		<isNotEmpty prepend="AND"  property="searchCondition" >
          		   $searchCondition$  LIKE  '%$searchKeyword$%'
           	</isNotEmpty>
			
			<isEmpty  property="orderField" >
             	    ORDER BY idx DESC
             </isEmpty>
	</select>
  	
  	<select id="eduCationDAO.selectEduPlaceList"  parameterClass="eduPlaceVO" resultClass="eduPlaceVO" cacheModel="RFCEduCationManageCache">
		SELECT  *  
	  FROM (
			SELECT ROWNUM RNUM, ALL_LIST.*  
			FROM  
			(
			
			select idx,status,id,vname,seat,modify_date modifyDate 			
			from RFC_COMTN_EDU_PLACE where status IN('Y','N')  	
			
			<isNotEmpty prepend="AND"  property="searchCondition" >
          		   $searchCondition$  LIKE  '%$searchKeyword$%'
           	</isNotEmpty>
			
			<isEmpty  property="orderField" >
             	    ORDER BY idx DESC
             </isEmpty>
   	    	
        	   ) ALL_LIST
					  )
			  WHERE  RNUM  &gt; #firstIndex#
			  AND  RNUM &lt;= #firstIndex# + #recordCountPerPage#
	</select>
	
	
	<select id="eduCationDAO.getEduPlaceInfo"  parameterClass="long" resultClass="eduPlaceVO" cacheModel="RFCEduCationManageCache">
    	SELECT idx,
       status,
       vname,
       tel,
       fax,
       seat,
       homepage homePage,
       vmap,
       zip,
       addr1,
       addr2,
       traffic_public trafficPublic,
       traffic_car trafficCar,
       edu_time eduTime,
       alert,
       ipaddr ipAddr 
  FROM RFC_COMTN_EDU_PLACE 
 WHERE idx=#idx#
    </select>
    
    <update id="eduCationDAO.updateEduPlace"  parameterClass="eduPlaceVO" >
    			UPDATE RFC_COMTN_EDU_PLACE 
       SET status=#status#, 
       vname=#vname#, 
       tel=#tel#, 
       fax=#fax#, 
       alert=#alert#, 
       seat=#seat#, 
       homepage=#homePage#, 
       edu_time=#eduTime#, 
       vmap=#vmap#, 
       zip=#zip#, 
       addr1=#addr1#, 
       addr2=#addr2#, 
       traffic_public=#trafficPublic#, 
       traffic_car=#trafficCar#, 
       modify_id=#modifyId#, 
       modify_date=#modifyDate#, 
       ipaddr=#ipAddr# 
 WHERE idx=#idx#
  	</update>
  	
  	
  	
  	
  	
  	
  	
  	
  	<select id="eduCationDAO.selectEduSubjectListTotal" parameterClass="eduSubjectVO"  resultClass="int" cacheModel="RFCEduCationManageCache">
		select count(*) count from RFC_COMTN_EDU_SUBJECT where status IN('Y','N') 
		
		<isNotEmpty prepend="AND"  property="searchCondition" >
          		   $searchCondition$  LIKE  '%$searchKeyword$%'
           	</isNotEmpty>
			
			<isEmpty  property="orderField" >
             	    ORDER BY idx DESC
             </isEmpty>
	</select>
  	
  	<select id="eduCationDAO.selectEduSubjectList"  parameterClass="eduSubjectVO" resultClass="eduSubjectVO" cacheModel="RFCEduCationManageCache">
		SELECT  * 
	  FROM (
			SELECT ROWNUM RNUM, ALL_LIST.*  
			FROM  
			(
			
			select idx,status,vname,content contents,program,modify_date modifyDate 			
			from RFC_COMTN_EDU_SUBJECT where status IN('Y','N')
			
			<isNotEmpty prepend="AND"  property="searchCondition" >
          		   $searchCondition$  LIKE  '%$searchKeyword$%'
           	</isNotEmpty>
			
			<isEmpty  property="orderField" >
             	    ORDER BY idx DESC
             </isEmpty>
   	    	
        	   ) ALL_LIST
					  )
			  WHERE  RNUM  &gt; #firstIndex#
			  AND  RNUM &lt;= #firstIndex# + #recordCountPerPage#
	</select>
	
	
	<select id="eduCationDAO.getEduSubjectInfo"  parameterClass="long" resultClass="eduSubjectVO" cacheModel="RFCEduCationManageCache">
    	select idx,status,vname,content contents,program,modify_id modifyId,modify_date modifyDate,ipaddr ipAddr from RFC_COMTN_EDU_SUBJECT where idx=#idx#
    </select>

	<insert id="eduCationDAO.insertEduSubject"  parameterClass="eduSubjectVO" >
			    	INSERT 
  INTO RFC_COMTN_EDU_SUBJECT
       ( 
           idx,status,vname,content,program,ipaddr
       ) 
       VALUES
       (
           #idx#,#status#,#vname#,#contents#,#program#,#ipAddr#
       )
  	</insert>
    
    <update id="eduCationDAO.updateEduSubject"  parameterClass="eduSubjectVO" >
    			UPDATE RFC_COMTN_EDU_SUBJECT 
       SET status=#status#, 
       vname=#vname#, 
       content=#contents#,
       program=#program#,
       modify_id=#modifyId#,
       modify_date=#modifyDate#,
       ipaddr=#ipAddr# 
 WHERE idx=#idx#
  	</update>

	<delete id="eduCationDAO.deleteEduSubject" parameterClass="long" >
		delete from RFC_COMTN_EDU_SUBJECT where idx=#idx#
  	</delete>
  	
  	<select id="eduCationDAO.selectSubjectList"  parameterClass="eduSubjectVO" resultClass="eduSubjectVO" cacheModel="RFCEduCationManageCache">
		select idx,status,vname from RFC_COMTN_EDU_SUBJECT order by idx asc
  	</select>
  	
  	
  	
  	
  	
  	
  	
  	 <update id="eduCationDAO.lectureAttendanceDatesModify"  parameterClass="EduAttendanceVO" >
    			update RFC_COMTN_EDU_LECTURE set attendance_dates=#attendanceDates#,attendance_students=#attendanceStudents# where idx=#lectureIdx#
  	</update>
  	<update id="eduCationDAO.lectureAttendanceStudentModify"  parameterClass="EduAttendanceVO" >
    			update RFC_COMTN_EDU_ATTENDING set status=3 where lecture_idx=#lectureIdx# and student_idx IN ($attendanceStudents$)
  	</update>
  	<update id="eduCationDAO.lectureAttendanceResetModify"  parameterClass="EduAttendanceVO" >
    			update RFC_COMTN_EDU_ATTENDING set status=1 where lecture_idx=#idx# and status=3
  	</update>
  	<select id="eduCationDAO.getAttData"  parameterClass="eduAttendanceVO" resultClass="eduAttendanceVO" cacheModel="RFCEduCationManageCache">
		select lecture_date lectureDate from RFC_COMTN_EDU_ATTENDANCE where student_idx = #studentIdx# and lecture_idx = #lectureIdx# order by lecture_date asc
  	</select>
  	<select id="eduCationDAO.getAttStatus"  parameterClass="eduAttendanceVO" resultClass="int" cacheModel="RFCEduCationManageCache">
		select status from RFC_COMTN_EDU_ATTENDING where student_idx=#studentIdx# and lecture_idx=#lectureIdx#
  	</select>
  	
  	<select id="eduCationDAO.getMemInfo"  parameterClass="String" resultClass="String" cacheModel="RFCEduCationManageCache">
		select MBER_ID mberId from RFC_COMTNMEMBER where USER_ETC1= #userEtc1#
  	</select>
  	
  	
  	<select id="eduCationDAO.getLectureReportData"  parameterClass="eduReportVO" resultClass="int" cacheModel="RFCEduCationManageCache">
		select idx from RFC_COMTN_EDU_REPORT where lecture_date = #lectureDate# and lecture_idx=#lectureIdx#
  	</select>
  	
  	<update id="eduCationDAO.isModify"  parameterClass="eduReportVO" >
    			update RFC_COMTN_EDU_REPORT set lecture_idx=#lectureIdx# , lecture_date=#lectureDate# , attendance_student=#attenDanceStudent#,
    			attendance_count=#attenDanceCount#,lecture_content=#lectureContent#,modify_id=#modifyId#,modify_date=#modifyDate#,ipaddr=#ipAddr# where lecture_idx=#lectureIdx# and lecture_date=#lectureDate#
  	</update>
  	
  	<insert id="eduCationDAO.isWrite"  parameterClass="eduReportVO" >
			    	INSERT 
  INTO RFC_COMTN_EDU_REPORT
       ( 
          IDX,LECTURE_IDX,LECTURE_DATE,ATTENDANCE_COUNT,ATTENDANCE_STUDENT,LECTURE_CONTENT,IPADDR
       ) 
       VALUES
       (
           #idx#,#lectureIdx#,#lectureDate#,#attenDanceCount#,#attenDanceStudent#,#lectureContent#,#ipAddr#
       )
  	</insert>
  	
  	<insert id="eduCationDAO.batchModify"  parameterClass="eduAttendanceVO" >
			    	insert into RFC_COMTN_EDU_ATTENDANCE (idx,status,student_idx,lecture_idx,lecture_date,student_id)  values(#idx#,'Y',#studentIdx#,#lectureIdx#,#lectureDate#,#studentId#)
  	</insert>
  	
  	<delete id="eduCationDAO.deleteAttendanceDate" parameterClass="eduReportVO" >
		delete from RFC_COMTN_EDU_ATTENDANCE where lecture_idx=#lectureIdx# and lecture_date = #lectureDate#
  	</delete>
  	
  	<update id="eduCationDAO.attenddingUpdate1"  parameterClass="eduReportVO" >
    			update RFC_COMTN_EDU_ATTENDING set status=6 where lecture_idx = #lectureIdx# and status IN (3,5,6)
  	</update>
  	<update id="eduCationDAO.attenddingUpdate2"  parameterClass="eduReportVO" >
    			update RFC_COMTN_EDU_ATTENDING set status=5 where lecture_idx =#lectureIdx# and student_idx IN ($attenDanceStudent$)
  	</update>
  	<update id="eduCationDAO.attenddingUpdate3"  parameterClass="eduReportVO" >
    			update RFC_COMTN_EDU_ATTENDING set status=3 where lecture_idx=#lectureIdx# and status IN (5,6)
  	</update>
  	
  	
  	
  	
  	
  	
  	
  	
  	
  	
  	
  	<select id="eduCationDAO.getEduLectureList"  parameterClass="eduCationVO" resultClass="eduCationVO" cacheModel="RFCEduCationManageCache">
    	SELECT  * 
	  FROM (
			SELECT ROWNUM RNUM, ALL_LIST.*  
			FROM  
			(
	

    	SELECT idx, 
       status, 
       subject subJect, 
       lecture_time lectureTime, 
       limit_count limitCount, 
       startdate startDate, 
       enddate endDate, 
       starttime startTime, 
       endtime endTime, 
       att_startdate attStartDate, 
       att_enddate attEndDate, 
       lecture_term lectureTerm, 
       auto_application autoAppliCation, 
       limit_gubun1_year limitGubun1Year, 
       limit_gubun1_count limitGubun1Count, 
       limit_gubun2_auth limitGubun2Auth, 
       limit_gubun2_after limitGubun2After, 
       limit_gubun2_auto limitGubun2Auto, 
       dup_gubun_auth dupGubunAuth, 
       dup_gubun_after dupGubunAfter, 
       dup_gubun_auto dupGubunAuto, 
       attendance_dates attendAnceDates, 
       (SELECT vname 
         FROM RFC_COMTN_EDU_PLACE B 
        WHERE RFC_COMTN_EDU_LECTURE.place_idx = B.idx 
       ) AS place,  
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING D 
        WHERE RFC_COMTN_EDU_LECTURE.idx = D.lecture_idx 
              AND D.status = 0 
       ) AS attCount0, 
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING E 
        WHERE RFC_COMTN_EDU_LECTURE.idx = E.lecture_idx 
              AND E.status = 1 
       ) AS attCount1, 
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING F 
        WHERE RFC_COMTN_EDU_LECTURE.idx = F.lecture_idx 
              AND F.status = 2 
       ) AS attCount2, 
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING G 
        WHERE RFC_COMTN_EDU_LECTURE.idx = G.lecture_idx 
              AND G.status = 3 
       ) AS attCount3, 
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING H 
        WHERE RFC_COMTN_EDU_LECTURE.idx = H.lecture_idx 
              AND H.status = 4 
       ) AS attCount4, 
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING I 
        WHERE RFC_COMTN_EDU_LECTURE.idx = I.lecture_idx 
              AND I.status = 5 
       ) AS attCount5, 
       (SELECT count(*) 
         FROM RFC_COMTN_EDU_ATTENDING J 
        WHERE RFC_COMTN_EDU_LECTURE.idx = J.lecture_idx 
              AND J.status = 6 
       ) AS attCount6, 
       modify_date as modifyDate,create_date as createDate 
  FROM RFC_COMTN_EDU_LECTURE 
 WHERE status IN('Y') AND att_startdate &lt;= #attStartDate# AND att_enddate &gt;= #attEndDate# 
 			                        
            <isNotEmpty  property="orderBy" >
			         ORDER BY  $orderBy$
            </isNotEmpty>
            <isEmpty  property="orderBy" >
             	    ORDER BY idx DESC
            </isEmpty>

   	    	
        	   ) ALL_LIST
					  )
			  WHERE  RNUM  &gt; #firstIndex#
			  AND  RNUM &lt;= #firstIndex# + #recordCountPerPage#
    </select>
    
    
    <select id="eduCationDAO.getYearList"  parameterClass="eduCationVO" resultClass="eduCationVO" cacheModel="RFCEduCationManageCache">
    	SELECT idx, 
      status, 
       subject subJect, 
       lecture_time lectureTime, 
       limit_count limitCount, 
       startdate startDate, 
       enddate endDate, 
       starttime startTime, 
       endtime endTime, 
       att_startdate attStartDate, 
       att_enddate attEndDate, 
       lecture_term lectureTerm, 
       auto_application autoAppliCation, 
       limit_gubun1_year limitGubun1Year, 
       limit_gubun1_count limitGubun1Count, 
       limit_gubun2_auth limitGubun2Auth, 
       limit_gubun2_after limitGubun2After, 
       limit_gubun2_auto limitGubun2Auto, 
       dup_gubun_auth dupGubunAuth, 
       dup_gubun_after dupGubunAfter, 
       dup_gubun_auto dupGubunAuto, 
       attendance_dates attendAnceDates, 
       (SELECT vname 
         FROM RFC_COMTN_EDU_PLACE B 
        WHERE RFC_COMTN_EDU_LECTURE.place_idx = B.idx 
       ) AS place, 
       modify_date modifyDate 
  FROM RFC_COMTN_EDU_LECTURE 
 WHERE SUBSTR(startdate,0,4)=#year# and place_idx=#placeIdx#
       AND status IN( 'Y','N' ) 
       AND place_idx LIKE '%$placeIdx$%' 
ORDER BY startdate ASC, 
       starttime ASC, 
       lecture_time ASC  
    </select>
    
    <select id="eduCationDAO.getAttDuplicateCount" parameterClass="eduCationApplyVO" resultClass="int" cacheModel="RFCEduCationManageCache">
  					select 	count(*) as count from RFC_COMTN_EDU_ATTENDING A , (SELECT idx FROM RFC_COMTN_EDU_LECTURE WHERE att_startdate &lt;= #startDate# AND att_enddate &gt;= #endDate#) B where A.student_idx =#studentIdx# and A.status IN (0,1) and A.lecture_idx = B.idx
  	</select>
  	
  	<select id="eduCationDAO.getAttInDate"  parameterClass="eduCationVO" resultClass="eduCationVO" cacheModel="RFCEduCationManageCache">
  	SELECT idx, 
       subject_idx subjectIdx, 
       subject subJect,
       startdate startDate, 
       enddate endDate, 
       att_startdate attStartDate, 
       att_enddate attEndDate 
  FROM RFC_COMTN_EDU_LECTURE 
 WHERE place_idx=#placeIdx# 
       AND lecture_time = #lectureTime# 
       AND att_startdate &lt;= #attStartDate# 
       AND att_enddate &gt;= #attEndDate# 
       AND status = 'Y' 
       AND ROWNUM &lt;= 1 
ORDER BY enddate desc
</select>


<select id="eduCationDAO.getAttNextDate"  parameterClass="eduCationVO" resultClass="eduCationVO" cacheModel="RFCEduCationManageCache">
  	select * from (select 
  	idx,
  	subject_idx subjectIdx,
  	subject subJect,
  	startdate startDate,
  	enddate endDate,
  	att_startdate attStartDate,
  	att_enddate attEndDate from RFC_COMTN_EDU_LECTURE 
  	where place_idx=#placeIdx# and lecture_time = #lectureTime# and att_startdate &gt; #attStartDate# 
  	and status = 'Y' 
  	order by att_startdate asc) where rownum &lt;= 1
</select>

<select id="eduCationDAO.getAttCount"  parameterClass="eduCationApplyVO" resultClass="int" cacheModel="RFCEduCationManageCache">
           select count(*) as totcnt from RFC_COMTN_EDU_ATTENDING where lecture_idx = #lectureIdx# and status = #status#
 </select>
 
 <select id="eduCationDAO.getAttStatusCount"  parameterClass="eduCationApplyVO" resultClass="int" cacheModel="RFCEduCationManageCache">
           select count(*) as totcnt from RFC_COMTN_EDU_ATTENDING A , (SELECT idx, lecture_idx, att_date FROM RFC_COMTN_EDU_ATTENDING WHERE lecture_idx =#lectureIdx# 
           and student_idx =#studentIdx# and status =#status# ) B  where A.status =#status# and A.att_date &lt; B.att_date and A.lecture_idx =#lectureIdx#
 </select>
 
 <select id="eduCationDAO.getAttIngCount"  parameterClass="long" resultClass="int" cacheModel="RFCEduCationManageCache">
           select count(*) as totcnt from RFC_COMTN_EDU_ATTENDING A, (SELECT idx FROM RFC_COMTN_EDU_LECTURE WHERE ENDDATE >= TO_CHAR(SYSDATE,'yyyymmdd')) B 
           where A.student_idx =#studentIdx# and (A.status IN (1,3) or (A.status=0 AND (TO_DATE(A.startdate,'yyyyMMdd')+5) &lt;= sysdate)) and A.lecture_idx = B.idx
 </select>
 
 <select id="eduCationDAO.getAttIngLecture"  parameterClass="long" resultClass="eduCationVO" cacheModel="RFCEduCationManageCache">
    	SELECT * 
  FROM 
       (SELECT b.*, 
              ROWNUM AS rnum 
         FROM RFC_COMTN_EDU_ATTENDING A , 
              (SELECT idx, 
                     status, 
                     subject subJect, 
                     lecture_time lectureTime, 
                     limit_count limitCount, 
                     startdate startDate, 
                     enddate endDate, 
                     starttime startTime, 
                     endtime endTime, 
                     att_startdate attStartDate, 
                     att_enddate attEndDate, 
                     lecture_term lectureTerm, 
                     auto_application autoAppliCation, 
                     limit_gubun1_year limitGubun1Year, 
                     limit_gubun1_count limitGubun1Count, 
                     limit_gubun2_auth limitGubun2Auth, 
                     limit_gubun2_after limitGubun2After, 
                     limit_gubun2_auto limitGubun2Auto, 
                     dup_gubun_auth dupGubunAuth, 
                     dup_gubun_after dupGubunAfter, 
                     dup_gubun_auto dupGubunAuto, 
                     attendance_dates attendAnceDates, 
                     modify_date modifyDate 
                FROM RFC_COMTN_EDU_LECTURE 
               WHERE ENDDATE >= TO_CHAR(SYSDATE,'yyyymmdd') 
              ) B 
        WHERE A.student_idx =#studentIdx# 
              AND 
              ( 
                  A.status IN (1,3) 
                  OR 
                  ( 
                      A.status=0 
                      AND 
                      ( 
                          TO_DATE(A.startdate,'yyyyMMdd')+5 
                      ) 
                      &lt;= sysdate 
                  ) 
              ) 
              AND A.lecture_idx = B.idx 
     ORDER BY B.idx 
       ) 
 WHERE rnum=1
 </select>
 
  <select id="eduCationDAO.getDuplicateCount"  parameterClass="eduCationApplyVO" resultClass="int" cacheModel="RFCEduCationManageCache">
           select count(*) as count from RFC_COMTN_EDU_ATTENDING where student_idx =#studentIdx# and status IN (0,1,3) and ((startdate &lt;= #startDate# and enddate &gt;= #endDate#) or (startdate &lt;= #startDate# and enddate &gt;= #endDate#))
 </select>
 
 <update id="eduCationDAO.AttendingStatusUpdate"  parameterClass="eduCationApplyVO" >
    			update RFC_COMTN_EDU_ATTENDING set status=#status#, 
    			att_canceldate=TO_CHAR(SYSDATE,'yyyyMMddHH24MISS'), 
    			ATT_REJECT=#attReject#,
    			ATT_MEMO=#attMemo#,
    			ipaddr=#ipAddr# 
    			where student_idx =#studentIdx# and status = 0 and (TO_DATE(startdate,'yyyyMMdd')+5) &lt;= sysdate
</update>

<select id="eduCationDAO.getCountSubject"  parameterClass="eduCationApplyVO" resultClass="int" cacheModel="RFCEduCationManageCache">
           select count(*) as count from RFC_COMTN_EDU_ATTENDING where student_idx =#studentIdx# and lecture_idx &lt;&gt; #lectureIdx# and subject_idx=#subjectIdx# 
           and status IN (3,5,6) and TO_DATE(startdate,'yymmdd') BETWEEN ADD_MONTHS(SYSDATE, #yearTerm#) AND SYSDATE
 </select>
 
 <select id="eduCationDAO.getCountAllSubject"  parameterClass="eduCationApplyVO" resultClass="int" cacheModel="RFCEduCationManageCache">
          select count(*) as count from RFC_COMTN_EDU_ATTENDING where student_idx =#studentIdx# and TO_DATE(startdate,'yymmdd') BETWEEN ADD_MONTHS(SYSDATE, #yearTerm#) AND SYSDATE
 </select>
 
 <insert id="eduCationDAO.eduCationIsWrite"  parameterClass="eduCationApplyVO" >
		insert into RFC_COMTN_EDU_ATTENDING(idx,status,student_id,lecture_idx,subject_idx,student_idx,att_date,startdate,enddate,lecture_term,modify_id,modify_date,ipaddr)  
		values(#idx#,#status#,#studentId#,#lectureIdx#,#subjectIdx#,#studentIdx#,#attDate#,#startDate#,#endDate#,#lectureTerm#,#modifyId#,#modifyDate#,#ipAddr#)
</insert>

 <select id="eduCationDAO.getAttDate"  parameterClass="eduAttendanceVO" resultClass="String" cacheModel="RFCEduCationManageCache">
          select att_date attDate from RFC_COMTN_EDU_ATTENDING where student_idx = #studentIdx# and lecture_idx =#lectureIdx#
 </select>
 
 <delete id="eduCationDAO.isDelete" parameterClass="eduCationApplyVO" >
 delete from RFC_COMTN_EDU_ATTENDING where student_idx = #studentIdx# and lecture_idx = #lectureIdx# 
</delete>

<select id="eduCationDAO.selectMyApplyList1"  parameterClass="eduCationApplyVO" resultClass="eduCationApplyVO" cacheModel="RFCEduCationManageCache">
           SELECT 
           idx, 
                     status, 
                     lecture_idx lectureIdx, 
                     subject_idx subjectIdx, 
                     student_id studentId, 
                     att_date attDate, 
                     startdate startDate, 
                     enddate endDate, 
                     (SELECT vname 
                       FROM RFC_COMTN_EDU_SUBJECT D 
                      WHERE AA.subject_idx = D.idx
                     ) AS subJect, 
                     (SELECT F.vname 
                       FROM RFC_COMTN_EDU_LECTURE E,
                            RFC_COMTN_EDU_PLACE F 
                      WHERE AA.lecture_idx = E.idx 
                            AND E.place_idx = F.idx
                     ) AS placeName, 
                     (SELECT lecture_time 
                       FROM RFC_COMTN_EDU_LECTURE G 
                      WHERE AA.lecture_idx = G.idx
                     ) AS lectureTime 
            FROM RFC_COMTN_EDU_ATTENDING AA where status IN(0,1,2,4) and student_idx=#studentIdx# order by idx desc
 </select>
 
 <select id="eduCationDAO.selectMyApplyList2"  parameterClass="eduCationApplyVO" resultClass="eduCationApplyVO" cacheModel="RFCEduCationManageCache">
           SELECT 
           idx, 
                     status, 
                     lecture_idx lectureIdx, 
                     subject_idx subjectIdx, 
                     student_id studentId, 
                     att_date attDate, 
                     startdate startDate, 
                     enddate endDate, 
                     (SELECT vname 
                       FROM RFC_COMTN_EDU_SUBJECT D 
                      WHERE AA.subject_idx = D.idx
                     ) AS subJect, 
                     (SELECT F.vname 
                       FROM RFC_COMTN_EDU_LECTURE E,
                            RFC_COMTN_EDU_PLACE F 
                      WHERE AA.lecture_idx = E.idx 
                            AND E.place_idx = F.idx
                     ) AS placeName, 
                     (SELECT lecture_time 
                       FROM RFC_COMTN_EDU_LECTURE G 
                      WHERE AA.lecture_idx = G.idx
                     ) AS lectureTime 
            FROM RFC_COMTN_EDU_ATTENDING AA where status IN(3) and student_idx=#studentIdx# order by idx desc
 </select>
 
 <select id="eduCationDAO.selectMyApplyList3"  parameterClass="eduCationApplyVO" resultClass="eduCationApplyVO" cacheModel="RFCEduCationManageCache">
           SELECT idx, 
       status, 
       lecture_idx lectureIdx, 
       subject_idx subjectIdx, 
       student_id studentId, 
       att_date attDate, 
       startdate startDate, 
       enddate endDate, 
       (SELECT vname 
         FROM RFC_COMTN_EDU_SUBJECT D 
        WHERE AA.subject_idx = D.idx 
       ) AS subJect, 
       (SELECT F.vname 
         FROM RFC_COMTN_EDU_LECTURE E, 
              RFC_COMTN_EDU_PLACE F 
        WHERE AA.lecture_idx = E.idx 
              AND E.place_idx = F.idx 
       ) AS placeName, 
       (SELECT lecture_time 
         FROM RFC_COMTN_EDU_LECTURE G 
        WHERE AA.lecture_idx = G.idx 
       ) AS lectureTime, 
       (SELECT COUNT(*) 
         FROM RFC_COMTN_EDU_AFTER 
        WHERE student_idx=AA.STUDENT_IDX 
              AND lecture_idx=AA.LECTURE_IDX
       ) AS afterCount 
  FROM RFC_COMTN_EDU_ATTENDING AA 
 WHERE status IN(5,6) 
       AND student_idx=#studentIdx# 
ORDER BY idx desc
 </select>
 
  <select id="eduCationDAO.getStatAttend0"  parameterClass="eduAttendanceVO" resultClass="eduCationApplyVO" cacheModel="RFCEduCationManageCache">
          select 
          (SELECT count(idx) FROM RFC_COMTN_EDU_ATTENDING WHERE lecture_idx = #lectureIdx# and status = 0) AS tcnt,      
          a.* from 
          (select 
          rownum rcnt, 
          idx, 
          student_idx studentIdx 
          from (SELECT * FROM RFC_COMTN_EDU_ATTENDING ORDER BY att_date asc) 
          where lecture_idx = #lectureIdx# 
          and status = 0 ) a 
          WHERE a.student_idx = #studentIdx#
 </select>
 
 <select id="eduCationDAO.getStatAttend2"  parameterClass="eduAttendanceVO" resultClass="eduCationApplyVO" cacheModel="RFCEduCationManageCache">
          select  
          idx, 
         student_idx studentIdx, 
         att_reject attReject, 
         att_memo attMemo 
         from RFC_COMTN_EDU_ATTENDING 
         where student_idx = #studentIdx# and lecture_idx =#lectureIdx# 
         and status = 2 
 </select>
 
 <select id="eduCationDAO.getStatistics"  parameterClass="eduCationVO" resultClass="eduCationVO" cacheModel="RFCEduCationManageCache">
 SELECT place, lecture_time lectureTime, subject_idx subjectIdx, status, SUM(cnt) as cnt FROM 
 (select 
 subject_idx,student_idx,status,(1) as cnt, 
 (SELECT place_idx FROM RFC_COMTN_EDU_LECTURE WHERE a.lecture_idx = idx) AS place, 
 (SELECT lecture_time FROM RFC_COMTN_EDU_LECTURE WHERE a.lecture_idx = idx) AS lecture_time 
 from RFC_COMTN_EDU_ATTENDING a WHERE status IN ($status$) AND subject_idx IN ($vidx$) AND startdate BETWEEN #startDate# AND #endDate#) b 
 WHERE place IN($place$) AND lecture_time IN ($lectureTime$)  
 group BY b.place, b.lecture_time, b.status, b.subject_idx 
 ORDER BY place,lecture_time,status,subject_idx
 </select>
 
 <update id="eduCationDAO.addlectureDate"  parameterClass="eduCationVO" >
    			update RFC_COMTN_EDU_LECTURE set ATTENDANCE_DATES=#attendAnceDates# , ENDDATE=#endDate# where idx=#idx#
</update>

	
  	<insert id="eduCationDAO.eduAfterInsert"  parameterClass="eduAfterVO" >
			    	INSERT 
  INTO RFC_COMTN_EDU_AFTER
       ( 
          IDX,LECTURE_IDX,STUDENT_IDX,STUDENT_ID,QUESTION_NO,ANSWER_NO,ANSWER_TEXT,REG_DATE ) 
       VALUES
       (
           #idx#,#lectureIdx#,#studentIdx#,#studentId#,#questionNo#,#answerNo#,#answerText#,#regDate#
       )
  	</insert>
  	
  	<select id="eduCationDAO.selectAfterCount"  parameterClass="eduAfterVO" resultClass="int" cacheModel="RFCEduCationManageCache">
            SELECT
    		count(*) totcnt
    	FROM
    		RFC_COMTN_EDU_AFTER
    	WHERE STUDENT_IDX=#studentIdx# and LECTURE_IDX=#lectureIdx#
  	</select>
  	
  	
  	<select id="eduCationDAO.selectAfterDistinctCount"  parameterClass="eduAfterVO" resultClass="int" cacheModel="RFCEduCationManageCache">
            SELECT
    		COUNT(DISTINCT(student_idx)) AS cnt 
    	FROM
    		RFC_COMTN_EDU_AFTER
    	WHERE LECTURE_IDX=#lectureIdx#
  	</select>
  	
  	<select id="eduCationDAO.selectAfterQuestionAnswer"  parameterClass="eduAfterVO" resultClass="eduAfterVO" cacheModel="RFCEduCationManageCache">
            SELECT question_no questionNo,answer_no answerNo, 
       answer_text answerText 
  FROM RFC_COMTN_EDU_AFTER 
 WHERE lecture_idx=#lectureIdx# 
       AND question_no=#questionNo#
  	</select>
  	
  	
  	<select id="eduCationDAO.selectCertificateNumMaxNum"  parameterClass="eduCationApplyVO" resultClass="int" cacheModel="RFCEduCationManageCache">
           SELECT max(CERTIFICATE_NUM) cnt 
  FROM RFC_COMTN_EDU_ATTENDING 
 WHERE ENDDATE LIKE '$certificateNum$%'
 </select>
 
  <update id="eduCationDAO.updateAttendingCertificateNum"  parameterClass="eduCationApplyVO" >
    			UPDATE RFC_COMTN_EDU_ATTENDING 
       SET CERTIFICATE_NUM=#certificateNum# 
 WHERE lecture_idx=#lectureIdx# 
       AND student_idx=#studentIdx#
</update>

<select id="eduCationDAO.selectCertificateValue"  parameterClass="eduCationApplyVO" resultClass="int" cacheModel="RFCEduCationManageCache">
           SELECT CERTIFICATE_NUM cnt 
  FROM RFC_COMTN_EDU_ATTENDING 
 WHERE lecture_idx=#lectureIdx# 
       AND student_idx=#studentIdx#
 </select>
  	
 
  </sqlMap>