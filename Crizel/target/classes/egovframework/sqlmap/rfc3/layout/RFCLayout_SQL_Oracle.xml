<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="RFCLayout">
	 <typeAlias  alias="egovMap"      type = "egovframework.rte.psl.dataaccess.util.EgovMap"/>
     <typeAlias  alias="layoutVO" type = "egovframework.rfc3.layout.vo.LayoutVO"/>
      
     <resultMap id="layout" class="egovframework.rfc3.layout.vo.LayoutVO">
		<result property="layoutSid" column="layoutSid" />
        <result property="sgroupId" column="sgroupId" />
        <result property="domainId" column="domainId" />
        <result property="layoutNm" column="layoutNm" />       
        <result property="engName" column="engName" /> 
        <result property="layoutContent" column="layoutContent" />       
        <result property="regDate" column="regDate"/>
    </resultMap>
    
       <cacheModel type="${Globals.ibatis.default.cache}" id="RFCLayoutCache" readOnly="true" serialize="false">
     	    <flushInterval hours="24" />
     		<flushOnExecute statement="LayoutDAO.insertLayout"/>
     		<flushOnExecute statement="LayoutDAO.deleteLayout"/>
     		<flushOnExecute statement="LayoutDAO.deleteAllLayoutToDomain"/>
     		<flushOnExecute statement="LayoutDAO.updateLayout"/>
     		<flushOnExecute statement="LayoutDAO.updateLayoutcopy"/>    
     		<flushOnExecute statement="LayoutDAO.updateLayoutContents"/>   		
     </cacheModel>    
    
<!--		
			LAYOUT_SID							layoutSid
 			SGROUP_ID							sgroupId
			DOMAIN_ID								domainId
    		LAYOUT_NM							layoutNm
			LAYOUT_CONTENT				layoutContent
			EDITOR_IS_USE					editorIsUse
			LAYOUT_SORT_IX					layoutSortIx	
			LAYOUT_IS_SKIN_APPLY		layoutIsSkinApply
			REG_DATE								regDate
			IS_DEFAULT							isDefault
-->


 <select id="LayoutDAO.selectLayoutTotCnt"  parameterClass="LayoutVO" resultClass="int" cacheModel="RFCLayoutCache">
						SELECT 
								COUNT(*) totcnt
						 FROM   RFC_COMTNLAYOUT
						
						<dynamic prepend="WHERE">
							<isNotEmpty prepend="AND"  property="sgroupId" >
				          		   SGROUP_ID   = #sgroupId#
				            </isNotEmpty>
			           		 <isNotEmpty prepend="AND"  property="searchCondition" >
			          		    $searchCondition$  LIKE  '%$searchKeyword$%'
			           		</isNotEmpty>
			           		<isNotEmpty prepend="AND" property="domainId" >
			          		    			 DOMAIN_ID  = #domainId#
			            	</isNotEmpty>	
			            	<isEmpty  property="domainId" >
		          		    	<isEqual  prepend="AND"   property="isDomainAdmin" compareValue="true">
						            		    DOMAIN_ID in ( $myDomainList$ )
						     	</isEqual>
			            	</isEmpty>	    
			           		
				         </dynamic>
				       
	</select>
	

	<select id="LayoutDAO.selectLayoutList" parameterClass="LayoutVO"  resultMap="layout" cacheModel="RFCLayoutCache">
	  SELECT  * 
	  FROM (
			SELECT ROWNUM RNUM, ALL_LIST.*  
			FROM  
			(  
			  
			          SELECT 
											LAYOUT_SID							layoutSid,
								 			SGROUP_ID							sgroupId,
											DOMAIN_ID								domainId,
								    		LAYOUT_NM							layoutNm,
								    		ENG_NAME							engName,
											LAYOUT_CONTENT				layoutContent,
											REG_DATE								regDate
					FROM  RFC_COMTNLAYOUT
					<dynamic  prepend="WHERE">
						<isNotEmpty prepend="AND"  property="sgroupId" >
			          		   SGROUP_ID   = #sgroupId#
			            </isNotEmpty>
			            <isNotEmpty prepend="AND"  property="searchCondition" >
			          		   $searchCondition$  LIKE  '%$searchKeyword$%'
			           	</isNotEmpty>
			           	<isNotEmpty prepend="AND" property="domainId" >
			          		    			 DOMAIN_ID  = #domainId#
			            </isNotEmpty>	
			            <isEmpty  property="domainId" >
		          		     <isEqual  prepend="AND"   property="isDomainAdmin" compareValue="true">
						            		    DOMAIN_ID in ( $myDomainList$ )
						     </isEqual>
			            </isEmpty>	    
			       </dynamic>
		            <isNotEmpty  property="orderField" >
		            	 ORDER BY  $orderField$   $orderSort$
		            </isNotEmpty>
		            ) ALL_LIST
	      )
  WHERE  RNUM  &gt; #firstIndex#
  AND  RNUM &lt;= #firstIndex# + #recordCountPerPage#
	</select>	
	
	<select id="LayoutDAO.selectLayoutCopyList" parameterClass="LayoutVO"  resultMap="layout" cacheModel="RFCLayoutCache">
			          SELECT 
											LAYOUT_SID							layoutSid,
								 			SGROUP_ID							sgroupId,
											DOMAIN_ID								domainId,
								    		LAYOUT_NM							layoutNm,
								    		ENG_NAME							engName,
											LAYOUT_CONTENT				layoutContent,
											REG_DATE								regDate
					FROM  RFC_COMTNLAYOUT
					WHERE
						  SGROUP_ID   = #sgroupId#
					AND
						  DOMAIN_ID  = #domainId#
					AND
						LAYOUT_SID != #layoutSid#
	</select>	
	
	<select id="LayoutDAO.selectLayoutVO" parameterClass="LayoutVO"  resultMap="layout" cacheModel="RFCLayoutCache">
			          SELECT 
											LAYOUT_SID							layoutSid,
								 			SGROUP_ID							sgroupId,
											DOMAIN_ID								domainId,
								    		LAYOUT_NM							layoutNm,
								    		ENG_NAME							engName,
											LAYOUT_CONTENT				layoutContent,
											REG_DATE								regDate
					FROM  RFC_COMTNLAYOUT
					
					<dynamic  prepend="WHERE">
						<isNotEqual property="layoutSid" compareValue="0">
							<isNotEmpty prepend="AND"  property="layoutSid" >
			          		   	LAYOUT_SID   = #layoutSid#
			            	</isNotEmpty>
						</isNotEqual>
						<isNotEmpty prepend="AND"  property="sgroupId" >
			          		   SGROUP_ID   = #sgroupId#
			            </isNotEmpty>
			           	<isNotEmpty prepend="AND" property="domainId" >
			          		    			 DOMAIN_ID  = #domainId#
			            </isNotEmpty>	
			            <isEmpty  property="domainId" >
		          		     <isEqual  prepend="AND"   property="isDomainAdmin" compareValue="true">
						            		    DOMAIN_ID in ( $myDomainList$ )
						     </isEqual>
			            </isEmpty>	   
			             <isNotEmpty prepend="AND"  property="layoutContent" >
			          		   LAYOUT_CONTENT   LIKE  '%$layoutContent$%'
			            </isNotEmpty>
			       </dynamic>
	</select>	
	
	
	<insert id="LayoutDAO.insertLayout" parameterClass="layoutVO">
				INSERT INTO 
				  	RFC_COMTNLAYOUT  (
					LAYOUT_SID,							
 					SGROUP_ID,							
					DOMAIN_ID,							
    				LAYOUT_NM,		
    				ENG_NAME,					
					LAYOUT_CONTENT,											
					REG_DATE							
				) VALUES (
					#layoutSid#, 
					#sgroupId#,
					#domainId#,
					#layoutNm#,
					#engName#,
					#layoutContent#,
					#regDate#
				)
	</insert>
	
	<delete id="LayoutDAO.deleteLayout" parameterClass="layoutVO" >
		DELETE  FROM RFC_COMTNLAYOUT
					WHERE  LAYOUT_SID=#layoutSid#
	</delete>
	 <delete id="LayoutDAO.deleteAllLayoutToDomain" parameterClass="String" >
		DELETE  FROM RFC_COMTNLAYOUT
					WHERE  DOMAIN_ID=#domainId#
	</delete>
	
	
	<update id="LayoutDAO.updateLayout" parameterClass="layoutVO" >
		UPDATE RFC_COMTNLAYOUT SET
		 			SGROUP_ID = #sgroupId#,
					DOMAIN_ID	= #domainId#,
		    		LAYOUT_NM = #layoutNm#,
		    		ENG_NAME  =#engName#,
					LAYOUT_CONTENT = #layoutContent#,
					REG_DATE	 = #regDate#
		WHERE
					LAYOUT_SID =	#layoutSid#
	</update>
	
		<update id="LayoutDAO.updateLayoutcopy" parameterClass="layoutVO" >
		UPDATE RFC_COMTNLAYOUT SET
					LAYOUT_CONTENT = #layoutContent#,
					REG_DATE	 = #regDate#
		WHERE
					LAYOUT_SID =	#layoutSid#
	</update>
	
<!-- 

update CmsLayoutVO  set layoutIsSkinApply = 'N', regDate=?  WHERE layoutSid = ?
 -->		
	
	<update id="LayoutDAO.updateLayoutContents" parameterClass="layoutVO" >
		UPDATE RFC_COMTNLAYOUT SET
					REG_DATE	 = #regDate#
		WHERE
					LAYOUT_SID =	#layoutSid#
	</update>
</sqlMap>